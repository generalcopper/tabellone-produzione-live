<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Polveri • General Copper</title>

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
:root {
  --bg0:#05060a; --bg1:#070b12;
  --panel:rgba(10,14,24,.92);
  --line:rgba(120,255,255,.25);
  --text:#eaf7ff;
  --muted:rgba(200,230,255,.75);
  --cyan:#35f2ff;
  --green:#2bff88;
  --yellow:#ffe66d;
  --red:#ff4d6d;
}

*{box-sizing:border-box}
html,body{margin:0;padding:0;background:linear-gradient(180deg,var(--bg0),var(--bg1));color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto}

body:before{
  content:"";
  position:fixed; inset:0;
  background:repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,.015),
    rgba(255,255,255,.015) 1px,
    transparent 1px,
    transparent 6px
  );
  pointer-events:none;
}

.wrap{padding:12px;display:flex;flex-direction:column;gap:12px}

.card{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:18px;
  padding:14px;
  box-shadow:0 0 30px rgba(0,0,0,.5),0 0 30px rgba(53,242,255,.08);
}

.title{font-size:26px;font-weight:900;letter-spacing:1px}
.brand{margin-top:4px;font-size:13px;font-weight:800;color:var(--muted)}

.infoGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}

.big{font-size:34px;font-weight:900;line-height:1}
.label{font-size:11px;font-weight:800;color:var(--muted);margin-top:4px}

.weather{font-size:30px;font-weight:900}
.weatherDesc{font-size:14px;font-weight:800;color:var(--muted)}

table{width:100%;border-collapse:collapse;margin-top:6px}
th{text-align:left;font-size:11px;font-weight:900;color:var(--muted);padding:8px 6px;border-bottom:1px solid rgba(255,255,255,.12)}
td{padding:10px 6px;font-size:15px;font-weight:800;border-bottom:1px solid rgba(255,255,255,.08)}

.badge{display:inline-block;padding:6px 10px;border-radius:999px;font-size:11px;font-weight:900}
.todo{background:rgba(53,242,255,.15);color:var(--cyan)}
.done{background:rgba(43,255,136,.15);color:var(--green)}
.warn{background:rgba(255,230,109,.18);color:var(--yellow)}
.err{background:rgba(255,77,109,.18);color:var(--red)}

.footer{font-size:10px;color:rgba(200,230,255,.45);text-align:right}
</style>

<script>
if(sessionStorage.getItem("admin_auth")!=="ok") {
  location.href="../login/";
}
</script>
</head>

<body>
<div class="wrap">

  <div class="card">
    <div class="title">TABELLONE POLVERI</div>
    <div class="brand">General Copper • Live</div>
  </div>

  <div class="infoGrid">
    <div class="card">
      <div class="big" id="timeIT">--:--</div>
      <div class="label" id="dateIT">—</div>
    </div>

    <div class="card">
      <div class="weather" id="temp">--°</div>
      <div class="weatherDesc" id="wdesc">Caricamento meteo…</div>
    </div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Prodotto</th>
          <th>Q.tà</th>
          <th>Formato</th>
          <th>Stato</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="4">Caricamento dati…</td></tr>
      </tbody>
    </table>
  </div>

  <div class="footer">build 20251217-003642</div>

</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSkMpoxpfljQwa9KCmuacsuwypfaFOECbXFUi0Xf5W_QosNVGM0GmIEAtxsjxDmi14HUGDfbYs1W4Iz/pub?output=csv";
const REFRESH = 20000;

function tickClock(){
  const n = new Date();
  document.getElementById("timeIT").textContent =
    new Intl.DateTimeFormat("it-IT",{hour:"2-digit",minute:"2-digit"}).format(n);
  document.getElementById("dateIT").textContent =
    new Intl.DateTimeFormat("it-IT",{weekday:"long",day:"2-digit",month:"long"}).format(n);
}

async function loadCSV(){
  const res = await fetch(CSV_URL + "&t=" + Date.now());
  const text = await res.text();
  const rows = text.trim().split("\n").map(r=>r.split(","));
  const body = document.getElementById("tbody");
  body.innerHTML="";
  rows.slice(1).forEach(r=>{
    if(!r[0]) return;
    let st = (r[4]||"").toLowerCase();
    let cls="todo";
    if(st.includes("ok")) cls="done";
    if(st.includes("att")) cls="warn";
    if(st.includes("err")) cls="err";
    body.innerHTML+=`
      <tr>
        <td>${r[0]}</td>
        <td>${r[1]||""}</td>
        <td>${r[3]||""}</td>
        <td><span class="badge ${cls}">${r[4]||"DA PRODURRE"}</span></td>
      </tr>`;
  });
}

async function loadWeather(){
  const url = `https://api.open-meteo.com/v1/forecast?latitude=45.1895&longitude=11.2139&current=temperature_2m,weather_code&timezone=Europe/Rome`;
  const r = await fetch(url);
  const j = await r.json();
  document.getElementById("temp").textContent = j.current.temperature_2m + "°";
  document.getElementById("wdesc").textContent = "Meteo Cerea (VR)";
}

tickClock();
setInterval(tickClock,1000);
loadCSV();
setInterval(loadCSV,REFRESH);
loadWeather();
setInterval(loadWeather,600000);
</script>
</body>
</html>
