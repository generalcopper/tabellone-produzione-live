<!DOCTYPE html>

<html lang="it">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>HUB LINEA POLVERI</title>
<link href="favicon.png" rel="icon" type="image/png"/>
<link href="apple-touch-icon.png" rel="apple-touch-icon"/>
<meta content="no-cache, no-store, must-revalidate" http-equiv="Cache-Control"/>
<meta content="no-cache" http-equiv="Pragma"/>
<meta content="0" http-equiv="Expires"/>
<style>
    :root{
      --bg0:#05060a; --bg1:#070b12;
      --panel: rgba(10,14,24,.82);
      --line: rgba(120,255,255,.22);
      --text:#eaf7ff;
      --neonCyan:#35f2ff; --neonMag:#ff2bd6; --neonYel:#ffe66d;
      --todo:#35f2ff; --done:#2bff88;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{
      background:
        radial-gradient(1400px 1100px at 10% 10%, rgba(53,242,255,.10), transparent 55%),
        radial-gradient(1400px 1100px at 85% 15%, rgba(255,43,214,.08), transparent 55%),
        radial-gradient(1200px 900px at 70% 90%, rgba(255,230,109,.06), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:var(--text);
      overflow:hidden;
    }
    body:before{
      content:"";
      position:fixed; inset:0;
      background: repeating-linear-gradient(to bottom,
        rgba(255,255,255,.016), rgba(255,255,255,.016) 1px,
        transparent 1px, transparent 7px);
      opacity:.18; pointer-events:none; mix-blend-mode:overlay;
      z-index:1;
    }
    .wrap{height:100%;display:flex;flex-direction:column;padding:18px;gap:14px;position:relative;z-index:2;}
    .card{
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow:
        0 0 0 1px rgba(53,242,255,0.10),
        0 14px 34px rgba(0,0,0,0.50),
        0 0 46px rgba(53,242,255,0.05),
        0 0 56px rgba(255,43,214,0.03);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
      position:relative;
    }
    .top{display:flex;gap:12px}

    .titleCard{flex:1;position:relative;isolation:isolate;min-width:520px;padding:0;}
    .titlePad{padding:18px 20px; position:relative; z-index:2;}
    .titleCard:before{
      content:""; position:absolute; inset:-2px;
      background: linear-gradient(90deg, rgba(53,242,255,0.00), rgba(53,242,255,0.20), rgba(255,43,214,0.16), rgba(53,242,255,0.00));
      filter: blur(9px); opacity:0.52; transform: translate3d(-60%,0,0);
      animation: sweep 6.5s linear infinite; pointer-events:none; z-index:0; will-change: transform;
    }
    @keyframes sweep{0%{transform: translate3d(-60%,0,0)}100%{transform: translate3d(60%,0,0)}}
    .titleGrid{
      position:absolute; inset:0;
      background: linear-gradient(to right, rgba(53,242,255,0.10) 1px, transparent 1px),
                  linear-gradient(to bottom, rgba(255,43,214,0.08) 1px, transparent 1px);
      background-size:120px 120px; opacity:0.16; mix-blend-mode: screen;
      transform: translate3d(0,0,0); animation: gridPan 10s linear infinite;
      pointer-events:none; z-index:1; will-change: transform;
    }
    @keyframes gridPan{0%{transform: translate3d(0,0,0)}100%{transform: translate3d(240px,240px,0)}}

    .title{margin:0;font-size:64px;font-weight:950;letter-spacing:1.2px;text-transform:uppercase;text-shadow:0 0 26px rgba(53,242,255,0.16);position:relative;z-index:3;}
    .subtitle{margin-top:10px;color:rgba(200,230,255,.72);font-size:18px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;position:relative;z-index:3;}
    .chip{display:inline-flex;align-items:center;gap:10px;padding:7px 11px;border-radius:999px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.04);font-weight:900;letter-spacing:0.7px;text-transform:uppercase;font-size:14px;}
    .chip.live{border-color:rgba(53,242,255,0.24);box-shadow:0 0 16px rgba(53,242,255,0.10)}
    .liveDot{width:10px;height:10px;border-radius:999px;background:var(--neonCyan);
      box-shadow:0 0 0 6px rgba(53,242,255,0.12),0 0 18px rgba(53,242,255,0.22);
      animation:livePulse 1.6s ease-in-out infinite;}
    @keyframes livePulse{0%,100%{filter:brightness(1)}50%{filter:brightness(1.5)}}

    .clockCard{width:560px;padding:16px;display:flex;flex-direction:column;gap:10px;align-items:flex-end;flex:0 0 auto;}
    .dateBig{font-size:34px;font-weight:950;margin:0;letter-spacing:0.6px;text-transform:capitalize}
    .timeGrid{display:grid;grid-template-columns:120px 1fr;gap:10px 14px;align-items:baseline;font-variant-numeric:tabular-nums;width:100%}
    .timeLabel{text-align:right;font-size:18px;font-weight:900;color:rgba(200,230,255,0.72);letter-spacing:1px;text-transform:uppercase}
    .timeVal{font-size:96px;font-weight:950;line-height:.95;
      text-shadow:0 0 24px rgba(255,43,214,0.12),0 0 20px rgba(53,242,255,0.10);}

    .weatherCard{width:520px;padding:16px;display:flex;flex-direction:column;gap:10px;align-items:flex-start;flex:0 0 auto;}
    .wTitle{font-size:18px;font-weight:950;letter-spacing:1px;text-transform:uppercase;color:rgba(200,230,255,.78);display:flex;align-items:center;gap:10px}
    .wPulse{width:10px;height:10px;border-radius:999px;background:var(--neonMag);box-shadow:0 0 0 6px rgba(255,43,214,0.10);animation:livePulse 1.8s ease-in-out infinite;}
    .wMain{display:flex;align-items:flex-end;gap:16px;width:100%;}
    .wTemp{font-size:92px;font-weight:950;line-height:.95;text-shadow:0 0 18px rgba(255,230,109,0.10);}
    .wDesc{font-size:28px;font-weight:900;color:rgba(200,230,255,.78);line-height:1.1}
    .wMeta{display:flex;gap:14px;flex-wrap:wrap;color:rgba(200,230,255,.72);font-size:18px;font-weight:850}
    .wPill{border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.04);border-radius:999px;padding:8px 12px;}
    .wSmall{font-size:14px;color:rgba(200,230,255,.55);font-weight:850;letter-spacing:0.4px}

    .board{flex:1;display:flex;flex-direction:column;min-height:0;}
    .header,.row{display:grid;grid-template-columns:2.4fr 520px 360px;align-items:center;gap:16px;padding:0 18px;}
    .header{height:70px;border-bottom:1px solid rgba(120,255,255,.16);font-size:18px;font-weight:900;text-transform:uppercase;color:rgba(200,230,255,.78);background:rgba(255,255,255,0.03);flex:0 0 auto;}
    .rows{flex:1 1 auto;min-height:0;overflow:auto;}
    .row{height:112px;border-bottom:1px solid rgba(120,255,255,.11);position:relative;flex:0 0 auto;}
    .product{font-size:64px;font-weight:950;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-shadow:0 0 18px rgba(53,242,255,0.10);}
    .qtyFmt{justify-self:end;display:flex;align-items:baseline;gap:18px;font-variant-numeric:tabular-nums;white-space:nowrap;}
    .qty{font-size:60px;font-weight:950;text-shadow:0 0 16px rgba(255,230,109,0.09)}
    .fmt{font-size:36px;color:rgba(200,230,255,.74);font-weight:850;letter-spacing:0.4px}
    .statusWrap{justify-self:end;display:flex;align-items:center;gap:14px;white-space:nowrap}
    .badge{display:inline-flex;align-items:center;gap:12px;padding:16px 20px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.05);font-size:34px;font-weight:950;text-transform:uppercase;letter-spacing:0.8px;box-shadow:0 0 20px rgba(53,242,255,0.07);}
    .badge .wipTimer{
      margin-left: 10px;
      font-size: 22px;
      font-weight: 950;
      letter-spacing: .4px;
      opacity: .86;
      font-variant-numeric: tabular-nums;
      display:none;
    }
    .badge.wip .wipTimer{ display:inline-block; }

    .stWrap{
      position:relative;
      overflow:hidden;
      display:block;
      max-width: 320px;
    }
    .st{display:inline-block;white-space:nowrap;}
    .badge.wip .st{
      will-change: transform;
      animation: marqueeX 5.2s linear infinite;
    }
    @keyframes marqueeX{
      0%{transform: translateX(110%);}
      100%{transform: translateX(-110%);}
    }
    @media (prefers-reduced-motion: reduce){
      .badge.wip .st{ animation:none; }
    }
    .dot{width:16px;height:16px;border-radius:999px;background:var(--todo);box-shadow:0 0 0 6px rgba(53,242,255,.14);}
    .badge.todo{border-color:rgba(53,242,255,.26)}
    .badge.todo .dot{background:var(--todo)}
    .badge.done{border-color:rgba(43,255,136,.28)}
    .badge.done .dot{background:var(--done);box-shadow:0 0 0 6px rgba(43,255,136,.14)}
    .blink{animation:softPulse 2.0s ease-in-out infinite}
    @keyframes softPulse{0%,100%{filter:brightness(1)}50%{filter:brightness(1.18)}}

    .debug{position:fixed;left:12px;bottom:10px;z-index:3;color:rgba(200,230,255,0.55);font-size:12px;letter-spacing:0.4px;user-select:none;max-width:85vw;}

    .badge.btn{
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, filter .12s ease;
    }
    .badge.btn:active{ transform: scale(0.98); filter: brightness(1.06); }

    .producedCard{
      margin-top: 14px;
      padding: 14px;
    }
    .prodHead{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }
.prodTitle{
      font-weight:900;
      letter-spacing:.3px;
      font-size: 16px;
    }
    .prodHint{
      font-size: 12px;
      opacity:.75;
    }
    .prodList{
      display:flex;
      flex-direction:column;
      gap:8px;
      max-height: 180px;
      overflow:auto;
      padding-right: 4px;
    }
    .prodEmpty{
      opacity:.65;
      font-size: 13px;
      padding: 10px 12px;
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: 14px;
    }
    .prodItem{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
    }
    .prodText{
      font-size: 13px;
      line-height:1.25;
      opacity:.95;
    }
    .prodQty{
      font-weight:900;
      margin-left:6px;
    }
    .prodTime{
      margin-left: 10px;
      font-weight: 800;
      opacity: .85;
      font-size: 12px;
    }
    .undoBtn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: inherit;
      border-radius: 12px;
      padding: 8px 10px;
      font-weight:800;
      cursor:pointer;
      white-space:nowrap;
    }
    .undoBtn:active{ transform: scale(0.99); }

    @media (max-width: 820px){
      .wrap{ padding: 10px; }
      .card.top{ padding: 14px 14px; }
      .top h1{ font-size: 22px; }
      .meta{ flex-wrap: wrap; gap: 8px; }
      .chip{ font-size: 12px; padding: 8px 10px; }
      .board{ border-radius: 18px; }
      .header{ display:none; }
      .rows{ padding: 6px 0; }
      .row{
        display:block;
        height:auto;
        padding: 14px 14px;
        gap: 10px;
      }
      .product{
        font-size: 28px;
        white-space: normal;
        line-height: 1.05;
        margin-bottom: 8px;
      }
      .qtyFmt{
        justify-self: unset;
        display:flex;
        align-items: baseline;
        gap: 10px;
        margin-bottom: 10px;
      }
      .qty{ font-size: 30px; }
      .fmt{ font-size: 16px; }
      .statusWrap{
        justify-self: unset;
        display:flex;
        align-items:center;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
      }
      .badge{
        font-size: 12px;
        padding: 10px 12px;
        border-radius: 999px;
      }
      .badge .wipTimer{ font-size: 12px; margin-left: 8px; opacity:.9; }
      .dot{ width: 12px; height: 12px; box-shadow: 0 0 0 4px rgba(53,242,255,.14); }
      .badge.done .dot{ box-shadow: 0 0 0 4px rgba(43,255,136,.18); }
      .badge.wip .dot{ box-shadow: 0 0 0 4px rgba(255,189,67,.18); }

      .prodList{ max-height: 220px; }
      .prodItem{ gap: 8px; }
      .undoBtn{ padding: 8px 10px; font-size: 12px; }
    }

    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(6px);
      z-index: 10120;
      opacity:0;
      transition: opacity .18s ease;
    }
    .modal.show{ display:flex; opacity:1; animation: modalFade .18s ease; }
    .modal.show .modalBox{ opacity:1; transform: translateY(0) scale(1); }
    .modalBox{
      width:min(520px, 100%);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(10,12,20,.92);
      box-shadow: 0 20px 80px rgba(0,0,0,.55);
      padding: 18px;
      transform: translateY(10px) scale(.985);
      opacity:0;
      transition: transform .18s ease, opacity .18s ease;
    }
    .modalTitle{
      font-weight: 1000;
      font-size: 22px;
      letter-spacing: .2px;
      margin-bottom: 6px;
    }
    .modalSub{
      opacity:.75;
      margin-bottom: 14px;
      font-size: 13px;
    }
    .modalInput{
      width:100%;
      font-size: 22px;
      font-weight: 900;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: inherit;
      outline: none;
    }
    .modalInput:focus{ border-color: rgba(120,180,255,.55); }
    .modalActions{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      margin-top: 14px;
    }
    .btnGhost, .btnOk{
      border-radius: 16px;
      padding: 12px 14px;
      font-weight: 900;
      cursor:pointer;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: inherit;
    }
    .btnOk{
      border-color: rgba(120,180,255,.45);
      background: rgba(120,180,255,.18);
    }

    @media (max-width: 640px) {
      html { font-size: 14px; }
      .wrap { padding: 8px; }
      .card { margin: 8px 0; }
      table td, table th { padding: 6px 8px; font-size: 13px; }
      .badge, .btn { font-size: 12px; padding: 5px 8px; }
      .title { font-size: 18px; }
      .subtitle { font-size: 12px; }
      .card.top { padding: 8px !important; }
      .titleCard { padding: 6px 8px !important; }
      .titlePad { padding: 0 !important; }
      .title {
        font-size: 20px !important;
        margin: 0 0 6px 0 !important;
        line-height: 1.15;
        white-space: normal;
        word-break: break-word;
      }
      .subtitle { gap: 6px !important; flex-wrap: wrap; }
      .chip { font-size: 11px !important; padding: 4px 8px !important; }
    }

    @keyframes pulseDot {
      0%   { transform: scale(1);   opacity: 0.7; }
      50%  { transform: scale(1.3); opacity: 1; }
      100% { transform: scale(1);   opacity: 0.7; }
    }

    .wip{
      --wipColor: #2bff88;
      --wipGlow: rgba(43,255,136,.55);
    }
    .wip .dot{
      background: var(--wipColor);
      box-shadow: 0 0 0 6px rgba(255,255,255,.06), 0 0 18px var(--wipGlow);
      animation: pulseDot 1.2s infinite ease-in-out;
    }

    .bootOverlay{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: radial-gradient(1200px 900px at 20% 20%, rgba(53,242,255,.10), transparent 55%),
                  radial-gradient(1200px 900px at 80% 25%, rgba(255,43,214,.10), transparent 55%),
                  linear-gradient(180deg, rgba(3,4,8,.96), rgba(6,10,18,.96));
      z-index: 10000;
      transition: opacity .45s ease, transform .45s ease;
      opacity:1;
      transform: translate3d(0,0,0);
      pointer-events: auto;
    }
    .bootOverlay.hide{
      opacity:0;
      transform: translate3d(0,-10px,0);
      pointer-events:none;
    }
    .bootBox{
      width:min(860px, 92vw);
      border-radius: 26px;
      border: 1px solid rgba(120,255,255,.22);
      background: rgba(10,14,24,.78);
      box-shadow:
        0 0 0 1px rgba(53,242,255,0.10),
        0 18px 70px rgba(0,0,0,0.65),
        0 0 70px rgba(53,242,255,0.07),
        0 0 90px rgba(255,43,214,0.05);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      padding: 26px 26px 22px;
      position:relative;
      overflow:hidden;
    }
    .bootBox:before{
      content:"";
      position:absolute; inset:-2px;
      background: linear-gradient(90deg, rgba(53,242,255,0.00), rgba(53,242,255,0.18), rgba(255,43,214,0.14), rgba(53,242,255,0.00));
      filter: blur(10px);
      opacity:0.55;
      transform: translate3d(-60%,0,0);
      animation: bootSweep 5.5s linear infinite;
      pointer-events:none;
    }
    @keyframes bootSweep{0%{transform: translate3d(-60%,0,0)}100%{transform: translate3d(60%,0,0)}}
    .bootTitle{
      font-weight: 1000;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      font-size: 28px;
      margin: 0 0 10px 0;
      text-shadow: 0 0 24px rgba(53,242,255,0.16);
      position:relative; z-index:1;
    }
    .bootMsg{
      position:relative; z-index:1;
      font-size: 18px;
      font-weight: 850;
      color: rgba(200,230,255,.78);
      margin: 0 0 16px 0;
      letter-spacing: .3px;
    }
    .bootBar{
      position:relative; z-index:1;
      height: 22px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.05);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.25);
    }
    .bootFill{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(53,242,255,.85), rgba(255,43,214,.75), rgba(255,230,109,.75));
      box-shadow: 0 0 22px rgba(53,242,255,0.18);
      position:relative;
      transition: width .14s linear;
    }
    .bootFill:after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(255,255,255,0.0), rgba(255,255,255,0.35), rgba(255,255,255,0.0));
      transform: translateX(-60%);
      animation: bootScan 1.2s linear infinite;
      mix-blend-mode: overlay;
      opacity: .7;
    }
    @keyframes bootScan{0%{transform: translateX(-60%)}100%{transform: translateX(160%)}}
    .bootPct{
      position:relative; z-index:1;
      margin-top: 12px;
      font-size: 54px;
      font-weight: 1000;
      letter-spacing: 1px;
      font-variant-numeric: tabular-nums;
      text-align: right;
      text-shadow: 0 0 24px rgba(255,43,214,0.10), 0 0 18px rgba(53,242,255,0.10);
    }
    @media (max-width: 820px){
      .bootTitle{ font-size: 20px; }
      .bootMsg{ font-size: 14px; }
      .bootPct{ font-size: 38px; }
      .bootBar{ height: 18px; }
    }
  

/* ===== Mobile UX (scroll page) + Tapo (9:16) — refined ===== */
.tapoCard{ display:none; }
@media (max-width: 820px){
  /* Pagina lunga e scorrevole (mobile), desktop invariato */
  body{ overflow:hidden !important; }
  .wrap{
    height: 100dvh !important;
    min-height: 100dvh;
    overflow:hidden;
    padding: 10px;
    padding-top: calc(env(safe-area-inset-top) + 40px);
    padding-left: calc(env(safe-area-inset-left) + 10px);
    padding-right: calc(env(safe-area-inset-right) + 10px);
    padding-bottom: calc(env(safe-area-inset-bottom) + 10px);
    gap: 10px;
  }
  /* iPhone app-mode: tutto su una pagina (solo TOP + 3 widget) */
  .board, .producedCard, .controls, .footer, .tapoCard{ display:none !important; }
  .mobileWidgets{ flex: 1 1 auto; min-height: 0; }
  .mGrid{ flex: 1 1 auto; min-height: 0; gap: 10px; }
  .mWip, .mDone{ flex: 0 0 auto; padding: 10px 10px; }
  .mWip{ min-height: 112px; }
  .mDone{ min-height: 104px; }
  .mCam{ flex: 1 1 auto; min-height: 0; }
  .mCamBody{ height: 100%; }
  .mKicker{ font-size: 10px !important; }
  .mTimer{ font-size: 11px !important; }
  .mBadge{ width: 28px !important; height: 22px !important; font-size: 12px !important; }
  .mProd{ font-size: 18px !important; }
  .mSub{ font-size: 11px !important; }
  .mStatus{ margin-top: 6px !important; }
  .card.top{ position:relative; isolation:isolate; }
  .titleCard, .weatherCard, .clockCard{ position:relative; z-index:1; }

  /* Card più armoniose su mobile */
  .card{
    border-radius: 16px;
    box-shadow:
      0 0 0 1px rgba(53,242,255,0.08),
      0 12px 26px rgba(0,0,0,0.46),
      0 0 34px rgba(53,242,255,0.04),
      0 0 44px rgba(255,43,214,0.025);
  }

  /* Top layout: titolo full, meteo+orario affiancati (salva spazio, coerente) */
  .card.top{
    padding: 0 !important;
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-areas:
      "title title"
      "weather clock";
    gap: 10px;
  }
  .titleCard{ grid-area:title; min-width:0 !important; }
  .weatherCard{ grid-area:weather; }
  .clockCard{ grid-area:clock; }

  /* Se schermo molto stretto: impila meteo e orario */
  @media (max-width: 420px){
    .card.top{
      grid-template-columns: 1fr;
      grid-template-areas:
        "title"
        "weather"
        "clock";
    }
  }

  /* Titolo: compatto ma importante */
  .titlePad{ padding: 14px 14px !important; }
  .title{
    font-size: 22px !important;
    line-height: 1.12 !important;
    letter-spacing: 0.9px !important;
    margin: 0 0 8px 0 !important;
  }
  .subtitle{ gap: 6px !important; }
  .chip{
    font-size: 11px !important;
    padding: 6px 10px !important;
    letter-spacing: 0.6px !important;
  }
  .liveDot, .wPulse{
    width: 8px !important;
    height: 8px !important;
    box-shadow: 0 0 0 5px rgba(53,242,255,0.10), 0 0 14px rgba(53,242,255,0.18) !important;
  }

  /* Meteo: molto piccolo e leggibile */
  .weatherCard{
    width:100% !important;
    padding: 10px 10px 10px 10px !important;
    gap: 8px !important;
    align-items:flex-start !important;
  }
  .wTitle{ font-size: 11px !important; letter-spacing: .9px !important; }
  .wMain{ gap: 10px !important; }
  .wTemp{ font-size: 34px !important; line-height: 1 !important; }
  .wDesc{ font-size: 13px !important; line-height: 1.1 !important; }
  .wMeta{ font-size: 11px !important; gap: 8px !important; }
  .wPill{ padding: 6px 10px !important; border-radius: 999px !important; }
  .wSmall{ font-size: 10.5px !important; }

  /* Orario: molto piccolo (solo IT, CN già nascosta da JS mobile) */
  .clockCard{
    width:100% !important;
    padding: 10px !important;
    align-items:flex-start !important;
    gap: 8px !important;
  }
  .dateBig{ font-size: 14px !important; letter-spacing: .4px !important; margin: 0 !important; }
  .timeGrid{
    grid-template-columns: 60px 1fr !important;
    gap: 6px 10px !important;
    width:100% !important;
  }
  .timeLabel{ font-size: 10.5px !important; }
  .timeVal{ font-size: 28px !important; line-height: 1.05 !important; }

  
  /* Lista prodotti: non scorrevole, completamente visualizzabile (scroll della pagina) */
  .board{
    height: auto !important;
    flex: 0 0 auto !important;
    min-height: 0 !important;
  }
  .rows{
    max-height: none !important;
    overflow: visible !important;
    -webkit-overflow-scrolling: auto;
    padding-bottom: 0;
  }
  /* Anche su mobile: disattiva lo scroll interno e lascia scorrere solo la pagina */
/* Completati: più compatta e “pulita” */
  .producedCard{ padding: 12px !important; }
  .prodHead{ margin-bottom: 8px !important; }
  .prodTitle{ font-size: 14px !important; }
  .prodHint{ font-size: 11px !important; opacity: .78 !important; }
  .prodList{ max-height: 220px !important; }

  /* Telecamera verticale 9:16 */
  .tapoCard{
    display:block;
    aspect-ratio: 9 / 16;
    width: 100%;
    max-height: 70vh;
  }
  .tapoFrame{
    width:100%;
    height:100%;
    border:0;
    background:#000;
  }
}



/* ===== Mobile App Widgets (desktop invariato) ===== */
.mobileWidgets{ display:none; }
.mSheetBackdrop, .mSheet{ display:none; }

@media (max-width: 820px){
  /* Mobile: pagina fissa stile app */
  body{ overflow:hidden !important; }
  .wrap{
    height: 100vh !important;
    height: 100dvh !important;
    min-height: 100dvh !important;
    padding: calc(10px + env(safe-area-inset-top)) calc(10px + env(safe-area-inset-right)) calc(10px + env(safe-area-inset-bottom)) calc(10px + env(safe-area-inset-left)) !important;
    gap: 10px !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  /* Sistemazione TOP (titolo / meteo / orario) */
  .card.top{
    padding: 0 !important;
    display: grid !important;
    grid-template-columns: 1fr 1fr;
    grid-template-areas:
      "title title"
      "weather clock";
    gap: 10px;
  }
  .titleCard{ grid-area:title; min-width:0 !important; }
  .weatherCard{ grid-area:weather; width:100% !important; }
  .clockCard{ grid-area:clock; width:100% !important; }

  /* Titolo leggibile e stabile */
  .titlePad{ padding: 14px 14px !important; }
  .title{
    font-size: 22px !important;
    line-height: 1.12 !important;
    margin: 0 0 8px 0 !important;
    white-space: normal !important;
  }
  .subtitle{ gap: 6px !important; flex-wrap: wrap; }
  .chip{ font-size: 11px !important; padding: 6px 10px !important; }

  /* Meteo compatto */
  .weatherCard{ padding: 10px !important; gap: 8px !important; }
  .wTitle{ font-size: 11px !important; }
  .wTemp{ font-size: 34px !important; }
  .wDesc{ font-size: 13px !important; }
  .wMeta{ font-size: 11px !important; gap: 8px !important; }
  .wPill{ padding: 6px 10px !important; }

  /* Orario compatto */
  .clockCard{ padding: 10px !important; gap: 8px !important; align-items:flex-start !important; }
  .dateBig{ font-size: 14px !important; margin: 0 !important; }
  .timeGrid{ grid-template-columns: 60px 1fr !important; gap: 6px 10px !important; }
  .timeLabel{ font-size: 10.5px !important; }
  .timeVal{ font-size: 28px !important; line-height: 1.05 !important; }

  /* Spazio per banner fisso */
  .wrap{ padding-top: calc(10px + env(safe-area-inset-top)) !important; }

  /* Nascondi liste desktop */
  .board, #producedCard, .tapoCard{ display:none !important; }

  /* Mostra widgets */
  .mobileWidgets{ display:flex; flex-direction:column; flex: 1 1 auto; min-height:0; }
  /* Layout widgets mobile: FLEX (più stabile su iPhone) */
  .mGrid{
    flex: 1 1 auto;
    min-height: 0;
    display:flex;
    flex-direction:column;
    gap: 10px;
  }
  /* Le prime due schede restano sempre visibili */
  .mWidget.mWip, .mWidget.mDone{
    min-height: 118px;
  }
  /* La camera prende lo spazio residuo */
  .mWidget.mCam{
    flex: 1 1 auto;
    min-height: 200px;
  }

  .mWidget{
    width:100%;
    border-radius: 10px;
    border: 1px solid rgba(120,255,255,.18);
    background: rgba(10,14,24,.82);
    box-shadow:
      0 0 0 1px rgba(53,242,255,0.08),
      0 12px 26px rgba(0,0,0,0.48),
      0 0 34px rgba(53,242,255,0.04),
      0 0 44px rgba(255,43,214,0.02);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    overflow:hidden;
    position:relative;
  }

  button.mWidget{
    cursor: pointer;
    text-align:left;
    color: inherit;
    padding: 12px 12px 10px 12px;
    outline:none;
  }
  button.mWidget:active{ transform: scale(0.995); filter: brightness(1.06); }

  .mHead{
    display:flex;
    align-items:baseline;
    justify-content:space-between;
    gap:10px;
    margin-bottom: 8px;
  }
  .mHeadRight{ display:flex; align-items:baseline; gap:10px; }
  .mBadge{
    min-width: 34px;
    height: 24px;
    padding: 0 10px;
    border-radius: 999px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    font-weight: 1000;
    font-variant-numeric: tabular-nums;
    letter-spacing: .6px;
    font-size: 12px;
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(255,255,255,.08);
    box-shadow: 0 0 14px rgba(53,242,255,.10);
  }

  .mKicker{
    font-weight: 1000;
    letter-spacing: .9px;
    text-transform: uppercase;
    font-size: 12px;
    color: rgba(200,230,255,.78);
  }
  .mTimer, .mCount{
    font-weight: 1000;
    font-variant-numeric: tabular-nums;
    letter-spacing: .6px;
    font-size: 14px;
    opacity: .92;
  }
  .mProd{
    font-weight: 1000;
    font-size: 22px;
    line-height: 1.06;
    letter-spacing: .2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 6px;
    text-shadow: 0 0 16px rgba(53,242,255,0.10);
  }
  .mSub{
    font-size: 13px;
    opacity: .78;
    font-weight: 850;
    letter-spacing: .2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .mStatus{
    margin-top: 12px;
    display:flex;
    align-items:center;
    gap:10px;
    font-weight: 1000;
    letter-spacing: .8px;
    text-transform: uppercase;
    font-size: 12px;
    opacity: .92;
  }
  .mDot{
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: var(--wipColor, #2bff88);
    box-shadow: 0 0 0 6px rgba(255,255,255,.06), 0 0 16px var(--wipGlow, rgba(43,255,136,.45));
    animation: pulseDot 1.2s infinite ease-in-out;
    flex: 0 0 auto;
  }
  .mDot.done{
    background: #ffe66d;
    box-shadow: 0 0 0 6px rgba(43,255,136,.12), 0 0 16px rgba(43,255,136,.40);
    animation: none;
  }

  /* Scorrimento/scan sul widget in produzione */
  .mWip:before{ display:none; }
  .mScan{
    display:inline-block;
    will-change: transform;
  }
  .mScanWrap{
    flex: 1 1 auto;
    min-width: 0;
    overflow: hidden;
  }
  
/* Ticker testo nel widget PRODUZIONE (ex banner) */
.mScanTrack{
  display:flex;
  width:max-content;
  will-change: transform;
  animation: mScanScroll 18s linear infinite;
}
.mScanMarquee{
  flex: 0 0 auto;
  white-space: nowrap;
  padding-right: 42px;
}
@keyframes mScanScroll{
  0%{ transform: translateX(0%); }
  100%{ transform: translateX(-50%); }
}
@media (prefers-reduced-motion: reduce){
  .mScanTrack{ animation:none; transform:none; }
}

/* Camera widget */
  .mCam{ padding: 12px; display:flex; flex-direction:column; gap:10px; }
  .mCamHead{ display:flex; justify-content:space-between; align-items:center; }
  .mCamHint{ font-size: 11px; font-weight: 950; opacity: .8; letter-spacing:.6px; text-transform:uppercase; }
  .mCamBody{
    flex: 1 1 auto;
    min-height: 220px;
    border-radius: 14px;
    overflow:hidden;
    background:#000;
    border: 1px solid rgba(255,255,255,.10);
  }
  .mCamBody iframe{
    width:100%;
    height:100%;
    border:0;
    background:#000;
  }

  /* Bottom sheet */
  .mSheetBackdrop{
    display:block;
    position:fixed; inset:0;
    background: rgba(0,0,0,.62);
    backdrop-filter: blur(6px);
    z-index: 10020;
    opacity:0;
    pointer-events:none;
    transition: opacity .18s ease;
  }
  .mSheetBackdrop.show{
    opacity:1;
    pointer-events:auto;
  }
  .mSheet{
    display:block;
    position:fixed;
    left: 0; right: 0; bottom: 0;
    z-index: 10030;
    background: rgba(10,12,20,.96);
    border-top-left-radius: 22px;
    border-top-right-radius: 22px;
    border: 1px solid rgba(255,255,255,.14);
    box-shadow: 0 -20px 80px rgba(0,0,0,.65);
    transform: translateY(110%);
    transition: transform .22s ease;
    max-height: 84vh;
    display:flex;
    flex-direction:column;
    overflow:hidden;
  }
  .mSheet.show{ transform: translateY(0); }
  .mSheetBar{
    width: 52px;
    height: 5px;
    border-radius: 999px;
    background: rgba(255,255,255,.22);
    margin: 10px auto 8px;
  }
  .mSheetTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding: 10px 14px 12px;
    border-bottom: 1px solid rgba(255,255,255,.10);
  }
  .mSheetTitle{
    font-weight: 1000;
    letter-spacing: .4px;
    font-size: 14px;
    text-transform: uppercase;
    opacity:.92;
  }
  .mSheetClose{
    border-radius: 14px;
    padding: 8px 10px;
    font-weight: 950;
    border: 1px solid rgba(255,255,255,.16);
    background: rgba(255,255,255,.06);
    color: inherit;
    cursor:pointer;
  }
  .mSheetBody{ padding: 12px 14px 16px; overflow:auto; }
  .mSheetActions{
    display:flex;
    gap:10px;
    margin-bottom: 12px;
  }
  .mSheetPrimary, .mSheetGhost{
    flex:1;
    border-radius: 16px;
    padding: 12px 12px;
    font-weight: 1000;
    border: 1px solid rgba(120,180,255,.35);
    background: rgba(120,180,255,.18);
    color: inherit;
    cursor:pointer;
  }
  .mSheetGhost{
    border-color: rgba(255,255,255,.16);
    background: rgba(255,255,255,.06);
  }
  .mSheetList{ display:flex; flex-direction:column; gap:10px; }
  .mItem{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
    padding: 12px 12px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.03);
  }
  .mItemMain{ flex:1; min-width:0; }
  .mItemTitle{
    font-weight: 1000;
    font-size: 14px;
    line-height: 1.15;
    margin-bottom: 4px;
  }
  .mItemSub{
    font-size: 12px;
    opacity:.76;
    font-weight: 850;
    letter-spacing: .2px;
  }
  .mChk{
    width: 18px;
    height: 18px;
    margin-top: 2px;
    accent-color: #35f2ff;
  }

  /* === Mobile theme: più spigoloso / super-tech (desktop invariato) === */
  .card{ border-radius: 12px !important; }
  .modalBox{ border-radius: 12px !important; border-color: rgba(53,242,255,.32) !important; }
  .btnGhost, .btnOk{ border-radius: 10px !important; }
  .sigPadWrap, .sigPreviewWrap{
    border-radius: 6px !important;
    border-color: rgba(53,242,255,.55) !important;
  }
  .sigPadWrap{
    position: relative;
    background:
      repeating-linear-gradient(135deg, rgba(53,242,255,.10) 0px, rgba(53,242,255,.10) 10px, rgba(255,255,255,.05) 10px, rgba(255,255,255,.05) 20px),
      rgba(255,255,255,.92) !important;
  }
  .sigPadWrap::after{
    content:"";
    position:absolute;
    left:-30%;
    top:-40%;
    width:160%;
    height:180%;
    background: radial-gradient(circle at 30% 30%, rgba(53,242,255,.16), transparent 55%);
    animation: techSweep 2.8s linear infinite;
    pointer-events:none;
    mix-blend-mode: overlay;
  }

  /* iPhone: firma senza righe/overlay (massima leggibilità e touch pulito) */
  .sigPadWrap{ background: #ffffff !important; }
  .sigPadWrap::after{ display:none !important; }
  @keyframes techSweep{
    0%{ transform: translateX(-10%) translateY(0); opacity:.25; }
    50%{ transform: translateX(10%) translateY(0); opacity:.45; }
    100%{ transform: translateX(-10%) translateY(0); opacity:.25; }
  }

  .lotExplainWrap{
    margin-top: 10px;
    border: 1px solid rgba(53,242,255,.26);
    border-radius: 10px;
    background: rgba(10,14,24,.28);
    padding: 10px 10px;
  }
  .lotExplainTitle{
    font-size: 11px;
    letter-spacing: .9px;
    opacity: .78;
    margin-bottom: 6px;
  }
  .lotExplainText{
    max-height: 56px;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    font-size: 12px;
    line-height: 1.25;
    opacity: .92;
  }
  .mBackupBox{
    margin-top: 12px;
    border: 1px solid rgba(53,242,255,.22);
    border-radius: 12px;
    padding: 10px 10px;
    background: rgba(10,14,24,.25);
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 10px;
  }
  
  .mDangerBox{
    border-color: rgba(255,120,120,.30);
    background: rgba(60,10,10,.20);
  }
  .mDangerBox .mMiniBtn{
    border-color: rgba(255,120,120,.35);
    background: rgba(255,70,70,.10);
  }
.mBackupNote{
    font-size: 12px;
    opacity: .85;
  }
  .prodLot{
    opacity: .85;
    font-weight: 800;
    font-size: 12px;
    margin-left: 8px;
  }
}

@media (max-width: 420px){
  .mGrid{ grid-template-rows: 1.05fr 0.90fr 2.00fr; }
  .mProd{ font-size: 20px; }
}


/* ===== Firma (mobile) + riepilogo completati ===== */
.mItemTimer{ opacity:.95; }
.sigPadWrap{
  margin-top: 12px;
  border: 1px solid rgba(120,255,255,.22);
  background: rgba(255,255,255,.92);
  border-radius: 14px;
  overflow: hidden;
}
.sigCanvas{
  width: 100%;
  height: 180px;
  display:block;
  touch-action: none;
}
.sigTools{
  display:flex;
  gap:10px;
  margin-top:12px;
  justify-content: space-between;
  flex-wrap: wrap;
}
.confirmRow{
  margin-top: 10px;
  display:flex;
  align-items:center;
  gap:10px;
  font-size: 15px;
  opacity:.95;
}
.confirmRow input{ transform: scale(1.2); }
.sigHint{
  font-size: 12px;
  opacity:.7;
  margin-top: 8px;
}
.mItem.active{
  border-color: rgba(53,242,255,.55);
  box-shadow: 0 0 0 1px rgba(53,242,255,.22), 0 10px 30px rgba(53,242,255,.10);
}
.mItem.selected{
  border-color: rgba(255,230,109,.65);
  box-shadow: 0 0 0 1px rgba(255,230,109,.22), 0 10px 30px rgba(255,230,109,.10);
}
.mMiniBtn{
  border:1px solid rgba(120,255,255,.22);
  background: rgba(10,14,24,.35);
  color: var(--text);
  border-radius: 12px;
  padding: 10px 12px;
  font-weight:700;
  font-size: 13px;
}
.mMiniBtn:active{ transform: scale(.98); }
.sigPreviewWrap{
  margin-top: 12px;
  border: 1px solid rgba(120,255,255,.22);
  background: rgba(255,255,255,.92);
  border-radius: 14px;
  overflow: hidden;
}
.sigImg{
  width: 100%;
  display:block;
}



/* ===== Mobile ticker + theme toggle (solo mobile) ===== */
.mBanner{ display:none; }
@media (max-width: 820px){
  .mBanner{
    display:flex;
    align-items:center;
    gap:10px;
    position: fixed;
    left: 0;
    right: 0;
    top: 0;
    height: calc(env(safe-area-inset-top) + 28px);
    padding: calc(env(safe-area-inset-top)) 10px 0 10px;
    border: 0;
    border-radius: 0;
    z-index: 10090;
    overflow:hidden;
    background: #ffe66d;
    color: #0b0f14;
    box-shadow: 0 6px 18px rgba(0,0,0,.25);
  }
  .mBanner.red{ background:#ff4d4d; }
  .mBanner.yellow{ background:#ffe66d; }
  .mBannerText{ flex:1; min-width:0; overflow:hidden; font-style: normal; font-weight: 1000; letter-spacing:1.2px; text-transform: uppercase; font-family: "Stardos Stencil","Black Ops One","Stencil Std","Bahnschrift","Impact",system-ui; }
  .mBannerTrack{
    display:flex;
    width:max-content;
    will-change: transform;
    animation: mBannerTrackScroll 18s linear infinite;
  }
  .mBannerMarquee{
    display:inline-block;
    flex: 0 0 auto;
    white-space: nowrap;
    font-style: normal;
    font-weight: 1000;
    letter-spacing: 1.2px;
    padding-right: 42px; /* distanza tra ripetizioni */
  }
  @keyframes mBannerTrackScroll{
    0%{ transform: translateX(0%); }
    100%{ transform: translateX(-50%); }
  }
  @media (prefers-reduced-motion: reduce){
    .mBannerTrack{ animation:none; transform:none; }
  }
}




/* Camera config button + video */
.mCamRight{ display:flex; align-items:center; gap:10px; }
.camCfgBtn{
  width: 34px;
  height: 30px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.38);
  color: rgba(255,255,255,.92);
  font-weight: 1000;
  letter-spacing: .5px;
  cursor: pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow: 0 10px 22px rgba(0,0,0,.25);
}
.camCfgBtn:active{ transform: translateY(1px); }
.mCamVideo{
  width:100%;
  height:100%;
  display:none; /* attivato quando usi URL .m3u8 */
  background:#000;
}

/* ===== Telecamera offline overlay (mobile) ===== */
.mCamBody{ position:relative; }
.mCamOverlay{
  position:absolute;
  inset: 0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 14px;
  text-align:center;
  font-weight: 1000;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: rgba(255,255,255,.90);
  background: linear-gradient(180deg, rgba(0,0,0,.72), rgba(0,0,0,.85));
  border: 1px dashed rgba(255,255,255,.20);
  border-radius: 14px;
}

/* ===== Modal layering: sempre sopra ai popup mobile ===== */
@media (max-width: 820px){
  .modal{ z-index: 10120; }
}

/* Firma: full width, “orizzontale” e più qualità su mobile */
@media (max-width: 820px){
  /* Firma: popup grande come riquadro firma (non full-screen) */
  #sigModal .modalBox{
    width: calc(100vw - 16px);
    max-width: 520px;
    max-height: calc(100dvh - 16px);
    height: auto;
    padding: 12px;
    display:flex;
    flex-direction: column;
    overflow:auto;
  }
  #sigModal .sigPadWrap{
    margin-top: 10px;
  }
  #sigModal .sigCanvas{
    height: 260px;
  }
  #sigModal .sigTools{ margin-top: 10px; }
  #doneModal .modalBox{ width: calc(100vw - 16px); max-width:none; }
}
@media (min-width: 821px){
  #donePrint, #doneShare{ display:none !important; }
}


  /* Completati: pallino colore diverso */
  .mDot.done{
    background: #ff2bd6;
    box-shadow: 0 0 0 6px rgba(255,43,214,.12), 0 0 16px rgba(255,43,214,.40);
  }

  /* Tema mobile ancora più spigoloso */
  .mWidget, .card{ border-radius: 10px !important; }
  .mWidget, .card{ clip-path: polygon(0 0, calc(100% - 10px) 0, 100% 10px, 100% 100%, 10px 100%, 0 calc(100% - 10px)); }



/* ===== PATCH 2025-12-21 (mobile corners + meteo overlap fix) ===== */
@media (max-width: 820px){
  /* Banner con angoli (sotto) */
  .mBanner{
    border-radius: 0 0 16px 16px !important;
  }

  /* Riporta i bordi arrotondati (disattiva il clip-path spigoloso) */
  .mWidget, .card{
    border-radius: 16px !important;
    clip-path: none !important;
    -webkit-clip-path: none !important;
    overflow: visible !important;
    mask-image: none !important;
    -webkit-mask-image: none !important;
  }

  /* TOP: su mobile evita che il contenitore grande copra meteo/orario */
  .card.top{
    background: transparent !important;
    border: 0 !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    overflow: visible !important;
  }

  /* Rendi il blocco titolo una vera card (così gli angoli tornano e non invade gli altri) */
  .titleCard{
    border-radius: 16px !important;
    overflow: hidden !important;
    background: var(--panel) !important;
    border: 1px solid var(--line) !important;
    box-shadow:
      0 0 0 1px rgba(53,242,255,0.08),
      0 12px 26px rgba(0,0,0,0.46),
      0 0 34px rgba(53,242,255,0.04),
      0 0 44px rgba(255,43,214,0.025) !important;
  }
  .titleGrid{ border-radius: 16px !important; }

  /* Meteo e orario sempre sopra al titolo (niente coperture) */
  .weatherCard, .clockCard{
    position: relative !important;
    z-index: 6 !important;
  }

  /* Widget mobile: angoli più evidenti */
  .mWidget{
    border-radius: 16px !important;
    clip-path: none !important;
    -webkit-clip-path: none !important;
  }
}

/* ===== MOBILE REDESIGN (iPhone) — 2025-12-21 ===== */
/* Obiettivo: una sola pagina “app mode” su iPhone, niente sovrapposizioni, angoli puliti, camera grande.
   Logiche/JS invariati: tocchiamo solo CSS. */
@media (max-width: 820px){
  /* Fullscreen app feel */
  html, body{ height:100%; }
  body{ overflow:hidden !important; overscroll-behavior: none; -webkit-text-size-adjust: 100%; }
  .wrap{
    height: 100dvh !important;
    min-height: 100dvh !important;
    padding: calc(env(safe-area-inset-top) + 10px) calc(env(safe-area-inset-right) + 10px)
             calc(env(safe-area-inset-bottom) + 10px) calc(env(safe-area-inset-left) + 10px) !important;
    gap: 10px !important;
    overflow-y:auto !important;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }

  /* Niente banner su mobile */
  .mBanner{ display:none !important; }

  /* Desktop sections OFF su mobile */
  .board, #producedCard, .producedCard, .controls, .footer, .tapoCard{ display:none !important; }

  /* Cards: niente clip-path (è quello che “mangiava” i bordi) */
  .card, .mWidget{
    clip-path: none !important;
    border-radius: 14px !important;
  }
  .card{
    box-shadow:
      0 0 0 1px rgba(53,242,255,0.10),
      0 14px 34px rgba(0,0,0,0.52),
      0 0 42px rgba(53,242,255,0.06) !important;
  }

  /* TOP: stabile e leggibile */
  .card.top{ flex: 0 0 auto; padding: 0 !important; }
  .title{ font-size: 22px !important; line-height: 1.10 !important; letter-spacing: 0.8px !important; }
  .chip{ font-size: 11px !important; padding: 6px 10px !important; }
  .wTemp{ font-size: 34px !important; }
  .timeVal{ font-size: 28px !important; }

  /* MOBILE WIDGETS: 3 blocchi, camera prende lo spazio restante */
  #mobileWidgets{ display:flex !important; flex-direction:column; flex:1 1 auto; min-height:0; }
  .mGrid{
    display:flex !important;
    flex-direction:column;
    flex:1 1 auto;
    min-height:0;
    gap: 10px !important;
  }

  /* WIP / DONE compatti e tappabili */
  button.mWidget{
    padding: 12px 12px 10px 12px !important;
    -webkit-tap-highlight-color: transparent;
  }
  .mWidget.mWip{ flex: 0 0 auto; min-height: 124px !important; }
  .mWidget.mDone{ flex: 0 0 auto; min-height: 112px !important; }

  /* Evita che lo “scorrimento” tocchi il pallino */
  .mStatus{ display:flex; align-items:center; gap: 10px !important; }
  .mDot{ flex: 0 0 auto; }
  .mScanWrap{ flex:1 1 auto; min-width:0; overflow:hidden; }
  .mScanTrack{ display:flex; width:max-content; }
  .mScanMarquee{ padding-right: 40px !important; }
  .mProd{ font-size: 18px !important; }
  .mSub{ font-size: 11px !important; opacity: .88 !important; }
  .mTimer{ font-size: 11px !important; }
  .mBadge{ min-width: 34px !important; height: 24px !important; font-size: 12px !important; }

  /* CAMERA: grande, sempre visibile */
  .mWidget.mCam{
    flex: 1 1 auto;
    min-height: 240px !important;
    display:flex;
    flex-direction:column;
    padding: 12px !important;
  }
  .mCamHead{ flex: 0 0 auto; }
  .mCamBody{
    flex: 1 1 auto;
    min-height: 0;
    margin-top: 10px;
    border-radius: 12px;
    overflow:hidden;
    background:#000;
    position:relative;
  }
  .mCamBody iframe{
    width:100% !important;
    height:100% !important;
    border:0 !important;
  }
  .mCamOverlay{ border-radius: 12px !important; }
}

/* ===== Telecamera: widget -> tasto + popup full-screen ===== */
@media (max-width: 820px){
  .mCamBtn{
    -webkit-appearance:none;
    appearance:none;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
    min-height: 58px;
    padding: 10px 12px;
    width: 100%;
    text-align:left;
    cursor:pointer;
  }
  .mCamBtnLeft{ display:flex; flex-direction:column; gap:4px; min-width:0; }
  .mCamBtnRight{ display:flex; align-items:center; gap:10px; }
  .mCamBtnOpen{
    width: 34px;
    height: 30px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.22);
    color: rgba(255,255,255,.92);
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 10px 22px rgba(0,0,0,.22);
    font-weight: 1000;
  }
  .mCamBtn:active{ transform: translateY(1px); }
}

/* popup telecamera */
.camViewModal{ z-index: 10180; }
#camViewModal .modalBox.camViewBox{
  width: 100vw;
  border: 0;
  max-width: none;
  height: 100dvh;
  max-height: none;
  padding: 0;
  border-radius: 0;
  overflow: hidden;
}
#camViewModal .camViewTop{
  height: calc(env(safe-area-inset-top) + 52px);
  padding: calc(env(safe-area-inset-top) + 10px) 12px 10px 12px;
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
  border-bottom: 1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
}
#camViewModal .camViewTitle{
  font-weight: 1100;
  letter-spacing: 1.2px;
  text-transform: uppercase;
}
#camViewModal .camViewBtns{ display:flex; align-items:center; gap:10px; }
#camViewModal .camViewClose{
  width: 40px;
  height: 34px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.38);
  color: rgba(255,255,255,.92);
  font-weight: 1000;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow: 0 10px 22px rgba(0,0,0,.25);
}
#camViewModal .camViewClose:active{ transform: translateY(1px); }

#camViewModal .camViewStage{
  height: calc(100dvh - (env(safe-area-inset-top) + 52px));
  width: 100%;
  background: #000;
}
#camViewModal .camViewBody{
  height: 100%;
  width: 100%;
  position: relative;
  overflow: hidden;
}
#camViewModal .camViewVideo{
  width: 100%;
  height: 100%;
}
#camViewModal .camViewVideo.camViewBg{
  position: absolute;
  inset: 0;
  object-fit: cover;
  filter: blur(18px) brightness(.55) saturate(1.12);
  transform: scale(1.08);
  z-index: 1;
}
#camViewModal .camViewVideo.camViewFg{
  position: relative;
  object-fit: contain;
  background: transparent;
  z-index: 2;
}

/* Rotazione feed (bande in 9:16 / portrait) */
#camViewModal .camViewBody{
  --camStageW: 100vw;
  --camStageH: 100dvh;
}
#camViewModal .camViewBody.camRot90 .camViewVideo,
#camViewModal .camViewBody.camRot90 iframe{
  position: absolute;
  top: 50%;
  left: 50%;
  width: var(--camStageH);
  height: var(--camStageW);
  transform: translate(-50%, -50%) rotate(-90deg);
  transform-origin: center center;
}
#camViewModal .camViewBody.camRot90 .camViewVideo.camViewBg{
  /* mantiene l'effetto blur ma coerente con la rotazione */
  filter: blur(18px) brightness(.55) saturate(1.12);
  transform: translate(-50%, -50%) rotate(-90deg) scale(1.08);
  z-index: 1;
}
#camViewModal .camViewBody.camRot90 .camViewVideo.camViewFg{
  /* primo piano: niente tagli aggressivi, ma senza bande nere (sfondo blur sotto) */
  object-fit: contain;
  background: transparent;
  z-index: 2;
}
#camViewModal .camViewOverlay{
  z-index: 3;
  border-radius: 0;
  border-left: 0;
  border-right: 0;
  border-top: 0;
  border-bottom: 0;
}

/* =========================================================
   THEME 2025-12-21 — HUB LINEA POLVERI
   Solo look&feel (CSS). Nessuna logica/JS toccata.
   ========================================================= */
:root{
  --bg0:#070708; --bg1:#111214;
  --panel: rgba(12,14,16,.86);
  --line: rgba(255,255,255,.14);
  --text:#f4f7f8;

  /* Accenti “polveri”: freddo/industriale + sicurezza */
  --neonCyan:#7ad7ff;   /* powder blue */
  --neonMag:#ffb15c;    /* safety amber */
  --neonYel:#ffd66d;    /* warm highlight */
  --todo:#7ad7ff;
  --done:#7dff9b;
}

/* Fondo più “impianto polveri” (grafite + polvere sospesa) */
body{
  background:
    radial-gradient(1200px 900px at 15% 12%, rgba(122,215,255,.10), transparent 60%),
    radial-gradient(1100px 900px at 88% 18%, rgba(255,177,92,.08), transparent 60%),
    radial-gradient(1200px 900px at 70% 92%, rgba(125,255,155,.06), transparent 60%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
}
body:before{ opacity:.14; }

/* “Dust/grain” leggero sopra */
body:after{
  content:"";
  position:fixed; inset:0;
  background-image:
    radial-gradient(circle at 12% 18%, rgba(255,255,255,.030) 0 1px, transparent 2px),
    radial-gradient(circle at 62% 44%, rgba(255,255,255,.022) 0 1px, transparent 2px),
    radial-gradient(circle at 84% 76%, rgba(255,255,255,.018) 0 1px, transparent 2px),
    radial-gradient(circle at 24% 82%, rgba(255,255,255,.014) 0 1px, transparent 2px);
  background-size: 160px 160px, 220px 220px, 260px 260px, 300px 300px;
  opacity:.55;
  mix-blend-mode: overlay;
  pointer-events:none;
  z-index:1;
}

/* Tipografia più “quadro elettrico” */
html,body{ font-family: "Bahnschrift","DIN Alternate","Segoe UI",system-ui,-apple-system,Roboto,Arial; }

/* Cards: più industrial, meno “neon” */
.card{
  border-radius: 14px;
  border-color: rgba(255,255,255,.16);
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.05),
    0 18px 44px rgba(0,0,0,0.58),
    0 0 46px rgba(122,215,255,0.05);
}
.card:after{
  content:"";
  position:absolute; inset:0;
  border-radius:inherit;
  background: linear-gradient(180deg, rgba(255,255,255,.065), transparent 32%);
  opacity:.75;
  pointer-events:none;
  mix-blend-mode: overlay;
}

/* Titolo: più “HUB” */
.title{
  text-shadow: 0 0 22px rgba(122,215,255,.10);
  letter-spacing: 1.0px;
}
.subtitle{ color: rgba(220,235,245,.72); }

/* Header tabella */
.header{
  background: rgba(255,255,255,0.035);
  border-bottom-color: rgba(255,255,255,.16);
}

/* Badge: look “safety” */
.badge{
  border-color: rgba(255,255,255,.18);
  background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  box-shadow: 0 0 16px rgba(0,0,0,.22);
}
.badge.todo{ border-color: rgba(122,215,255,.30); }
.badge.done{ border-color: rgba(125,255,155,.32); }
.dot{ box-shadow: 0 0 0 6px rgba(255,255,255,.08); }

/* Boot overlay coerente col nuovo tema */
.bootOverlay{
  background:
    radial-gradient(1200px 900px at 18% 18%, rgba(122,215,255,.12), transparent 60%),
    radial-gradient(1200px 900px at 82% 22%, rgba(255,177,92,.10), transparent 60%),
    linear-gradient(180deg, rgba(5,6,7,.96), rgba(12,14,16,.96));
}
.bootBox{
  border-color: rgba(255,255,255,.18);
  background: rgba(12,14,16,.82);
}
.bootFill{
  background: linear-gradient(90deg, rgba(122,215,255,.90), rgba(255,177,92,.82), rgba(125,255,155,.78));
}

/* Mobile: stessi accenti, pulito */
@media (max-width: 820px){
  .mWidget{
    border-color: rgba(255,255,255,.16);
    background: rgba(12,14,16,.86);
    border-radius: 14px !important;
  }
  .mBadge{
    border-color: rgba(255,255,255,.18);
    background: rgba(255,255,255,.08);
  }
  .mDot{
    box-shadow: 0 0 0 6px rgba(255,255,255,.08), 0 0 16px rgba(122,215,255,.25);
  }
  .mDot.done{
    box-shadow:  0 0 0 6px rgba(255,255,255,.08), 0 0 16px rgba(125,255,155,.25);
  }
  .mCamBody{
    border-color: rgba(255,255,255,.12);
  }
}


/* =========================================================
   APPLE LIGHT THEME (2025-12-21)
   Obiettivo: sfondi bianchi, testi neri, stile Apple.
   SOLO look&feel: nessuna logica/JS toccata.
   ========================================================= */
:root{
  --bg0:#f2f2f5 !important;
  --bg1:#fafafc !important;
  --panel:#ffffff !important;
  --line:rgba(0,0,0,.12) !important;
  --text:#111111 !important;

  /* Accenti “iOS” */
  --neonCyan:#007aff !important;   /* iOS blue */
  --neonMag:#af52de !important;    /* iOS purple */
  --neonYel:#ffcc00 !important;    /* iOS yellow */
  --todo:#007aff !important;
  --done:#34c759 !important;       /* iOS green */
}

/* Base */

/* Base */
html,body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Display","SF Pro Text", Segoe UI, Roboto, Arial !important;
}
body{
  background: linear-gradient(180deg, var(--bg0), var(--bg1)) !important;
  color: var(--text) !important;
}
body:before{ display:none !important; }

/* Cards */
.card{
  background: var(--panel) !important;
  border: 1px solid var(--line) !important;
  box-shadow: 0 1px 2px rgba(0,0,0,.06), 0 10px 30px rgba(0,0,0,.10) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* Disattiva “cyber glow” in modo pulito */
.titleCard:before, .bootBox:before, .titleGrid{ display:none !important; }
.title, .timeVal, .wTemp, .product, .qty{ text-shadow: none !important; }

/* Titoli & testi */
.title{
  color: #111 !important;
  letter-spacing: .4px !important;
}
.subtitle, .timeLabel, .wTitle, .wDesc, .wMeta, .fmt{
  color: rgba(17,17,17,.70) !important;
}
.wSmall{ color: rgba(17,17,17,.55) !important; }

/* Chip */
.chip, .wPill{
  background: #f2f2f7 !important;
  border: 1px solid rgba(0,0,0,.10) !important;
  color: rgba(17,17,17,.85) !important;
  box-shadow: none !important;
}
.liveDot{
  background: var(--neonCyan) !important;
  box-shadow: 0 0 0 6px rgba(0,122,255,.14) !important;
}
.wPulse{
  background: var(--neonMag) !important;
  box-shadow: 0 0 0 6px rgba(175,82,222,.12) !important;
}

/* Board */
.header{
  background: #f7f7fa !important;
  color: rgba(17,17,17,.70) !important;
  border-bottom: 1px solid rgba(0,0,0,.08) !important;
}
.row{
  border-bottom: 1px solid rgba(0,0,0,.06) !important;
}
.badge{
  background: #f2f2f7 !important;
  border: 1px solid rgba(0,0,0,.10) !important;
  box-shadow: none !important;
  color: rgba(17,17,17,.88) !important;
}
.dot{
  background: var(--todo) !important;
  box-shadow: 0 0 0 6px rgba(0,122,255,.12) !important;
}
.badge.done .dot{
  background: var(--done) !important;
  box-shadow: 0 0 0 6px rgba(52,199,89,.14) !important;
}
.badge.wip .dot{
  background: #ff9f0a !important; /* iOS orange */
  box-shadow: 0 0 0 6px rgba(255,159,10,.14) !important;
}

/* “Completati” */
.producedCard, .prodItem{
  background: #ffffff !important;
  border-color: rgba(0,0,0,.10) !important;
}
.prodEmpty{
  border-color: rgba(0,0,0,.18) !important;
  color: rgba(17,17,17,.70) !important;
}


.modalTitle{ color:#111 !important; }
/* Modals */
.modal{
  background: rgba(0,0,0,.38) !important;
}
.modalBox{
  background: #ffffff !important;
  border: 1px solid rgba(0,0,0,.12) !important;
  box-shadow: 0 30px 90px rgba(0,0,0,.20) !important;
  color: var(--text) !important;
}
.modalSub{ color: rgba(17,17,17,.65) !important; }
.modalInput{
  background: #ffffff !important;
  color: #111 !important;
  border: 1px solid rgba(0,0,0,.16) !important;
}
.modalInput:focus{ border-color: rgba(0,122,255,.55) !important; }

/* Camera view popup: light (anche su desktop) */
#camViewModal .camViewTop{
  background: rgba(242,242,245,.92) !important;
  border-bottom: 1px solid rgba(0,0,0,.12) !important;
  color: #111 !important;
}
#camViewModal .camViewTitle{ color:#111 !important; }
#camViewModal .camCfgBtn{
  background: #ffffff !important;
  border: 1px solid rgba(0,0,0,.14) !important;
  color: #111 !important;
  box-shadow: 0 10px 22px rgba(0,0,0,.10) !important;
}
#camViewModal .camViewClose{
  background: #ffffff !important;
  border: 1px solid rgba(0,0,0,.14) !important;
  color: #111 !important;
  box-shadow: 0 10px 22px rgba(0,0,0,.10) !important;
}

.btnGhost{
  background: #f2f2f7 !important;
  border: 1px solid rgba(0,0,0,.12) !important;
  color: #111 !important;
}
.btnOk{
  background: var(--neonCyan) !important;
  border-color: var(--neonCyan) !important;
  color: #fff !important;
}

/* Firma: look pulito */
.sigPadWrap, .sigPreviewWrap{
  background: #ffffff !important;
  border: 1px solid rgba(0,0,0,.14) !important;
}

/* Boot overlay (loading) -> light */
.bootOverlay{
  background: rgba(245,245,247,.96) !important;
}
.bootBox{
  background: #ffffff !important;
  border: 1px solid rgba(0,0,0,.12) !important;
  box-shadow: 0 30px 90px rgba(0,0,0,.18) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
.bootTitle{ color:#111 !important; text-shadow:none !important; }
.bootMsg{ color: rgba(17,17,17,.70) !important; }
.bootBar{
  border: 1px solid rgba(0,0,0,.12) !important;
  background: #f2f2f7 !important;
}
.bootFill{
  background: linear-gradient(90deg, #007aff, #34c759) !important;
  box-shadow: none !important;
}
.bootPct{ color:#111 !important; text-shadow:none !important; }

/* Mobile widgets: Apple-ish */
@media (max-width: 820px){
  .mWidget{
    background: #ffffff !important;
    border: 1px solid rgba(0,0,0,.12) !important;
    box-shadow: 0 1px 2px rgba(0,0,0,.06), 0 10px 30px rgba(0,0,0,.10) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    color: #111 !important;
  }
  .mKicker, .mSub{ color: rgba(17,17,17,.70) !important; }
  .mBadge{
    background: #f2f2f7 !important;
    border: 1px solid rgba(0,0,0,.12) !important;
    box-shadow: none !important;
  }
  .mDot{
    background: var(--todo) !important;
    box-shadow: 0 0 0 6px rgba(0,122,255,.14) !important;
    animation: none !important; /* stile Apple: niente lampeggi aggressivi */
  }
  .mDot.done{
    background: var(--done) !important;
    box-shadow: 0 0 0 6px rgba(52,199,89,.14) !important;
  }

  /* Camera button/popup top bar: chiaro */
  #camViewModal .camViewTop{
    background: rgba(245,245,247,.92) !important;
    border-bottom: 1px solid rgba(0,0,0,.12) !important;
    color: #111 !important;
  }
  #camViewModal .camViewClose{
    background: #ffffff !important;
    border: 1px solid rgba(0,0,0,.14) !important;
    color: #111 !important;
    box-shadow: 0 10px 22px rgba(0,0,0,.10) !important;
  }
}



    /* ===== Easyfatt XML Orders (Drive) ===== */
    .xmlOrdersCard{ margin-top: 14px; padding: 14px; }
    .xmlHead{ display:flex; align-items:baseline; justify-content:space-between; gap:12px; margin-bottom:6px; }
    .xmlTitle{ font-weight:900; letter-spacing:.4px; }
    .xmlStatus{ font-size:12px; opacity:.8; white-space:nowrap; }
    .xmlHint{ font-size:12px; opacity:.72; margin-bottom:10px; }
    .xmlList{ display:flex; flex-direction:column; gap:10px; max-height: 220px; overflow:auto; padding-right:4px; }
    .xmlEmpty{ opacity:.65; font-size:13px; padding: 10px 8px; border:1px dashed rgba(255,255,255,.18); border-radius: 14px; }
    .xmlCustRow{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 12px;
      border:1px solid rgba(120,255,255,.18);
      border-radius:16px;
      background: rgba(10,14,24,.60);
      cursor:pointer;
      transition: transform .08s ease, filter .12s ease;
    }
    .xmlCustRow:hover{ filter: brightness(1.06); }
    .xmlCustRow:active{ transform: scale(.99); }
    .xmlCustName{ font-weight:800; }
    .xmlCustMeta{ font-size:12px; opacity:.8; text-align:right; }
    .xmlPill{ display:inline-flex; align-items:center; gap:6px; padding: 2px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.16); font-size:12px; opacity:.9; }
    .xmlDot{ width:8px; height:8px; border-radius:999px; background: var(--neonCyan); box-shadow: 0 0 12px rgba(53,242,255,.7); }
    .xmlModalList{ max-height: 52vh; overflow:auto; margin-top:10px; padding-right:4px; display:flex; flex-direction:column; gap:8px; }
    .xmlLine{
      display:flex; gap:10px; align-items:flex-start;
      border:1px solid rgba(255,255,255,.14);
      border-radius:16px;
      padding:10px 10px;
      background: rgba(10,14,24,.52);
    }
    .xmlChk{ margin-top: 4px; transform: scale(1.1); }
    .xmlLineMain{ flex:1; min-width:0; }
    .xmlLineDesc{ font-size:13px; line-height:1.25; font-weight:750; }
    .xmlLineSub{ margin-top:4px; font-size:12px; opacity:.78; display:flex; flex-wrap:wrap; gap:8px; }
    .xmlLineSub b{ opacity:.95; }
    .sigYes{ display:flex; align-items:center; gap:10px; margin-top:10px; font-size:13px; opacity:.9; }
    #xmlSigCanvas{ width:100%; height:180px; border-radius:14px; background: rgba(255,255,255,.04); border:1px solid rgba(120,255,255,.16); touch-action:none; }


/* ====== Layout HUB EasyFatt (solo XML) ====== */
.mainGrid{
  display:grid;
  grid-template-columns: 3fr 1fr;
  gap: 14px;
  margin-top: 14px;
  align-items: stretch;
}
.mainGrid > .card{ min-height:0; }
#xmlOrdersCard{ min-height:0; }
#producedCard{ min-height:0; }

#xmlCustomersList{ overflow:auto; max-height: calc(100vh - 240px); }
#producedList{ overflow:auto; max-height: calc(100vh - 240px); }

/* Hide legacy widgets/cards that are not used in the EasyFatt hub layout */
#mobileWidgets{ display:none !important; }
#tapoCard{ display:none !important; }

@media (max-width: 820px){
  .mainGrid{
    grid-template-columns: 1fr;
    grid-template-rows: auto auto;
    gap: 12px;
  }
  #xmlOrdersCard{
    height: 72dvh;
  }
  #producedCard{
    height: 24dvh;
  }
  #xmlCustomersList{ max-height:none; height: calc(72dvh - 130px); }
  #producedList{ max-height:none; height: calc(24dvh - 98px); }

  /* iPhone safe areas */
  body{ padding-bottom: env(safe-area-inset-bottom); }
}

</style>
</head>
<body>
<!-- BOOT OVERLAY -->
<div aria-hidden="false" class="bootOverlay" id="bootOverlay">
<div class="bootBox">
<div class="bootTitle">AVVIO SISTEMA</div>
<div class="bootMsg" id="bootMsg">Inizializzazione…</div>
<div class="bootBar"><div class="bootFill" id="bootFill"></div></div>
<div class="bootPct" id="bootPct">0%</div>
</div>
</div>
<div class="wrap">
<div class="card top" style="padding:0">
<div class="titleCard">
<div class="titleGrid"></div>
<div class="titlePad">
<p class="title">HUB LINEA POLVERI</p>
<div class="subtitle">
<span class="chip live"><span class="liveDot"></span>LIVE</span>
<span class="chip">Aggiornamento: 60s</span>
<span class="chip">Versione: 2025-12-21 10:17:19 UTC</span>
</div>
</div>
</div>
<div class="card weatherCard">
<div class="wTitle"><span class="wPulse"></span>METEO • Cerea (VR)</div>
<div class="wMain">
<div class="wTemp" id="wTemp">--°</div>
<div>
<div class="wDesc" id="wDesc">Carico…</div>
<div class="wSmall" id="wUpdated">—</div>
</div>
</div>
<div class="wMeta">
<div class="wPill">Vento <span id="wWind">—</span> km/h</div>
<div class="wPill">Pioggia <span id="wRain">—</span>% (1h)</div>
</div>
<div class="wSmall">Auto-update meteo: 10 min</div>
</div>
<div class="card clockCard">
<p class="dateBig" id="dateLine">----</p>
<div class="timeGrid">
<div class="timeLabel">ITALIA</div><div class="timeVal" id="timeIT">--:--</div>
<div class="timeLabel">中国</div><div class="timeVal" id="timeCN">--:--</div>
</div>
</div>
</div><div class="mainGrid" id="mainGrid"><div class="card xmlOrdersCard" id="xmlOrdersCard">
<div class="xmlHead">
<div class="xmlTitle">Ordini clienti (Easyfatt XML)</div>
<div class="xmlStatus" id="xmlStatus">Drive: —</div>
</div>
<div class="xmlHint">
      Fonte: cartella Drive condivisa • file <b>Documenti.DefXml</b> • aggiornamento automatico.
    </div>
<div class="xmlList" id="xmlCustomersList">
<div class="xmlEmpty" id="xmlEmpty">In attesa ordini…</div>
</div>
</div><div class="card producedCard" id="producedCard">
<div class="prodHead">
<div class="prodTitle">Completati EasyFatt (cloud)</div>
<div class="prodHint">Sincronizzato su tutti i dispositivi</div>
</div>
<div class="prodList" id="producedList">
<div class="prodEmpty" id="producedEmpty">Nessuna riga completata.</div>
</div>
</div></div>
<!-- Mobile-only widgets (desktop invariato) -->
<div aria-hidden="true" class="mobileWidgets" id="mobileWidgets">
<div class="mGrid">
<button class="mWidget mWip" id="mWipBtn" type="button">
<div class="mHead">
<div class="mKicker">PRODUZIONE</div>
<div class="mHeadRight">
<div class="mTimer" id="mWipTimer">⏱ —</div>
<div class="mBadge" id="mWipRemainBadge" title="Articoli rimanenti">0</div>
</div>
</div>
<div class="mProd" id="mWipProd">—</div>
<div class="mSub" id="mWipSub">—</div>
<div class="mStatus">
<span aria-hidden="true" class="mDot"></span>
<span class="mScanWrap"><span class="mScanTrack" id="mWipTrack">
<span class="mScanMarquee" id="mWipScan">—</span>
<span aria-hidden="true" class="mScanMarquee" id="mWipScan2">—</span>
</span></span>
</div>
</button>
<button class="mWidget mDone" id="mDoneBtn" type="button">
<div class="mHead">
<div class="mKicker">COMPLETATI</div>
<div class="mCount" id="mDoneCount">0</div>
</div>
<div class="mProd" id="mDoneLast">SCARICA BACKUP</div>
<div class="mSub" id="mDoneSub">Righe completate: 0</div>
<div class="mStatus">
<span aria-hidden="true" class="mDot done"></span>
<span class="mScan" id="mDoneScan">ULTIMO COMPLETATO</span>
</div>
</button>
<!-- Telecamera: tasto (apre popup full-screen) -->
<div aria-label="Apri telecamera" class="mWidget mCamBtn" id="mCamBtn" role="button" tabindex="0">
<div class="mCamBtnLeft">
<div class="mKicker">TELECAMERA</div>
<div class="mCamHint" id="mCamHint">—</div>
</div>
<div class="mCamBtnRight">
<button aria-label="Impostazioni telecamera" class="camCfgBtn" id="camCfgBtn" type="button">⚙︎</button>
<div aria-hidden="true" class="mCamBtnOpen">⤢</div>
</div>
</div>
</div>
</div>

<!-- ORDINI CLIENTI (Easyfatt XML da Google Drive) -->


<!-- Mobile-only Tapo Camera (9:16) -->
<div aria-hidden="true" class="card tapoCard" id="tapoCard">
<!-- Inserisci qui l'URL stream/iframe Tapo (bridge/proxy) -->
<iframe allow="autoplay; encrypted-media" class="tapoFrame" playsinline="" src="about:blank"></iframe>
</div>
</div>
<!-- Popup Telecamera (full-screen 9:16 su mobile) -->
<div aria-hidden="true" class="modal camViewModal" id="camViewModal">
<div aria-label="Telecamera" aria-modal="true" class="modalBox camViewBox" role="dialog">
<div class="camViewTop">
<div class="camViewTitle">TELECAMERA</div>
<div class="camViewBtns">
<button aria-label="Impostazioni telecamera" class="camCfgBtn" id="camViewCfgBtn" type="button">⚙︎</button>
<button aria-label="Chiudi" class="camViewClose" id="camViewClose" type="button">✕</button>
</div>
</div>
<div class="camViewStage">
<!-- player (riutilizza la logica esistente: HLS via <video> o iframe embed dentro #mCamBody) -->
<div class="mCamBody camViewBody camViewLayered" id="mCamBody">
<div class="mCamOverlay camViewOverlay" id="mCamOverlay">CARICAMENTO TELECAMERA…</div>
<video autoplay="" class="mCamVideo camViewVideo camViewBg" id="mCamVideoBg" muted="" playsinline=""></video>
<video autoplay="" class="mCamVideo camViewVideo camViewFg" id="mCamVideo" muted="" playsinline=""></video>
</div>
</div>
</div>
</div>
<!-- Modal quantità prodotta -->
<div aria-hidden="true" class="modal" id="qtyModal">
<div aria-labelledby="qtyTitle" aria-modal="true" class="modalBox" role="dialog">
<div class="modalTitle" id="qtyTitle">Quanti pezzi hai prodotto?</div>
<div class="modalSub" id="qtyModalSub">—</div>
<input class="modalInput" id="qtyInput" inputmode="numeric" pattern="[0-9]*" placeholder="Es. 120"/>
<div class="modalActions">
<button class="btnGhost" id="qtyCancel">Annulla</button>
<button class="btnOk" id="qtyOk">OK</button>
</div>
</div>
</div>
<!-- Modal conferma + firma (solo mobile) -->
<div aria-hidden="true" class="modal" id="sigModal">
<div aria-labelledby="sigTitle" aria-modal="true" class="modalBox" role="dialog">
<div class="modalTitle" id="sigTitle">Dichiari di aver prodotto come si deve?</div>
<div class="modalSub" id="sigModalSub">—</div>
<label class="confirmRow">
<input id="sigYesChk" type="checkbox"/>
<span>Sì, confermo.</span>
</label>
<div aria-label="Riquadro firma" class="sigPadWrap">
<canvas class="sigCanvas" height="360" id="sigCanvas" width="900"></canvas>
</div>
<div class="sigHint">Firma con il dito. Usa “Pulisci firma” se vuoi rifare.</div>
<div class="sigTools">
<button class="btnGhost" id="sigClear" type="button">Pulisci firma</button>
<button class="btnGhost" id="sigCancel" type="button">Annulla</button>
<button class="btnOk" disabled="" id="sigOk" type="button">Conferma</button>
</div>
</div>
</div>
<!-- Modal riepilogo completato + copia firma (solo mobile) -->
<div aria-hidden="true" class="modal" id="doneModal">
<div aria-labelledby="doneTitle" aria-modal="true" class="modalBox" role="dialog">
<div class="modalTitle" id="doneTitle">Riepilogo produzione</div>
<div class="modalSub" id="doneModalSub">—</div>
<div style="margin-top:10px; font-size:15px; opacity:.95;">
<div><span style="opacity:.75;">Quantità:</span> <strong id="doneQty">—</strong></div>
<div style="margin-top:6px;"><span style="opacity:.75;">Tempo:</span> <strong id="doneDur">—</strong></div>
<div style="margin-top:6px;"><span style="opacity:.75;">Lotto:</span> <strong id="doneLot">—</strong></div>
</div>
<div class="sigPreviewWrap" id="doneSigWrap" style="display:none;">
<img alt="Firma" class="sigImg" id="doneSigImg"/>
</div>
<div class="sigHint" id="doneSigEmpty" style="display:none;">Nessuna firma registrata per questa riga.</div>
<div aria-label="Timbratura lotto" class="lotExplainWrap">
<div class="lotExplainTitle">Timbratura impianto</div>
<div class="lotExplainText">
<strong>LOTYYMMDDHHMMSS</strong> (es. <strong>LOT250709181544</strong>) = anno, mese, giorno, ora, minuti, secondi.
        Il sistema usa l’istante di completamento registrato: minuti e secondi possono variare leggermente in base al lasso di tempo tra fine produzione e salvataggio in cloud.
      </div>
</div>
<div class="modalActions" style="margin-top:14px; flex-wrap:wrap;">
<button class="btnGhost" id="donePrint" type="button">Stampa</button>
<button class="btnGhost" id="doneShare" type="button">Condividi</button>
<button class="btnGhost" id="doneCopySig" type="button">Copia firma</button>
<button class="btnOk" id="doneClose" type="button">Chiudi</button>
</div>
</div>
</div>
<!-- Mobile sheets -->
<div aria-hidden="true" class="mSheetBackdrop" id="mSheetBackdrop"></div>
<div aria-hidden="true" class="mSheet" id="mSheet">
<div aria-hidden="true" class="mSheetBar"></div>
<div class="mSheetTop">
<div class="mSheetTitle" id="mSheetTitle">—</div>
<button class="mSheetClose" id="mSheetClose" type="button">Chiudi</button>
</div>
<div class="mSheetBody">
<div class="mSheetActions" id="mSheetActions" style="display:none;">
<button class="mSheetPrimary" id="mSheetPrimary" type="button">Segna completato</button>
<button class="mSheetGhost" id="mSheetGhost" type="button">Deseleziona</button>
</div>
<div class="mSheetList" id="mSheetList"></div>
</div>
</div>
<div class="debug" id="debug"></div>
<script crossorigin="anonymous" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- Modal impostazioni telecamera (mobile) -->
<div aria-hidden="true" class="modal" id="camModal">
<div aria-labelledby="camTitle" aria-modal="true" class="modalBox" role="dialog">
<div class="modalTitle" id="camTitle">Telecamera</div>
<div class="modalSub" style="opacity:.85;">
      Per vederla dentro questa pagina serve un link <strong>HTTPS</strong> (HLS/WebRTC/iframe).<br/>
      Se hai solo RTSP, puoi aprirla in VLC con il link RTSP.
    </div>
<input class="modalInput" id="camEmbedUrl" inputmode="url" placeholder="URL HTTPS stream (es. https://.../live.m3u8)">
<input class="modalInput" id="camRtspUrl" inputmode="url" placeholder="URL RTSP (es. rtsp://user:pass@IP:554/stream1)"/>
<div class="modalActions">
<button class="btnGhost" id="camCancel" type="button">Annulla</button>
<button class="btnOk" id="camSave" type="button">Salva</button>
</div>
<div style="margin-top:10px; font-size:12px; opacity:.75; line-height:1.35;">
      Tip: puoi anche passare i parametri nell’URL, così vale per tutti i dispositivi:<br/>
<span style="opacity:.9;">?cam=URL_HTTPS</span> e/o <span style="opacity:.9;">?rtsp=URL_RTSP</span>
</div>
</input></div>
</div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import {
    getFirestore, collection, doc, setDoc, getDoc, deleteDoc, onSnapshot, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  const TTS_ELEVEN_PROXY_URL = "https://us-central1-tabellone-produzione-liv-e313e.cloudfunctions.net/ttsEleven";

  const Boot = (() => {
    const overlay = () => document.getElementById("bootOverlay");
    const fill = () => document.getElementById("bootFill");
    const pct = () => document.getElementById("bootPct");
    const msg = () => document.getElementById("bootMsg");

    const steps = [
      "Avvio interfaccia…",
      "Sincronizzazione pannelli…",
      "Lettura dati produzione…",
      "Connessione cloud…",
      "Caricamento meteo…",
      "Stabilizzazione…"
    ];

    let v = 0;
    let t0 = 0;
    let raf = 0;
    let done = false;

    const marks = { jobs:false, cloud:false, weather:false };
    const minShowMs = 900;
    const hardTimeoutMs = 9000;

    function setMsg(s){
      const el = msg();
      if(el) el.textContent = s;
    }

    function setV(n){
      v = Math.max(0, Math.min(100, n));
      const f = fill();
      const p = pct();
      if(f) f.style.width = v.toFixed(1) + "%";
      if(p) p.textContent = Math.floor(v) + "%";
    }

    function start(){
      t0 = performance.now();
      setV(0);
      setMsg(steps[0]);
      tick();
      setTimeout(() => finish(), hardTimeoutMs);
    }

    function tick(){
      if(done) return;

      const elapsed = performance.now() - t0;

      const targetSoft =
        elapsed < 800  ? 35 :
        elapsed < 1500 ? 55 :
        elapsed < 2500 ? 72 :
        85;

      const si = Math.min(steps.length - 1, Math.floor((elapsed / 650)));
      setMsg(steps[si]);

      if(v < targetSoft){
        const delta = (elapsed < 1500) ? (Math.random() * 2.8 + 1.2) : (Math.random() * 1.4 + 0.4);
        setV(Math.min(targetSoft, v + delta));
      }

      const allReady = marks.jobs && marks.cloud && marks.weather;
      if(allReady){
        if(elapsed >= minShowMs){
          const jump = Math.random() * 6 + 10;
          setV(Math.min(100, v + jump));
          if(v >= 99.2){
            setV(100);
            finish();
            return;
          }
        }
      }

      raf = requestAnimationFrame(tick);
    }

    function mark(which){
      if(which in marks) marks[which] = true;
    }

    function finish(){
      if(done) return;
      done = true;
      try{ cancelAnimationFrame(raf); }catch(_){}
      setV(100);
      setMsg("Pronto.");
      const el = overlay();
      if(!el) return;
      setTimeout(() => {
        el.classList.add("hide");
        el.setAttribute("aria-hidden", "true");
      }, 260);
      setTimeout(() => {
        try{ el.remove(); }catch(_){}
      }, 900);
    }

    return { start, mark, finish };
  })();

  Boot.start();

  const DEVICE_ID = (() => {
    try{
      const k = "tabellone_device_id";
      let v = localStorage.getItem(k);
      if(!v){
        v = (crypto?.randomUUID ? crypto.randomUUID() : ("dev_" + Math.random().toString(16).slice(2)));
        localStorage.setItem(k, v);
      }
      return v;
    }catch(_){
      return "dev_" + Math.random().toString(16).slice(2);
    }
  })();

  const IS_MOBILE = (() => {
    try{
      const ua = navigator.userAgent || "";
      const uaMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(ua);
      const small = window.matchMedia && window.matchMedia("(max-width: 820px)").matches;
      return uaMobile || !!small;
    }catch(_){
      return false;
    }
  })();
  // Placeholder (evita ReferenceError se arrivano snapshot prima dell'init)
  let MobileUI = { updateFromJobs(){}, updateFromProduced(){}, updateWipTimer(){} };


  // Mobile only: nasconde orario Cina (desktop invariato)
  if(IS_MOBILE){
    try{
      const cnLabel = Array.from(document.querySelectorAll(".clockCard .timeLabel"))
        .find(el => (el.textContent || "").trim() === "中国");
      if(cnLabel) cnLabel.style.display = "none";
      const cnVal = document.getElementById("timeCN");
      if(cnVal) cnVal.style.display = "none";
      const tapo = document.getElementById("tapoCard");
      if(tapo){ tapo.setAttribute("aria-hidden","false"); }
    }catch(_){}
  }


  const PLAYED_ANNOUNCEMENTS = new Set();

  let _ttsAudio = null;
  let _ttsAbort = null;
  let _ttsLastUrl = null;

  let _ttsRetryCount = 0;
  const _TTS_MAX_RETRY = 3;

  async function primeAudio(){
    try{
      if(!_ttsAudio) _ttsAudio = new Audio();
      _ttsAudio.preload = "auto";
      _ttsAudio.volume = 0.0001;
      _ttsAudio.src = "data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=";
      await _ttsAudio.play();
      _ttsAudio.pause();
      _ttsAudio.currentTime = 0;
      _ttsAudio.volume = 1;
      console.log("Audio primed (autoplay ok).");
    }catch(e){
      console.log("Prime audio blocked:", e);
    }
  }

  function scheduleTTSRetry(msg){
    if(_ttsRetryCount >= _TTS_MAX_RETRY) return;
    _ttsRetryCount++;
    setTimeout(() => speak(msg), 900);
  }

  function stopTTS(){
    try{
      if(_ttsAbort) _ttsAbort.abort();
    }catch(_){}
    _ttsAbort = null;

    if(_ttsAudio){
      try{ _ttsAudio.pause(); _ttsAudio.currentTime = 0; }catch(_){}
    }
    if(_ttsLastUrl){
      try{ URL.revokeObjectURL(_ttsLastUrl); }catch(_){}
      _ttsLastUrl = null;
    }
  }

  // ===== Cue audio (inizio/fine annuncio) =====
  // Cue HMI "campionato" (WAV embedded) — niente file esterni, volume alto.
  // Non tocca dinamismi / sheet / firebase: è solo audio UI.
  
  // ===== Cue audio (inizio/fine annuncio) — WAV embedded via <audio> =====
let _audioUnlocked = false;

// iOS/Safari: l'audio parte solo dopo un gesto utente (unlock 1 volta)
async function _unlockAudioOnce(){
  if (_audioUnlocked) return;
  _audioUnlocked = true;
  try{
    const a = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=");
    a.muted = true;
    await a.play();
    a.pause();
  }catch(_e){ /* fail-silent */ }
}

function setupAudioUnlock(){
  window.addEventListener("pointerdown", _unlockAudioOnce, { once:true, passive:true, capture:true });
  window.addEventListener("touchstart", _unlockAudioOnce, { once:true, passive:true, capture:true });
  window.addEventListener("mousedown", _unlockAudioOnce, { once:true, passive:true, capture:true });
  window.addEventListener("keydown", _unlockAudioOnce, { once:true, capture:true });
}
setupAudioUnlock();

// WAV embedded (nessun file esterno)
const _CUE_START_B64 = "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";
const _CUE_END_B64   = "UklGRtRSAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YbBSAAAAAAYAGAA3AGEAlQDUABsBaQG+ARcCcwLQAi0DhwPcAywEcwSwBOIEBwUeBSQFGgX+BNAEjgQ6BNIDVwPKAisCewG8APD/F/8z/kf9Vvxg+2r6dvmG+J33v/bt9Sz1fPTh817z9fKn8nbyZPJz8qPy9fJp8//zt/SR9Yv2o/fY+Cn6kfsQ/aH+QADtAaEDWgUSB8cIdAoTDKMNHQ9+EMMR5xLmE78UbRXuFUAWYBZPFgoWkRXkFAMU8BKrETcQlw7MDNoKxgiTBkUE4QFu/+/8a/rm92j19fKU8EruHewU6jLofeb55KzjmeLD4S7h2+DN4AXhhOFJ4lTjo+Q25gnoGepi7OHukPFq9Gn3h/q9/QMBVQSpB/kKPA5sEYAUchc6GtEcMR9UITQjzCQXJhInuCcJKAEooCflJtElZiSkIpAgLB5+G4oYVRXoEUcOfAqOBoUCa/5H+iP2CfIC7hfqUea54ljfNtxa2czWktSy0jLRFdBgzxXPNc/Dz73QItLx0yfWv9i22wTfpeKQ5r7qJu+/8374Wv1IAj4HMAwTEd0Vghr4HjQjLSfYKi0uJDG2M9o1jTfIOIk5zDmPOdM4lzfdNagz/DDdLVEqYCYRIm0dfhhNE+cNVgimAuX8Hvde8bLrJubI4KTbxdY40gbOOsrdxvfDkMGuv1e+jr1WvbG9oL4hwDLCz8T1x53LwM9V1FTZst5k5F7qk/D29nr9DgSnCjQRqBf0HQkk2ilZL3o0MDlxPTFBaUQPRx5JjkpcS4ZLCUvlSR1IskWoQgc/1DoYNtwwKysSJZwe1xfTEJ0JRgLe+nXzG+zg5NXdCteO0HDKv8SGv9S6srYrs0iwEa6KrLqroatDrJ+tsq96svG1EbrRvinEDcpx0EjXg94T5uft8PUb/lUGjw62FrYefyb+LSQ13jsfQtdH+Ux5UUxVaFjGWmBcMF00XWpc1FpzWExVZFHETHRHfkHwOtczQixAJOQbPxNjCmQBVvhM71vmld0Q1d7MEcW8ve62ubAqq06mMqLfnl2cs5rnmfqZ7prDnHSf/aJYp3ysXrLzuC3A/cdS0BvZReK862v1Pv8eCfgStBw9Jn4vYTjUQMJIGlDKVsRc+GFbZuNphWw7bgFv1G6ybZ1rmWiqZNpfMFq6U4NMm0QTPPwyaylzHyoVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAFn1yupo4EzWjMw8w3K6QbK5qu6j7J3BmHmUHJGzjkONzoxWjdqOVpHFlB+ZWp5spEer3LIau+/DSM0Q1zLhmOsr9tIAeAsFFmIgdyowNHY9NUZaTtNVkFyCYpxn0mscb3Jxz3Iwc5Vy/nBvbu5qgmY1YRRbKlSHTD1EXTv7MSsoAx6ZEwQJXP638y3p1d7G1BXL2cEluQ2xoanzohKdCZjlk66Qao4hjdOMgo0sj86RYZXemTyfbqVmrBa0bbxXxcPOmtjI4jbtzfd2AhoNoRf0If0rpTXXPoBHjE/pVohdWWNRaGNsiG+4ce5yKXNmcqlw9G1PasBlUmAQWglTS0vpQvQ5fzCgJmwc+hFhB7j8FvKS50TdQdOiyXnA3Lfdr42o/qE9nFeXVpNEkCeOBI3djLONhI9LkgOWo5oioHSmia1UtcO9wsZA0CbaX+TV7nH5GgS7DjsZhSOALRc3NkDISLpQ+1d7XitkAGnvbO5v+HEIcxtzMnJOcHRtqmn4ZGlfCFnjUQtKkUGHOAEvEyXVGlsQvQUU+3Xw+OW027/RMcgcv5a2sa5+pw6hbpuqls6S4Y/qje6M7ozqjeGPzpKqlm6bDqF+p7GulrYcvzHIv9G02/jldfAU+70FWxDVGhMlAS+HOJFBC0rjUQhZaV/4ZKppdG1OcDJyG3MIc/hx7m/vbABpK2R7XvtXulDISDZAFzeALYUjOxm7DhoEcfnV7l/kJtpA0MLGw71UtYmtdKYioKOaA5ZLkoSPs43djASNJ45EkFaTV5c9nP6hjajdr9y3ecCiyUHTRN2S5xbyuPxhB/oRbBygJn8w9DnpQktLCVMQWlJgwGVPavRtqXBmcilz7nK4cYhvY2xRaFljiF3pVoxPgEfXPqU1/Sv0IaEXGg12As33Nu3I4prYw85XxW28FrRmrG6lPJ/emWGVzpEsj4KN04whjWqOrpDlkwmYEp3zoqGpDbEludnBFcvG1NXeLem381z+BAmZEwMeKyj7MV07PUSHTCpUFFs1YYJm7mpvbv5wlXIwc89ycnEcb9JrnGeCYpBc01VaTjVGdj0wNHcqYiAFFngL0gAr9pjrMuEQ10jN78Mau9yyR6tspFqeH5nFlFaR2o5Wjc6MQ42zjhyReZTBmOyd7qO5qkGycro8w4zMTNZo4MrqWfUAAKcKNhWYH7QpdDPEPI5Fv01HVRJcFGI/Z4dr5G5Ncb1yMnOqciZxqm47a+FmpmGUW7lUJE3mRBE8uDLwKM4eaBTVCS7/iPT76Z7fidXQy4rCy7mmsS2qcKN+nWSYLpTkkI6OMY3QjGuNAo+RkRKVfpnLnuyk1qt5s8O7o8QFztXX/eFn7Pz2pAFJDNMWKyE6K+s0Jz7bRvNOX1YNXe5i92cbbFJvlnHfci1zfnLUcDJun2oiZsRgklqaU+pLk0OpOj0xZic4HcoSMwiK/ebyX+gM3gPUW8opwYC4dLAXqXiip5yvl52TeJBIjhKN14yajVePDJKxlUCarp/wpfestbQXvQzGgc9g2ZTjBu6f+EgD6g1uGLwivyxeNoc/JEgjUHNXAl7DY6loqmy8b9lx/HIjc01yfHC1bf1pXWXeX4xZd1KsSj1CPjnAL9oloRsrEY8G5vtF8cXme9yA0unIyr84t0avBaiFodWbAJcRkxKQCI74jOWMzo2yj4ySVpYIm5eg+KYdrvW1b755x//Q7dor5aXvQ/rsBIsPCBpMJEEuzzfkQGpJT1GCWPJekmRWaTJtH3AWchJzEnMWch9wMm1WaZJk8l6CWE9RaknkQM83QS5MJAgaiw/sBEP6pe8r5e3a/9B5x2++9bUdrviml6AIm1aWjJKyj86N5Yz4jAiOEpARkwCX1ZuFoQWoRq84t8q/6ciA0nvcxeZF8eb7jwYrEaEb2iXALz45PUKsSndSjFneX11l/Wm1bXxwTXIjc/xy2XG8b6psqWjDYwJec1cjUCRIhz9eNr8svCJuGOoNSAOf+AbulONg2YHPDMYXvbW096zwpa6fQJqxlQySV4+ajdeMEo1IjniQnZOvl6eceKIXqXSwgLgpwVvKA9QM3l/o5vKK/TMIyhI4HWYnPTGpOpND6kuaU5JaxGAiZp9qMm7UcH5yLXPfcpZxUm8bbPdn7mINXV9W807bRic+6zQ6Kysh0xZJDKQB/PZn7P3h1dcFzqPEw7t5s9ar7KTLnn6ZEpWRkQKPa43QjDGNjo7kkC6UZJh+nXCjLaqmscu5isLQy4nVnt/76Yj0Lv/VCWgUzh7wKLgyETzmRCRNuVSUW6Zh4WY7a6puJnGqcjJzvXJNceRuh2s/ZxRiElxHVb9NjkXEPHQztCmYHzYVpwoAAGD14uqf4K3WIs0QxI27qrN4rAWmX6CSm6aXpJSQkm+RQpEHkr2TXpbjmUSedaNrqRiwa7dUv8LHoNDb2V7jFO3n9sEAjgo4FKgdzCaQL983qj/fRnBNTlNvWMdcTmD9YtBkw2XWZQplYWPhYJBddlmeVBJP4UgYQsc6ADPTKlMilBmoEKUHnf6k9c/sL+TZ293TTcw5xbC+v7hys9Wu8KrMp22l2KMPoxOj46N7pdin8qrCrj+zXrgSvk7EBMsk0p7ZYeFb6Xvxr/nkAQgKCxLaGWQhmShrL8o1qTv8QLlF1UlKTQ9QIFJ7UxxUA1QzU65ReE+XTBNJ9ERFQBE7ZDVLL9QoDyIKG9UTgQwdBbz9a/Y87z3ofuEO2/rUTs8Xyl/FMMGSvYu6I7hctjm1vbTntLW1JLcwudW7Cb/HwgTHtsvS0E3WGNwo4m7o3O5j9fb7hAIBCV4PjRWBGy4hhyaAKxEwMDTUN/Y6kT2gPx9BDUJnQi9CZ0ERQDA+zDvpOI81xjGZLQ8pNiQXH74ZORSTDtkIFwNd/bP3KPLI7J3ns+IV3svZ3tVX0jzPk8xgyqnIbsezxnfGusZ6x7TIZcqIzBbPCtJb1QLZ9twu4Z7lPuoC79/zzPi7/aICeAcyDMQQJhVPGTUd0CAbJA0noinUK6AtBC/8L4gwqDBdMKkvjS4PLTEr+ihvJpcjeSAcHYoZyRXjEeINzgmxBZMBf/18+ZT1z/E07szqneeu5ATipN+U3dXbbNpb2aLYQtg62IvYMdkq2nTbCd3m3gbhYuP15bjopeu07t7xG/Vl+LP7//4/Am8FhwiAC1QO/RB3E7sVxxeWGSUbcRx6HTweuR7wHuIejx77HSYdFRzKGkoZmBe6FbQTjBFID+wMfwoGCIgFCQOQACP+xvt++VH3QvVW85Hx9e+F7kXtNexY663qNurz6eLpA+pV6tXqgutZ7Fbtd+647xXxi/IW9LH1WPcH+br6bPwa/sH/WgHlAl0EwAUKBzoITglDChgLzAtfDNAMHw1NDVoNRw0WDckMYAzeC0ULmArZCQsJMQhNB2EGcgWBBJIDpgLAAeIADwBJ/5D+5/1O/cb8Ufzu+577Yfs3+x/7F/sh+zn7YPuS+9D7F/xm/Lr8Ev1s/cb9Hv50/sT+Dv9Q/4n/uP/c//T/AAA=";

const _cueStart = new Audio("data:audio/wav;base64," + _CUE_START_B64);
const _cueEnd   = new Audio("data:audio/wav;base64," + _CUE_END_B64);

[_cueStart, _cueEnd].forEach(a => {
  try{
    a.preload = "auto";
    a.volume = 0.95;  // volume cue (0..1)
  }catch(_e){}
});

async function playCue(kind){
  if(!_audioUnlocked) return;
  try{
    const a = (kind === "end") ? _cueEnd : _cueStart;
    a.currentTime = 0;
    await a.play();
  }catch(_e){
    // fail-silent
  }
}




  async function speak(text){
    const msg = String(text || "").trim();
    if(!msg) return;

    // cue inizio annuncio
    try{ await playCue("start"); }catch(_){}

    stopTTS();
    _ttsAbort = new AbortController();

    try{
      const res = await fetch(TTS_ELEVEN_PROXY_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: msg }),
        signal: _ttsAbort.signal
      });

      if(!res.ok){
        const errTxt = await res.text().catch(()=> "");
        throw new Error("TTS proxy HTTP " + res.status + (errTxt ? (": " + errTxt.slice(0,220)) : ""));
      }

      const buf = await res.arrayBuffer();
      const blob = new Blob([buf], { type: "audio/mpeg" });

      if(!_ttsAudio) _ttsAudio = new Audio();
      _ttsAudio.preload = "auto";
      _ttsAudio.volume = 1;

      // cue fine annuncio
      _ttsAudio.onended = () => { try{ playCue("end"); }catch(_){} };
      _ttsAudio.onerror = () => { try{ playCue("end"); }catch(_){} };

      if(_ttsLastUrl){
        try{ URL.revokeObjectURL(_ttsLastUrl); }catch(_){}
        _ttsLastUrl = null;
      }

      _ttsLastUrl = URL.createObjectURL(blob);
      _ttsAudio.src = _ttsLastUrl;

      await _ttsAudio.play();
    }catch(e){
      console.log("TTS error:", e);

      const errName = (e && e.name) ? String(e.name) : "";
      const errMsg  = (e && e.message) ? String(e.message) : "";

      const autoplayBlocked =
        /NotAllowedError/i.test(errName) ||
        /not allowed|gesture|autoplay/i.test(errMsg);

      if(autoplayBlocked){
        scheduleTTSRetry(msg);
        return;
      }

      try{
        if("speechSynthesis" in window){
          window.speechSynthesis.cancel();
          const u = new SpeechSynthesisUtterance(msg);
          u.lang = "it-IT";
          u.rate = 0.88;
          u.pitch = 0.90;
          u.onend = () => { try{ playCue("end"); }catch(_){ } };
          u.onerror = () => { try{ playCue("end"); }catch(_){ } };
          window.speechSynthesis.speak(u);
        }
      }catch(_){}
    }
  }

  const ANNOUNCE_TEMPLATES = {
    completed: [
      "Operazione completata. Registrati {QTY} pezzi: {LABEL}.",
      "Confermato. {QTY} pezzi completati per {LABEL}.",
      "Avanzamento acquisito dal sistema. {LABEL}: {QTY} pezzi registrati.",
      "Lotto chiuso. {QTY} pezzi segnati su {LABEL}.",
      "Avanzamento registrato. {LABEL} completato: {QTY} pezzi."
    ],
    next: [
      "Prossimo prodotto in coda: {NEXT}.",
      "Linea pronta. Avvio sul prossimo prodotto: {NEXT}.",
      "Coda produzione attiva. Prossimo articolo: {NEXT}.",
      "Successivo da fare: {NEXT}."
    ],
    close: [
      "Buon lavoro.",
      "Operatività confermata.",
      "Linea stabile. Proseguire.",
      "Avanzamento attivo."
    ],
    noNext: [
      "Coda completata. Buon lavoro.",
      "Nessun altro prodotto in coda. Buon lavoro.",
      "Lista finita. Buon lavoro."
    ]
  };

  function _pick(arr){
    if(!arr || !arr.length) return "";
    const r = (crypto && crypto.getRandomValues)
      ? (crypto.getRandomValues(new Uint32Array(1))[0] / 2**32)
      : Math.random();
    return arr[Math.floor(r * arr.length)];
  }

  function buildAnnouncement({ qty, label, nextLabel }){
    const QTY = String(qty);
    const LABEL = String(label || "").trim();
    const NEXT = String(nextLabel || "").trim();

    let base = _pick(ANNOUNCE_TEMPLATES.completed)
      .replaceAll("{QTY}", QTY)
      .replaceAll("{LABEL}", LABEL || "riga selezionata");

    if(NEXT){
      const nx = _pick(ANNOUNCE_TEMPLATES.next).replaceAll("{NEXT}", NEXT);
      const end = _pick(ANNOUNCE_TEMPLATES.close);
      return `${base} ${nx} ${end}`.replace(/\s+/g," ").trim();
    }else{
      const tail = _pick(ANNOUNCE_TEMPLATES.noNext) || _pick(ANNOUNCE_TEMPLATES.close);
      return `${base} ${tail}`.replace(/\s+/g," ").trim();
    }
  }

  let _startupSpoken = false;

  const STARTUP_TEMPLATES = {
    open: [
      "Benvenuti sulla hub linea polveri.",
      "Hub linea polveri online.",
      "Benvenuti sulla hub linea polveri.",
      "Benvenuti sulla hub linea polveri.",
      "Benvenuti sulla hub linea polveri."
    ],
    first: [
      "Primo prodotto da fare: {FIRST}.",
      "Prima lavorazione in coda: {FIRST}.",
      "Prima riga in produzione: {FIRST}.",
      "Priorità attuale: {FIRST}."
    ],
    close: [
      "Buon lavoro.",
      "Buon lavoro.",
      "Buon lavoro.",
      "Buon lavoro.",
      "Buon lavoro."
    ],
    noData: [
      "Nessun prodotto in coda. Verifica il foglio.",
      "Lista vuota. Controlla la sorgente dati.",
      "Nessuna riga disponibile. Verifica la sorgente ordini EasyFatt."
    ]
  };

  function buildStartupAnnouncement(firstLabel){
    const FIRST = String(firstLabel || "").trim();
    const a = _pick(STARTUP_TEMPLATES.open);

    if(FIRST){
      const b = _pick(STARTUP_TEMPLATES.first).replaceAll("{FIRST}", FIRST);
      const c = _pick(STARTUP_TEMPLATES.close);
      return `${a} ${b} ${c}`.replace(/\s+/g," ").trim();
    }

    const b = _pick(STARTUP_TEMPLATES.noData);
    return `${a} ${b}`.replace(/\s+/g," ").trim();
  }

  function maybeSpeakStartup(firstLabel){
    if(_startupSpoken) return;
    _startupSpoken = true;
    if(IS_MOBILE) return;
    const msg = buildStartupAnnouncement(firstLabel);
    setTimeout(() => speak(msg), 420);
  }

  const firebaseConfig = {
    apiKey: "AIzaSyBiyB4pilnPpVj8vImD4PI6LF2_RtyDnv4",
    authDomain: "tabellone-produzione-liv-e313e.firebaseapp.com",
    projectId: "tabellone-produzione-liv-e313e",
    storageBucket: "tabellone-produzione-liv-e313e.firebasestorage.app",
    messagingSenderId: "537555699968",
    appId: "1:537555699968:web:4d04cb9596b67bfb0e4be5"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  const TODAY = new Intl.DateTimeFormat("sv-SE",{timeZone:"Europe/Rome"}).format(new Date());
  const producedCol = collection(db, "producedDays", TODAY, "items");
  const stateDoc = doc(db, "producedDays", TODAY, "meta", "state");

  let _serverOffsetMs = 0;
  function serverNowMs(){ return Date.now() + _serverOffsetMs; }

  async function syncServerOffset(){
    try{
      const pingRef = doc(db, "producedDays", TODAY, "meta", "ping");
      await setDoc(pingRef, { ts: serverTimestamp() }, { merge:true });
      const snap = await getDoc(pingRef);
      const ts = snap.data()?.ts;
      if(ts?.toMillis){
        const serverMs = ts.toMillis();
        const tRecv = Date.now();
        _serverOffsetMs = serverMs - tRecv;
      }
    }catch(e){
      console.log("syncServerOffset error:", e);
    }
  }

  const WIP_STATE = { activeKey: null, startedAtMs: 0, updatedBy: null };

  function formatDur(ms){
    ms = Math.max(0, ms|0);
    const total = Math.floor(ms / 1000);
    const h = Math.floor(total / 3600);
    const m = Math.floor((total % 3600) / 60);
    const s = total % 60;
    const pad2 = (n) => String(n).padStart(2, "0");
    if(h > 0) return `${h}:${pad2(m)}:${pad2(s)}`;
    return `${m}:${pad2(s)}`;
  }


  function lotFromMs(ms){
    if(!Number.isFinite(ms) || ms <= 0) return "";
    const d = new Date(ms);
    const pad = (n) => String(n).padStart(2, "0");
    const yy = pad(d.getFullYear() % 100);
    const MM = pad(d.getMonth() + 1);
    const DD = pad(d.getDate());
    const HH = pad(d.getHours());
    const mm = pad(d.getMinutes());
    const ss = pad(d.getSeconds());
    return `LOT${yy}${MM}${DD}${HH}${mm}${ss}`;
  }

  function completionMsFromItem(it){
    try{
      const a = it?.completedAt?.toMillis?.();
      if(Number.isFinite(a) && a > 0) return a;
    }catch(_){}
    try{
      const b = it?.ts?.toMillis?.();
      if(Number.isFinite(b) && b > 0) return b;
    }catch(_){}
    const c = it?.completedAtClientMs;
    if(Number.isFinite(c) && c > 0) return c;
    const d = it?.signatureClientMs;
    if(Number.isFinite(d) && d > 0) return d;
    const e = it?.updatedClientMs;
    if(Number.isFinite(e) && e > 0) return e;
    return 0;
  }

  function lotFromItem(it){
    const ms = completionMsFromItem(it);
    return ms ? lotFromMs(ms) : "";
  }

  const WIP_THRESHOLD_MS = 90 * 60 * 1000; // (lasciato come nel tuo file)

  function wipStyleFromElapsed(elapsedMs){
    const p = Math.max(0, Math.min(1, elapsedMs / WIP_THRESHOLD_MS));
    const hue = 120 * (1 - p);
    const color = `hsl(${hue.toFixed(1)} 95% 55%)`;
    const glow  = `hsla(${hue.toFixed(1)} 95% 60% / 0.55)`;
    return { p, color, glow };
  }

  const rowNodes = new Map();

  function updateAllWipTimers(){
    try{ refreshQtyModalSub(); }catch(_){ }
    if(!rowNodes || !rowNodes.size) return;
    const activeKey = WIP_STATE.activeKey;
    const startMs = WIP_STATE.startedAtMs;

    for(const [k, el] of rowNodes.entries()){
      const tEl = el.querySelector(".wipTimer");
      const badge = el.querySelector(".badge");
      const dot = el.querySelector(".dot");
      if(!tEl || !badge || !dot) continue;

      if(activeKey && k === activeKey && startMs){
        const elapsed = serverNowMs() - startMs;
        tEl.textContent = "⏱ " + formatDur(elapsed);

        const st = wipStyleFromElapsed(elapsed);
        badge.style.borderColor = st.glow;
        badge.style.boxShadow = `0 0 20px ${st.glow}`;
        badge.style.setProperty("--wipColor", st.color);
        badge.style.setProperty("--wipGlow", st.glow);
      }else{
        tEl.textContent = "";
        badge.style.borderColor = "";
        badge.style.boxShadow = "";
        badge.style.removeProperty("--wipColor");
        badge.style.removeProperty("--wipGlow");
      }
    }
  
    try{ MobileUI.updateWipTimer(); }catch(_){ }
}

  function initWipStateRealtime(){
    onSnapshot(stateDoc, (snap) => {
      const v = snap.data() || {};
      WIP_STATE.activeKey = v.activeKey || null;
      WIP_STATE.updatedBy = v.updatedBy || null;
      WIP_STATE.startedAtMs = (v.startedAt && v.startedAt.toMillis) ? v.startedAt.toMillis() : 0;
      updateAllWipTimers();
    }, (err) => {
      console.log("stateDoc snapshot error:", err);
    });
  }

  let _wipInitDone = false;
  async function ensureWipStateInitialized(firstActiveKey){
    if(_wipInitDone) return;
    if(!firstActiveKey) return;
    _wipInitDone = true;

    try{
      const snap = await getDoc(stateDoc);
      if(snap.exists()){
        const v = snap.data() || {};
        if(v.startedAt) return;

        await setDoc(stateDoc, {
          activeKey: v.activeKey || firstActiveKey,
          startedAt: serverTimestamp(),
          updatedBy: DEVICE_ID,
          updatedClientMs: Date.now()
        }, { merge:true });
        return;
      }

      await setDoc(stateDoc, {
        activeKey: firstActiveKey,
        startedAt: serverTimestamp(),
        updatedBy: DEVICE_ID,
        updatedClientMs: Date.now()
      }, { merge:true });
    }catch(e){
      console.log("ensureWipStateInitialized error:", e);
    }
  }

  const keyToDocId = (key) => encodeURIComponent(key);
  const producedCloud = new Map();

  const PRODUCED_BACKUP_KEY = "TABELLONE_PRODUCED_BACKUP_V1";
  const PRODUCED_BACKUP_HISTORY_KEY = "TABELLONE_PRODUCED_BACKUP_HISTORY_V1";

  function saveProducedBackupNow(){
    try{
      const items = [...producedCloud.entries()].map(([key,v]) => {
        const it = { key, ...(v||{}) };
        return { ...it, lot: lotFromItem(it) };
      });
      const payload = { savedAtClientMs: Date.now(), count: items.length, items };
      localStorage.setItem(PRODUCED_BACKUP_KEY, JSON.stringify(payload));

      // storico leggero (ultimi 20)
      const histRaw = localStorage.getItem(PRODUCED_BACKUP_HISTORY_KEY);
      const hist = histRaw ? (JSON.parse(histRaw) || []) : [];
      hist.unshift({ savedAtClientMs: payload.savedAtClientMs, count: payload.count });
      while(hist.length > 20) hist.pop();
      localStorage.setItem(PRODUCED_BACKUP_HISTORY_KEY, JSON.stringify(hist));
    }catch(_){}
  }

  async function _generateProducedBackupPDF(items){
    const jsPDF = window.jspdf?.jsPDF;
    if(!jsPDF) throw new Error("jsPDF non disponibile");

    const doc = new jsPDF({ unit:"pt", format:"a4", compress:true });
    const W = doc.internal.pageSize.getWidth();
    const H = doc.internal.pageSize.getHeight();
    const left = 40;
    const right = W - 40;

    const nowStr = (() => { try{ return new Date().toLocaleString("it-IT"); }catch(_){ return ""; } })();

    const colX = { prod:left+12, qty:left+330, lot:left+380, dur:left+485 };
    const rowH = 18;

    const trunc = (s, max) => {
      s = String(s || "");
      if(s.length <= max) return s;
      return s.slice(0, Math.max(0, max-1)) + "…";
    };

    function drawHeader(){
      // background
      doc.setFillColor(245, 246, 248);
      doc.rect(0, 0, W, H, "F");

      // header band
      doc.setFillColor(12, 16, 22);
      doc.rect(0, 0, W, 86, "F");

      doc.setTextColor(255,255,255);
      doc.setFont("courier","bold");
      doc.setFontSize(18);
      doc.text("HUB LINEA POLVERI", left, 46);

      doc.setFont("courier","normal");
      doc.setFontSize(10);
      doc.text(`BACKUP COMPLETATI • ${nowStr} • Totale: ${items.length}`, left, 66);

      // table header
      doc.setDrawColor(40,45,52);
      doc.setLineWidth(1);
      doc.roundedRect(left, 96, right-left, 22, 8, 8);

      doc.setTextColor(15,18,22);
      doc.setFont("courier","bold");
      doc.setFontSize(10);
      doc.text("PRODOTTO", colX.prod, 111);
      doc.text("QTY", colX.qty, 111);
      doc.text("LOTTO", colX.lot, 111);
      doc.text("TEMPO", colX.dur, 111);

      // reset for rows
      doc.setTextColor(15,18,22);
      doc.setFont("helvetica","normal");
      doc.setFontSize(10);

      return 132;
    }

    function addFooter(pageNo, totalPages){
      doc.setTextColor(90,96,106);
      doc.setFont("courier","normal");
      doc.setFontSize(9);
      doc.text(`Device: ${DEVICE_ID}`, left, H - 26);
      doc.text(`Pagina ${pageNo}/${totalPages}`, right-92, H - 26);
    }

    let y = drawHeader();

    for(const it0 of items){
      const it = it0 || {};
      const product = trunc((it.label || it.key || "—"), 52);
      const qty = (it.qty || it.qty === 0) ? String(it.qty) : "—";
      const lot = (lotFromItem(it) || it.lot || "—");
      const dur = (Number.isFinite(it.durationMs)) ? formatDur(it.durationMs) : "—";

      if(y > (H - 60)){
        doc.addPage();
        y = drawHeader();
      }

      doc.setFont("helvetica","normal");
      doc.text(product, colX.prod, y);

      doc.setFont("courier","bold");
      doc.text(qty, colX.qty, y);

      doc.setFont("courier","normal");
      doc.text(lot, colX.lot, y);

      doc.text(dur, colX.dur, y);

      // separator
      doc.setDrawColor(220,225,232);
      doc.setLineWidth(0.8);
      doc.line(left, y+6, right, y+6);

      y += rowH;
    }

    // footers with total pages
    const total = doc.getNumberOfPages();
    for(let p=1; p<=total; p++){
      doc.setPage(p);
      addFooter(p, total);
    }

    return doc.output("blob");
  }

  async function downloadProducedBackup(){
    try{
      // preferisci dati live
      let items = [];
      try{
        items = [...producedCloud.entries()].map(([key,v]) => ({ key, ...(v||{}) }));
      }catch(_){}

      if(!items.length){
        const raw = localStorage.getItem(PRODUCED_BACKUP_KEY) || "";
        if(raw){
          try{
            const payload = JSON.parse(raw);
            if(Array.isArray(payload?.items)) items = payload.items;
          }catch(_){}
        }
      }

      if(!items.length){ window.alert("Nessun completato da esportare."); return; }

      // normalizza lotto per sicurezza
      items = items.map(it => ({ ...(it||{}), lot: (lotFromItem(it) || it?.lot || "") }));

      const pdfBlob = await _generateProducedBackupPDF(items);

      const d = new Date();
      const pad = (n)=>String(n).padStart(2,"0");
      const name = `backup_completati_${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}.pdf`;

      const url = URL.createObjectURL(pdfBlob);
      const a = document.createElement("a");
      a.href = url;
      a.download = name;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => { try{ URL.revokeObjectURL(url); }catch(_){} a.remove(); }, 1200);
    }catch(e){
      console.log("downloadProducedBackup error:", e);
      try{ window.alert("Errore export PDF backup."); }catch(_){}
    }
  }


  function markProducedCloud(key, qty, label, announce, meta){
    const id = keyToDocId(key);
    const payload = { key, qty, label, ts: serverTimestamp() };

    if(meta && Number.isFinite(meta.durationMs)){
      payload.durationMs = Math.max(0, Math.floor(meta.durationMs));
    }
    if(meta && Number.isFinite(meta.startedAtMs)){
      payload.startedAtMs = Math.floor(meta.startedAtMs);
    }
    if(meta && meta.signatureDataUrl){
      payload.signatureDataUrl = String(meta.signatureDataUrl);
    }
    if(meta && meta.signatureBy){
      payload.signatureBy = String(meta.signatureBy);
    }
    if(meta && Number.isFinite(meta.signatureClientMs)){
      payload.signatureClientMs = Math.floor(meta.signatureClientMs);
    }
    payload.completedAt = serverTimestamp();
    payload.completedAtClientMs = Date.now();

    if(announce && announce.text){
      payload.announceText = String(announce.text);
      payload.announceBy = announce.by || DEVICE_ID;
      payload.announceClientMs = announce.clientMs || Date.now();
    }

    return setDoc(doc(producedCol, id), payload, { merge: true });
  }

  function unmarkProducedCloud(key){
    const id = keyToDocId(key);
    return deleteDoc(doc(producedCol, id));
  }

  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, (m) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  async function confirmUndoWithPassword(){
    const ok = window.confirm("Sicuro che vuoi annullare?");
    if(!ok) return false;
    const pw = window.prompt("Password annullo (temporanea):");
    if(pw !== "12345"){
      window.alert("Password errata.");
      return false;
    }
    return true;
  }


  async function confirmUndoAllWithPassword(count){
    const ok = window.confirm(`ATTENZIONE: annullare TUTTI i completati? (${count || 0} righe)`);
    if(!ok) return false;
    const pw = window.prompt("Password annullo (temporanea):");
    if(pw !== "12345"){
      window.alert("Password errata.");
      return false;
    }
    return true;
  }

  async function undoAllProduced(){
    try{
      const count = producedCloud?.size || 0;
      if(!count){
        window.alert("Nessun completato da annullare.");
        return;
      }
      const ok = await confirmUndoAllWithPassword(count);
      if(!ok) return;

      const keys = [...producedCloud.keys()];
      // cancella in sequenza (più sicuro su rete instabile)
      for(const k of keys){
        try{ await unmarkProducedCloud(k); }catch(_){}
      }

      // pulizia locale + UI immediata (lo snapshot riallinea comunque)
      try{ producedCloud.clear(); }catch(_){}
      try{ renderProducedFromCloud(); }catch(_){}
      try{ MobileUI.updateFromProduced(); }catch(_){}
      try{ forceRestartWipTimerToFirstActive(); }catch(_){}

      if(!IS_MOBILE) speak("Completati annullati.");
    }catch(e){
      console.log("undoAllProduced error:", e);
      try{ window.alert("Errore annullo globale completati."); }catch(_){}
    }
  }

  function renderProducedFromCloud(){
    const list = document.getElementById("producedList");
    const empty = document.getElementById("producedEmpty");
    if(!list) return;

    // ===== sorgenti completati =====
    const xmlItems = (typeof _XML_DONE_MAP !== "undefined" && _XML_DONE_MAP && _XML_DONE_MAP.size)
      ? [..._XML_DONE_MAP.entries()].map(([key,v]) => ({ key, ...(v||{}), _src:"xml" }))
      : [];

    const prodItems = (typeof producedCloud !== "undefined" && producedCloud && producedCloud.size)
      ? [...producedCloud.entries()].map(([key,v]) => ({ key, ...(v||{}), _src:"prod" }))
      : [];

    const items = [...xmlItems, ...prodItems];

    list.innerHTML = "";
    if(!items.length){
      if(empty) empty.style.display = "";
      list.appendChild(empty);
      return;
    }
    if(empty) empty.style.display = "none";

    function compMs(it){
      if(it._src === "xml"){
        return Number(it.completedAtClientMs || it.signatureClientMs || 0) || 0;
      }
      try{ return completionMsFromItem(it) || 0; }catch(_){ return 0; }
    }

    items.sort((a,b) => compMs(b) - compMs(a));

    const max = 120; // evita liste infinite
    items.slice(0, max).forEach((it) => {
      const item = document.createElement("div");
      item.className = "prodItem";

      // label
      let label = it.label || it.key;
      if(it._src === "xml"){
        const cust = (it.customer || "").trim();
        const prod = (it.product || it.articolo || it.descrizione || "").trim();
        label = (cust && prod) ? `${cust} • ${prod}` : (cust || prod || label);

        const docNo = (it.docNo || it.numeroDoc || "").toString().trim();
        if(docNo){
          label += ` (Doc ${docNo})`;
        }
      }

      // qty
      const qtyVal = (it.qty ?? it.quantita ?? it.quantity ?? "");
      const qty = (qtyVal === "" || qtyVal === null || qtyVal === undefined) ? "—" : String(qtyVal);

      // time chip (per XML)
      let durHtml = "";
      if(it._src === "xml"){
        const t = compMs(it);
        if(t){
          try{
            const tm = new Date(t).toLocaleTimeString("it-IT", { hour:"2-digit", minute:"2-digit" });
            durHtml = ` <span class="prodDur">• ${escapeHtml(tm)}</span>`;
          }catch(_){}
        }
      }else{
        try{
          const dur = durMsFromItem(it);
          if(dur){
            durHtml = ` <span class="prodDur">• ${escapeHtml(formatDur(dur))}</span>`;
          }
        }catch(_){}
      }

      item.innerHTML = `
        <div class="prodText">${escapeHtml(label)} <span class="prodQty">× ${escapeHtml(qty)}</span>${durHtml}</div>
        <button class="undoBtn" type="button">Annulla</button>
      `;

      item.querySelector(".undoBtn")?.addEventListener("click", async () => {
        const ok = await confirmUndoWithPassword();
        if(!ok) return;

        try{
          if(it._src === "xml"){
            if(!_XML_DONE_COL){ throw new Error("Cloud non pronto"); }
            await deleteDoc(doc(_XML_DONE_COL, it.key));
            try{ _XML_DONE_MAP?.delete(it.key); }catch(_){}
            try{ _XML_DONE?.delete(it.key); }catch(_){}
          }else{
            await unmarkProducedCloud(it.key);
            try{ producedCloud?.delete(it.key); }catch(_){}
          }
        }catch(e){
          alert("Errore annullamento: " + (e?.message || e));
        }

        try{ renderProducedFromCloud(); }catch(_){}
      });

      list.appendChild(item);
    });

    // se abbiamo tagliato
    if(items.length > max){
      const more = document.createElement("div");
      more.className = "prodEmpty";
      more.style.display = "";
      more.textContent = `Mostrati ${max} di ${items.length} completati.`;
      list.appendChild(more);
    }
  }


  function initFirestoreRealtime(){
    let firstSnap = true;

    onSnapshot(producedCol, (snap) => {
      if(firstSnap){
        snap.forEach(d => {
          const v = d.data() || {};
          if(v?.announceClientMs){
            PLAYED_ANNOUNCEMENTS.add(d.id + "@" + v.announceClientMs);
          }
        });
        firstSnap = false;
        try{ Boot.mark('cloud'); }catch(_){}
      }else{
        try{
          for(const ch of snap.docChanges()){
            if(ch.type !== "added" && ch.type !== "modified") continue;
            const v = ch.doc.data() || {};
            if(!v?.announceText) continue;

            const token = ch.doc.id + "@" + (v.announceClientMs || "");
            if(PLAYED_ANNOUNCEMENTS.has(token)) continue;

            if(IS_MOBILE) { PLAYED_ANNOUNCEMENTS.add(token); continue; }
            if(v.announceBy && v.announceBy === DEVICE_ID) { PLAYED_ANNOUNCEMENTS.add(token); continue; }

            PLAYED_ANNOUNCEMENTS.add(token);
            speak(v.announceText);
          }
        }catch(e){
          console.log("announce handler error:", e);
        }
      }

      producedCloud.clear();
      snap.forEach(d => {
        const v = d.data() || {};
        if(v?.key) producedCloud.set(v.key, v);
      });
      try{ saveProducedBackupNow(); }catch(_){ }
      renderProducedFromCloud();
      // applyForcedStatuses removed
updateAllWipTimers();
    });
  }

  /* ===== Sezione Sheets rimossa (hub solo EasyFatt XML) ===== */

const WCODE = {
    0:"Sereno", 1:"Preval. sereno", 2:"Parz. nuvoloso", 3:"Nuvoloso",
    45:"Nebbia", 48:"Brina/nebbia",
    51:"Pioviggine", 53:"Pioviggine", 55:"Pioviggine",
    61:"Pioggia", 63:"Pioggia", 65:"Pioggia forte",
    71:"Neve", 73:"Neve", 75:"Neve forte",
    80:"Rovesci", 81:"Rovesci", 82:"Rovesci forti",
    95:"Temporale", 96:"Temporale", 99:"Temporale"
  };
  function wdesc(code){ return WCODE[code] || ("Meteo " + code); }

  async function refreshWeather(){
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${WX_LAT}&longitude=${WX_LON}&current=temperature_2m,weather_code,wind_speed_10m&hourly=precipitation_probability&timezone=${encodeURIComponent(WX_TZ)}&t=${Date.now()}`;
    const res = await fetch(url, { cache:"no-store" });
    if(!res.ok) throw new Error("Meteo HTTP " + res.status);
    const j = await res.json();

    const temp = j?.current?.temperature_2m;
    const code = j?.current?.weather_code;
    const wind = j?.current?.wind_speed_10m;

    let p = null;
    const times = j?.hourly?.time || [];
    const probs = j?.hourly?.precipitation_probability || [];
    if(times.length && probs.length){
      const nowIso = new Date().toISOString().slice(0,13);
      let idx = times.findIndex(t => t.startsWith(nowIso));
      if(idx < 0) idx = 0;
      p = probs[idx];
    }

    document.getElementById("wTemp").textContent = (temp ?? "--") + "°";
    document.getElementById("wDesc").textContent = wdesc(code);
    document.getElementById("wWind").textContent = (wind ?? "—");
    document.getElementById("wRain").textContent = (p ?? "—");
    document.getElementById("wUpdated").textContent = "Agg. " + new Date().toLocaleTimeString("it-IT");

    try{ Boot.mark("weather"); }catch(_){}
  }

  primeAudio();

  tickClock();
  setInterval(tickClock, 1000);


  // ===== Mobile Widgets (desktop invariato) =====
  MobileUI = (() => {
    if(!IS_MOBILE) return {
      updateFromJobs(){},
      updateFromProduced(){},
      updateWipTimer(){},
    };

    const el = {
      root: document.getElementById("mobileWidgets"),
      camBody: document.getElementById("mCamBody"),
      wipBtn: document.getElementById("mWipBtn"),
      wipProd: document.getElementById("mWipProd"),
      wipSub: document.getElementById("mWipSub"),
      wipTimer: document.getElementById("mWipTimer"),
      wipRemainBadge: document.getElementById("mWipRemainBadge"),
      doneBtn: document.getElementById("mDoneBtn"),
      doneCount: document.getElementById("mDoneCount"),
      doneLast: document.getElementById("mDoneLast"),
      doneSub: document.getElementById("mDoneSub"),
      sheet: document.getElementById("mSheet"),
      sheetBackdrop: document.getElementById("mSheetBackdrop"),
      sheetTitle: document.getElementById("mSheetTitle"),
      sheetClose: document.getElementById("mSheetClose"),
      sheetList: document.getElementById("mSheetList"),
      sheetActions: document.getElementById("mSheetActions"),
      sheetPrimary: document.getElementById("mSheetPrimary"),
      sheetGhost: document.getElementById("mSheetGhost"),
    };

    try{
      if(el.root) el.root.setAttribute("aria-hidden","false");
    }catch(_){}

    // Sposta l'iframe Tapo dentro al widget camera (se presente)
    try{
      const tapo = document.getElementById("tapoCard");
      const frame = tapo ? tapo.querySelector("iframe") : null;
      if(frame && el.camBody && !el.camBody.contains(frame)){
        el.camBody.appendChild(frame);
      }
    }catch(_){}

    // ===== Camera config (mobile) =====

    // ===== Cloudflare Tunnel (Option 1) =====
    // Metti qui l’URL HTTPS pubblico del tuo bridge (Cloudflare Tunnel).
    // Deve essere un endpoint "embed" che il browser può aprire senza click:
    //   - HLS: .../stream.m3u8  (consigliato su iPhone)
    //   - oppure una pagina HTTPS embeddabile (iframe)
    //
    // Esempio (HLS):
    //   https://<tunnel-domain>/hls/stream.m3u8
    //
    // NOTA: Username/password RTSP NON vanno qui: stanno nel bridge.
    const DEFAULT_CLOUD_CAM_EMBED_URL = "https://cam.lineaprova1.eu/api/stream.m3u8?src=tapo"; // <-- INCOLLA QUI (m3u8 o https page)
    const DEFAULT_CLOUD_CAM_RTSP_URL  = ""; // opzionale: solo per aprire VLC (rtsp://...)
    const ALLOW_CAM_CONFIG_UI = false;      // false = niente click/config su dispositivi

    // Se preferisci NON toccare l’HTML: crea un file "cam_config.json" nella stessa cartella dell’HTML su GitHub Pages:
    // { "embed": "https://<tunnel-domain>/hls/stream.m3u8", "rtsp": "" }
    let REMOTE_CLOUD_CAM_EMBED_URL = "";
    let REMOTE_CLOUD_CAM_RTSP_URL  = "";

    (async function _loadRemoteCamCfg(){
      if(!IS_MOBILE) return;
      try{
        const r = await fetch("cam_config.json", { cache:"no-store" });
        if(!r || !r.ok) return;
        const j = await r.json();
        REMOTE_CLOUD_CAM_EMBED_URL = String((j.embed || j.hls || j.webrtc || "")).trim();
        REMOTE_CLOUD_CAM_RTSP_URL  = String((j.rtsp || "")).trim();
        if(REMOTE_CLOUD_CAM_EMBED_URL || REMOTE_CLOUD_CAM_RTSP_URL){
          try{ _applyCamCfg(); }catch(_){}
        }
      }catch(_){}
    })();

    const CAM_KEY_EMBED = "cam.embed.url";
    const CAM_KEY_RTSP  = "cam.rtsp.url";

    function _qp(name){
      try{
        const sp = new URLSearchParams(location.search || "");
        const v = sp.get(name);
        return v ? String(v) : "";
      }catch(_){ return ""; }
    }

    function _syncCamFromQuery(){
      const qEmbed = _qp("cam") || _qp("hls") || _qp("webrtc");
      const qRtsp  = _qp("rtsp");
      try{
        if(qEmbed) localStorage.setItem(CAM_KEY_EMBED, decodeURIComponent(qEmbed));
        if(qRtsp)  localStorage.setItem(CAM_KEY_RTSP,  decodeURIComponent(qRtsp));
      }catch(_){}
    }

    function _getCamCfg(){
      // Se ALLOW_CAM_CONFIG_UI=false: ignora localStorage (così tutti i dispositivi vedono la stessa camera),
      // ma permette override via query string ?cam=...
      const qEmbed = _qp("cam") || _qp("hls") || _qp("webrtc");
      const qRtsp  = _qp("rtsp");

      let embed = "", rtsp = "";

      if(!ALLOW_CAM_CONFIG_UI){
        try{
          if(qEmbed) embed = decodeURIComponent(String(qEmbed));
          if(qRtsp)  rtsp  = decodeURIComponent(String(qRtsp));
        }catch(_){}
      }else{
        _syncCamFromQuery();
        try{
          embed = localStorage.getItem(CAM_KEY_EMBED) || "";
          rtsp  = localStorage.getItem(CAM_KEY_RTSP)  || "";
        }catch(_){}
      }

      embed = String(embed||"").trim();
      rtsp  = String(rtsp||"").trim();

            // fallback default (Cloudflare Tunnel) + remoto (cam_config.json)
      const dEmbed = (REMOTE_CLOUD_CAM_EMBED_URL || DEFAULT_CLOUD_CAM_EMBED_URL || "");
      const dRtsp  = (REMOTE_CLOUD_CAM_RTSP_URL  || DEFAULT_CLOUD_CAM_RTSP_URL  || "");

      if(!embed && dEmbed) embed = String(dEmbed).trim();
      if(!rtsp  && dRtsp)  rtsp  = String(dRtsp).trim();

      return { embed, rtsp };
    }


    function _setOverlayHTML(html){
      try{
        const o = document.getElementById("mCamOverlay");
        if(o) o.innerHTML = html;
      }catch(_){}
    }


    // ===== Autoplay iPhone + auto-retry (HLS) =====
    let _camRetryTimer = null;
    let _camRetryN = 0;

    function _camBust(url){
      const u = String(url||"").trim();
      if(!u) return "";
      const sep = u.includes("?") ? "&" : "?";
      return u + sep + "t=" + Date.now();
    }

    function _setupVideoForIOS(video){
      if(!video) return;
      try{
        video.muted = true;
        video.autoplay = true;
        video.playsInline = true;
        video.setAttribute("playsinline","");
        video.setAttribute("webkit-playsinline","");
        video.setAttribute("muted","");
        video.setAttribute("autoplay","");
        video.controls = false;
        video.preload = "auto";
      }catch(_){}
    }

    function _playVideoSafe(video){
      if(!video) return;
      try{
        const p = video.play();
        if(p && typeof p.catch === "function") p.catch(()=>{});
      }catch(_){}
    }

    function _scheduleCamRetry(reason){
      try{
        const camModal = document.getElementById("camViewModal");
        if(!(camModal && camModal.classList.contains("show"))) return;
      }catch(_e){}

      if(!IS_MOBILE) return;
      try{ clearTimeout(_camRetryTimer); }catch(_){}
      _camRetryN = Math.min((_camRetryN||0) + 1, 8);

      const delay = Math.min(15000, Math.round(1200 * Math.pow(1.6, _camRetryN)));
      _camRetryTimer = setTimeout(() => {
        const cfg = _getCamCfg();
        if(!cfg || !cfg.embed) return;

        const body = document.getElementById("mCamBody");
        const video = document.getElementById("mCamVideo");
        const fr = body ? body.querySelector("iframe") : null;

        if(/(\.m3u8(\?|$)|\/api\/hls\b)/i.test(cfg.embed) && video){
          _setupVideoForIOS(video);
          try{
            const target = cfg.embed;
            const cur = String(video.getAttribute("src") || video.src || "");
            if(!cur || cur.indexOf(target) === -1){
              video.src = target;
            }else{
              try{ video.load(); }catch(_e){}
            }
            video.style.display = "block";
            _playVideoSafe(video);
          }catch(_e){}
          try{
            const bg = document.getElementById("mCamVideoBg");
            if(bg){
              _setupVideoForIOS(bg);
              const cur2 = String(bg.getAttribute("src") || bg.src || "");
              if(!cur2 || cur2.indexOf(cfg.embed) === -1){
                bg.src = cfg.embed;
              }else{
                try{ bg.load(); }catch(_e2){}
              }
              bg.style.display = "block";
              _playVideoSafe(bg);
            }
          }catch(_e){}
          try{ if(fr) fr.setAttribute("src","about:blank"); }catch(_e){}
        }else{
          try{
            if(video){
              video.pause();
              video.removeAttribute("src");
              video.load();
              video.style.display = "none";
            }
          }catch(_){}
          try{ if(fr) fr.setAttribute("src", cfg.embed); }catch(_){}
        }
      }, delay);
    }

    // se torni sull’app (iPhone), prova a riprendere il video senza tap
    document.addEventListener("visibilitychange", () => {
      if(!IS_MOBILE) return;
      if(document.visibilityState !== "visible") return;
      try{
        const v = document.getElementById("mCamVideo");
        if(v && (v.getAttribute("src") || v.src)) _playVideoSafe(v);
      }catch(_){}
    });


    function _applyCamCfg(){
      if(!IS_MOBILE) return;

      const cfg = _getCamCfg();
      const body = document.getElementById("mCamBody");
      const video = document.getElementById("mCamVideo");
      const videoBg = document.getElementById("mCamVideoBg");
      let fr = body ? body.querySelector("iframe") : null;


      // Lazy start: carica lo stream solo quando il popup telecamera è aperto
      try{
        const camModal = document.getElementById("camViewModal");
        const isOpen = !!(camModal && camModal.classList.contains("show"));
        if(!isOpen){
          // Assicura che non resti in riproduzione in background
          try{
            if(video){ video.pause(); video.removeAttribute("src"); video.load(); video.style.display="none"; }
            if(videoBg){ videoBg.pause(); videoBg.removeAttribute("src"); videoBg.load(); videoBg.style.display="none"; }
            if(fr) fr.setAttribute("src","about:blank");
            const ov = document.getElementById("mCamOverlay");
            if(ov) ov.innerHTML = cfg && cfg.embed ? "TOCCA PER APRIRE" : "TELECAMERA NON CONFIGURATA";
            if(ov) ov.style.display = "";
          }catch(_e){}
          return;
        }
      }catch(_e){}
      // se serve iframe (embed non-HLS), crealo (mobile ha solo <video> di default)
      if(body && !fr){
        try{
          fr = document.createElement("iframe");
          fr.setAttribute("src","about:blank");
          fr.setAttribute("allow","autoplay; fullscreen");
          fr.setAttribute("referrerpolicy","no-referrer");
          fr.setAttribute("loading","eager");
          fr.style.width = "100%";
          fr.style.height = "100%";
          fr.style.border = "0";
          fr.style.display = "block";
          body.appendChild(fr);
        }catch(_){}
      }

      // pulizia video
      try{
        if(video){
          video.pause();
          video.removeAttribute("src");
          video.load();
          video.style.display = "none";
        }
        if(videoBg){
          videoBg.pause();
          videoBg.removeAttribute("src");
          videoBg.load();
          videoBg.style.display = "none";
        }
      }catch(_){ }
      if(cfg.embed){
        // Se è HLS (.m3u8) su iPhone: usa <video> (più stabile)
        if(/\.m3u8(\?|$)/i.test(cfg.embed) && video){
          try{
            _setupVideoForIOS(video);

            // eventi (una sola volta)
            if(!video.__camWired){
              video.__camWired = true;

              video.addEventListener("playing", () => {
                _camRetryN = 0;
                try{ _setOverlayHTML("—"); }catch(_){}
                try{ _setCamOnline(true); }catch(_){}
              });

              const onErr = () => {
                try{ _setCamOnline(false); }catch(_){}
                try{ _setOverlayHTML("TELECAMERA OFFLINE"); }catch(_){}
                _scheduleCamRetry("video-error");
              };
              video.addEventListener("error", onErr);
              video.addEventListener("stalled", () => _scheduleCamRetry("stalled"));
              video.addEventListener("waiting", () => { try{ _setOverlayHTML("CARICAMENTO…"); }catch(_e){} });
            }

            video.src = cfg.embed;
            video.style.display = "block";
            _playVideoSafe(video);
          }catch(_){}
          if(fr) fr.setAttribute("src","about:blank");
        }else{
          if(fr) fr.setAttribute("src", cfg.embed);
        }

        _setOverlayHTML("—");
        // online "soft": poi lo conferma _checkCam
        try{ _setCamOnline(true); }catch(_){}
      }else{
        if(fr) fr.setAttribute("src","about:blank");
        try{ _setCamOnline(false); }catch(_){}

        if(cfg.rtsp){
          _setOverlayHTML(
            `TELECAMERA RTSP<br>` +
            `<a id="mCamRtspLink" href="${cfg.rtsp}" ` +
            `style="display:inline-block;margin-top:10px;padding:10px 14px;border-radius:12px;` +
            `border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.45);` +
            `color:#fff;text-decoration:none;font-weight:1000;">APRI IN VLC</a>` +
            `<div style="margin-top:10px;font-size:12px;opacity:.85;">Bridge HTTPS non configurato.</div>`
          );
        }else{
          _setOverlayHTML(
            `TELECAMERA NON CONFIGURATA` +
            `<div style="margin-top:10px;font-size:12px;opacity:.85;">Bridge HTTPS non configurato.</div>`
          );
        }
      }

      // refresh stato
      try{ _checkCam(); }catch(_){}
    }

    function _openCamModal(){
      if(!IS_MOBILE) return;
      const modal = document.getElementById("camModal");
      if(!modal) return;

      const cfg = _getCamCfg();
      const in1 = document.getElementById("camEmbedUrl");
      const in2 = document.getElementById("camRtspUrl");
      if(in1) in1.value = cfg.embed || "";
      if(in2) in2.value = cfg.rtsp || "";

      modal.classList.add("show");
      modal.setAttribute("aria-hidden","false");

      requestAnimationFrame(() => { try{ (in1 || in2).focus(); }catch(_e){} });
    }

    function _closeCamModal(){
      const modal = document.getElementById("camModal");
      if(!modal) return;
      modal.classList.remove("show");
      modal.setAttribute("aria-hidden","true");
    }

    
    (function _wireCamModal(){
      const btn = document.getElementById("camCfgBtn");

      // In modalità Cloudflare Tunnel (prod), disattiva UI di configurazione: deve vedersi subito ovunque
      if(!ALLOW_CAM_CONFIG_UI){
        try{ if(btn) btn.style.display = "none"; }catch(_){}
        return;
      }

      if(btn) btn.addEventListener("click", _openCamModal);

      const ov = document.getElementById("mCamOverlay");
      if(ov) ov.addEventListener("click", _openCamModal);

      const modal = document.getElementById("camModal");
      if(modal) modal.addEventListener("click", (e) => { if(e && e.target === modal) _closeCamModal(); });

      const cancel = document.getElementById("camCancel");
      const save = document.getElementById("camSave");
      if(cancel) cancel.addEventListener("click", _closeCamModal);

      if(save) save.addEventListener("click", () => {
        const in1 = document.getElementById("camEmbedUrl");
        const in2 = document.getElementById("camRtspUrl");
        const v1 = (in1 && in1.value) ? String(in1.value).trim() : "";
        const v2 = (in2 && in2.value) ? String(in2.value).trim() : "";

        try{
          if(v1) localStorage.setItem(CAM_KEY_EMBED, v1); else localStorage.removeItem(CAM_KEY_EMBED);
          if(v2) localStorage.setItem(CAM_KEY_RTSP,  v2); else localStorage.removeItem(CAM_KEY_RTSP);
        }catch(_){}

        _closeCamModal();
        _applyCamCfg();
      });
    })();

    // applica subito (supporta anche parametri in URL)
    _applyCamCfg();

// ===== Telecamera: tasto -> popup full-screen =====
(function _wireCamView(){
  const camBtn = document.getElementById("mCamBtn");
  const modal  = document.getElementById("camViewModal");
  const close  = document.getElementById("camViewClose");

  function _fitCamStage(){
    try{
      const body = document.getElementById("mCamBody");
      const stage = document.querySelector("#camViewModal .camViewStage");
      if(!body || !stage) return;
      const r = stage.getBoundingClientRect();
      body.style.setProperty("--camStageW", Math.round(r.width) + "px");
      body.style.setProperty("--camStageH", Math.round(r.height) + "px");
    }catch(_e){}
  }


  function _openCamView(){
    if(!IS_MOBILE || !modal) return;
    modal.classList.add("show");
    modal.setAttribute("aria-hidden","false");
    try{ const ov=document.getElementById("mCamOverlay"); if(ov) ov.style.display=""; }catch(_e){}

    // Ruota la vista per ottenere un 9:16 naturale (senza bande nere)
    try{
      const body = document.getElementById("mCamBody");
      if(body) body.classList.add("camRot90");
    }catch(_e){}

    // Aggiorna dimensioni stage (serve per rotazione precisa)
    try{ _fitCamStage(); }catch(_e){}
    requestAnimationFrame(() => { try{ _fitCamStage(); }catch(_e){} });

    // aggiorna player + prova a far partire senza tap extra
    try{ _applyCamCfg(); }catch(_){}
    try{
      const v = document.getElementById("mCamVideo");
      if(v) _playVideoSafe(v);
      const b = document.getElementById("mCamVideoBg");
      if(b) _playVideoSafe(b);
    }catch(_){}
  }

  function _closeCamView(){
    if(!modal) return;
    modal.classList.remove("show");
    modal.setAttribute("aria-hidden","true");

    try{
      const body = document.getElementById("mCamBody");
      if(body){ body.classList.remove("camRot90"); }
    }catch(_e){}

    // Stop stream quando chiudi (evita refresh/loop in background)
    try{
      const v = document.getElementById("mCamVideo");
      const b = document.getElementById("mCamVideoBg");
      const body = document.getElementById("mCamBody");
      const fr = body ? body.querySelector("iframe") : null;
      if(v){ v.pause(); v.removeAttribute("src"); v.load(); v.style.display="none"; }
      if(b){ b.pause(); b.removeAttribute("src"); b.load(); b.style.display="none"; }
      if(fr) fr.setAttribute("src","about:blank");
      const ov = document.getElementById("mCamOverlay");
      if(ov) ov.style.display = "";
    }catch(_e){}
  }

  if(camBtn){
        camBtn.addEventListener("click", _openCamView);
        camBtn.addEventListener("keydown", (e) => {
          if(!e) return;
          if(e.key === "Enter" || e.key === " "){
            try{ e.preventDefault(); }catch(_){}
            _openCamView();
          }
        });
      }
  if(close) close.addEventListener("click", _closeCamView);

  if(modal) modal.addEventListener("click", (e) => {
    if(e && e.target === modal) _closeCamView();
  });

  document.addEventListener("keydown", (e) => {
    if(!e) return;
    if(e.key === "Escape" && modal && modal.classList.contains("show")) _closeCamView();
  });

  // Non aprire la telecamera se tocchi la rotella (impostazioni)
  const cfgBtn = document.getElementById("camCfgBtn");
  if(cfgBtn){
    cfgBtn.addEventListener("click", (e) => {
      try{ e.stopPropagation(); }catch(_){}
    }, true);
  }

  // Mantieni il 9:16 perfetto anche quando ruoti/sblocchi lo schermo
  window.addEventListener("resize", () => {
    try{ if(modal && modal.classList.contains("show")) _fitCamStage(); }catch(_e){}
  }, { passive:true });
  window.addEventListener("orientationchange", () => {
    setTimeout(() => { try{ if(modal && modal.classList.contains("show")) _fitCamStage(); }catch(_e){} }, 180);
  }, { passive:true });

  // Rotella dentro il popup full-screen
  const cfgBtn2 = document.getElementById("camViewCfgBtn");
  if(cfgBtn2){
    if(!ALLOW_CAM_CONFIG_UI){
      try{ cfgBtn2.style.display = "none"; }catch(_){}
    }
    cfgBtn2.addEventListener("click", (e) => {
      try{ e.stopPropagation(); }catch(_){}
      try{ _openCamModal(); }catch(_){}
    });
  }
})();





    // ===== Telecamera status + banner ticker (mobile) =====
    const prodBtnEl = document.getElementById("mWipBtn");
    const prodTickerEl = document.getElementById("mWipScan");
    const prodTickerEl2 = document.getElementById("mWipScan2");
    const camHintEl = document.getElementById("mCamHint");
    const camOverlayEl = document.getElementById("mCamOverlay");
    let _camOnline = false;

    function _setCamOnline(v){
      _camOnline = !!v;
      try{
        if(camHintEl) camHintEl.textContent = _camOnline ? "ONLINE" : "OFFLINE";
        if(camOverlayEl) camOverlayEl.style.display = _camOnline ? "none" : "";
        if(prodBtnEl){
          prodBtnEl.style.setProperty("--wipColor", _camOnline ? "#2bff88" : "#ff4d4d");
          prodBtnEl.style.setProperty("--wipGlow",  _camOnline ? "rgba(43,255,136,.45)" : "rgba(255,77,77,.45)");
        }
      }catch(_){}
      _updateBanner(); // refresh testo
    }

    async function _ping(url, ms=3000){
      const ctrl = new AbortController();
      const t = setTimeout(() => { try{ ctrl.abort(); }catch(_e){} }, ms);
      try{
        // no-cors: ci interessa solo "errore rete" vs "raggiungibile"
        await fetch(url, { method:"GET", mode:"no-cors", cache:"no-store", signal: ctrl.signal });
        clearTimeout(t);
        return true;
      }catch(_e){
        clearTimeout(t);
        return false;
      }
    }

    function _healthUrl(u){
      try{
        const s = String(u || "").trim();
        if(!s) return "";
        const sep = s.includes("?") ? "&" : "?";
        return s + sep + "health=1&t=" + Date.now();
      }catch(_e){
        return String(u || "");
      }
    }


    async function _checkCam(){
      try{
        const cfg = (typeof _getCamCfg === "function") ? _getCamCfg() : null;
        const eff0 = (cfg && cfg.embed) ? String(cfg.embed).trim() : "";

        if(!eff0){
          _setCamOnline(false);
          return;
        }

        if(/^https?:/i.test(eff0)){
          const ok = await _ping(_healthUrl(eff0), 2500);
          _setCamOnline(ok);
        }else{
          // se non è http/https (es. custom), consideralo online se c'è una sorgente valida
          _setCamOnline(true);
        }
      }catch(_e){
        _setCamOnline(false);
      }
    }

    function _updateBanner(){
      if(!IS_MOBILE || !prodTickerEl) return;

      const jobs = Array.isArray(lastJobs) ? lastJobs : [];
      let pending = 0;
      try{
        for(let i=0;i<jobs.length;i++){
          const k = makeKey(jobs[i], i);
          if(!producedCloud.has(k)) pending++;
        }
      }catch(_){ pending = 0; }

      const doneRows = producedCloud.size || 0;
      const totalMin = pending * 90;
      const daysRaw = totalMin / (60*8);
      const days = Math.ceil(daysRaw * 10) / 10;
      const daysTxt = Number.isFinite(days) ? (days.toFixed(1).replace(".",",")) : "0";

      const stateTxt = _camOnline ? "SISTEMA ONLINE" : "SISTEMA OFFLINE";
      const line = `${stateTxt} — CI VOGLIONO ${daysTxt} GIORNI PER COMPLETARE (8H/GIORNO • 90 MIN/PRODOTTO) — IN CODA: ${pending} — COMPLETATI: ${doneRows}`;
      prodTickerEl.textContent = line;
      if(prodTickerEl2) prodTickerEl2.textContent = line;
    }

    // avvio check telecamera
    _checkCam();
    setInterval(_checkCam, 15000);


    let _mode = "jobs"; // jobs | done
    let _selected = new Set();
    let _sheetActiveTimerEl = null;

    function openSheet(mode){
      _mode = mode;
      _selected = new Set();
      if(el.sheetActions) el.sheetActions.style.display = "none";
      if(el.sheetBackdrop) el.sheetBackdrop.classList.add("show");
      if(el.sheet) el.sheet.classList.add("show");
      if(el.sheetBackdrop) el.sheetBackdrop.setAttribute("aria-hidden","false");
      if(el.sheet) el.sheet.setAttribute("aria-hidden","false");
      renderSheet();
    }
    function closeSheet(){
      if(el.sheetBackdrop) el.sheetBackdrop.classList.remove("show");
      if(el.sheet) el.sheet.classList.remove("show");
      if(el.sheetBackdrop) el.sheetBackdrop.setAttribute("aria-hidden","true");
      if(el.sheet) el.sheet.setAttribute("aria-hidden","true");
    }

    function renderSheet(){
      if(!el.sheetList) return;
      el.sheetList.innerHTML = "";
      if(el.sheetTitle){
        el.sheetTitle.textContent = (_mode === "jobs") ? "Lista produzione" : "Completati";
      }

      if(_mode === "jobs"){
        _sheetActiveTimerEl = null;
        // Mostra le righe non completate (a partire dall'attiva)
        const jobs = Array.isArray(lastJobs) ? lastJobs : [];
        let firstActiveIdx = -1;
        for(let i=0;i<jobs.length;i++){
          const k = makeKey(jobs[i], i);
          if(!producedCloud.has(k)) { firstActiveIdx = i; break; }
        }
        const activeKey = WIP_STATE?.activeKey || ((firstActiveIdx>=0)?makeKey(jobs[firstActiveIdx], firstActiveIdx):null);

        for(let i=0;i<jobs.length;i++){
          const job = jobs[i];
          const key = makeKey(job, i);
          if(producedCloud.has(key)) continue;

          const item = document.createElement("div");
          item.className = "mItem" + ((key === activeKey) ? " active" : "");

          const main = document.createElement("div");
          main.className = "mItemMain";
          const title = document.createElement("div");
          title.className = "mItemTitle";
          title.textContent = job.product || key;

          const sub = document.createElement("div");
          sub.className = "mItemSub";
          const fmt = `${job.qty} ${job.unit}`.trim();
          const fmt2 = (job.format || "").trim();
          const isActive = (key === activeKey);
          let t = "";
          try{
            if(isActive && Number(WIP_STATE?.startedAtMs||0)){
              const elapsed = serverNowMs() - Number(WIP_STATE.startedAtMs||0);
              t = " • ⏱ " + formatDur(elapsed);
            }
          }catch(_){}
          sub.textContent = `${fmt}${fmt2 ? " • " + fmt2 : ""}`;
          if(isActive){
            const timerSpan = document.createElement("span");
            timerSpan.className = "mItemTimer";
            timerSpan.textContent = t || "";
            sub.appendChild(timerSpan);
            _sheetActiveTimerEl = timerSpan;
          }

          main.appendChild(title);
          main.appendChild(sub);

          item.appendChild(main);

          // tap = apre subito la domanda quantità (ma SOLO dopo aver aperto il popup lista)
          item.addEventListener("click", () => {
            const rowEl = rowNodes.get(key);
            if(rowEl) showModalForRow(rowEl);
            closeSheet();
          });
el.sheetList.appendChild(item);
        }

        // Nessun elemento
        if(!el.sheetList.children.length){
          const empty = document.createElement("div");
          empty.className = "prodEmpty";
          empty.textContent = "Nessun prodotto in lista.";
          el.sheetList.appendChild(empty);
        }

      }else{
        // Completati: usa producedCloud
        const items = [...producedCloud.entries()].map(([key,v])=>({key,...v}));
        items.sort((a,b)=>{
          const ta = completionMsFromItem(a) || 0;
          const tb = completionMsFromItem(b) || 0;
          return tb - ta;
        });

        for(const it of items){
          const item = document.createElement("div");
          item.className = "mItem";
          const main = document.createElement("div");
          main.className = "mItemMain";

          const title = document.createElement("div");
          title.className = "mItemTitle";
          title.textContent = (it.label || it.key || "—");

          const sub = document.createElement("div");
          sub.className = "mItemSub";
          const dur = (Number.isFinite(it.durationMs)) ? formatDur(it.durationMs) : "";
          const lot = lotFromItem(it);
          sub.textContent = `${it.qty ? (it.qty + " pz") : ""}${dur ? " • ⏱ " + dur : ""}${lot ? " • " + lot : ""}`;

          main.appendChild(title);
          main.appendChild(sub);

          const undo = document.createElement("button");
          undo.className = "mMiniBtn";
          undo.type = "button";
          undo.textContent = "Annulla";
          undo.addEventListener("click", async (ev) => {
            ev.stopPropagation();
            const ok = await confirmUndoWithPassword();
            if(!ok) return;
            if(!IS_MOBILE) speak(`Annullato. ${it.label || it.key}.`);
            await unmarkProducedCloud(it.key);
          });

          item.appendChild(main);
          item.appendChild(undo);

          // tap = riepilogo quantità + copia firma
          item.addEventListener("click", () => {
            try{ openDoneModal(it); }catch(_){ }
            closeSheet();
          });
el.sheetList.appendChild(item);
        }
        // Annulla globale completati (solo mobile)
        try{
          const wipe = document.createElement("div");
          wipe.className = "mBackupBox mDangerBox";
          wipe.innerHTML = `
            <div class="mBackupNote">Annulla lista completati</div>
            <button class="mMiniBtn" type="button">Annulla tutti</button>
          `;
          wipe.querySelector("button")?.addEventListener("click", async (ev) => {
            ev.stopPropagation();
            await undoAllProduced();
            closeSheet();
          });
          el.sheetList.appendChild(wipe);
        }catch(_){}



        // Backup completati (solo mobile): salva in localStorage e scarica JSON
        try{
          const box = document.createElement("div");
          box.className = "mBackupBox";
          box.innerHTML = `
            <div class="mBackupNote">Backup completati</div>
            <button class="mMiniBtn" type="button">Scarica backup</button>
          `;
          box.querySelector("button")?.addEventListener("click", (ev) => {
            ev.stopPropagation();
            try{ saveProducedBackupNow(); downloadProducedBackup().catch(()=>{}); }catch(_){ }
          });
          el.sheetList.appendChild(box);
        }catch(_){}

        if(!el.sheetList.children.length){
          const empty = document.createElement("div");
          empty.className = "prodEmpty";
          empty.textContent = "Nessuna riga completata.";
          el.sheetList.appendChild(empty);
        }
      }
    }

    async function completeSelected(){
      // Prende il primo selezionato e apre il modal quantità (come desktop)
      const key = [..._selected][0];
      if(!key) return;

      // prova a ricavare label dal job
      let label = key;
      try{
        const jobs = Array.isArray(lastJobs) ? lastJobs : [];
        for(let i=0;i<jobs.length;i++){
          const k = makeKey(jobs[i], i);
          if(k === key){
            label = `${jobs[i].product} • ${jobs[i].format}`.replace(/\s+/g,' ').trim();
            break;
          }
        }
      }catch(_){}

      // usa lo stesso flusso del desktop
      try{
        const dummy = document.createElement("div");
        dummy.dataset.key = key;
        dummy.dataset.label = label;
        showModalForRow(dummy);
        closeSheet();
      }catch(e){
        console.log("completeSelected error:", e);
      }
    }

    function deselect(){
      _selected = new Set();
      renderSheet();
    }

    // Events
    el.wipBtn?.addEventListener("click", () => openSheet("jobs"));
    el.doneBtn?.addEventListener("click", () => openSheet("done"));
    el.sheetBackdrop?.addEventListener("click", closeSheet);
    el.sheetClose?.addEventListener("click", closeSheet);
    // el.sheetGhost click disabled (no selection flow)
    // el.sheetPrimary click disabled (no selection flow)
    function updateFromJobs(){
      const jobs = Array.isArray(lastJobs) ? lastJobs : [];

      let firstActiveIdx = -1;
      for(let i=0;i<jobs.length;i++){
        const k = makeKey(jobs[i], i);
        if(!producedCloud.has(k)) { firstActiveIdx = i; break; }
      }
      const job = (firstActiveIdx >= 0) ? jobs[firstActiveIdx] : null;
      const key = job ? makeKey(job, firstActiveIdx) : null;

      if(el.wipProd) el.wipProd.textContent = job?.product || "—";
      if(el.wipSub){
        const q = job ? `${job.qty} ${job.unit}`.trim() : "—";
        const f = job?.format ? (" • " + job.format) : "";
        // Totale rimanente (tutte le righe non completate)
        let remCount = 0;
        let remQty = 0;
        let remUnit = "";
        try{
          for(let i=0;i<jobs.length;i++){
            const k = makeKey(jobs[i], i);
            if(!producedCloud.has(k)){
              remCount++;
              const n = Number(jobs[i]?.qty || 0);
              if(Number.isFinite(n)) remQty += n;
              if(!remUnit) remUnit = String(jobs[i]?.unit || "").trim();
            }
          }
        }catch(_){}
        el.wipSub.textContent = (q + f) || "—";
        if(el.wipRemainBadge) el.wipRemainBadge.textContent = String(remCount || 0);
}

      // forza stile WIP sul widget
      if(el.wipBtn){
        el.wipBtn.style.setProperty("--wipColor", "");
        el.wipBtn.style.setProperty("--wipGlow", "");
      }
      updateWipTimer(key);
      try{ _updateBanner(); }catch(_){ }
    }

    function updateFromProduced(){
      const doneRows = producedCloud.size || 0;
      if(el.doneCount) el.doneCount.textContent = String(doneRows);

      // Ultimo prodotto completato (più recente)
      let last = null;
      try{
        producedCloud.forEach(v => {
          if(!v) return;
          const t = (v.ts && typeof v.ts.toMillis === "function") ? v.ts.toMillis() : (v.completedAtClientMs || v.signatureClientMs || 0);
          if(!last || t >= last._t){ last = Object.assign({_t:t}, v); }
        });
      }catch(_){ last = null; }

      if(el.doneLast) el.doneLast.textContent = (last && last.label) ? String(last.label) : "—";
      if(el.doneSub){
        const tail = (last && (last.qty!=null)) ? (" • Ultimo: " + String(last.qty) + " pz") : "";
        el.doneSub.textContent = "Righe completate: " + String(doneRows) + tail;
      }
      try{ _updateBanner(); }catch(_){ }
    }

    function updateWipTimer(fallbackKey){
      const activeKey = WIP_STATE?.activeKey || fallbackKey || null;
      const startMs = Number(WIP_STATE?.startedAtMs || 0);
      if(!activeKey || !startMs){
        if(el.wipTimer) el.wipTimer.textContent = "⏱ —";
        return;
      }
      const elapsed = serverNowMs() - startMs;
      if(el.wipTimer) el.wipTimer.textContent = "⏱ " + formatDur(elapsed);

      // Aggiorna timer anche nel popup (sheet) se aperto
      try{
        if(el.sheet?.classList.contains("show") && _mode === "jobs" && _sheetActiveTimerEl){
          _sheetActiveTimerEl.textContent = " • ⏱ " + formatDur(elapsed);
        }
      }catch(_){ }

      // Colore dinamico (verde->rosso)
      try{
        const st = wipStyleFromElapsed(elapsed);
        el.wipBtn?.style.setProperty("--wipColor", st.color);
        el.wipBtn?.style.setProperty("--wipGlow", st.glow);
      }catch(_){}
    }

    return { updateFromJobs, updateFromProduced, updateWipTimer };
  })();

  // (refresh ordini da Sheet rimosso)

  refreshWeather().catch(()=>{ document.getElementById("wDesc").textContent="Meteo non disponibile"; });
  setInterval(() => refreshWeather().catch(()=>{}), WX_REFRESH_MS);

  // Annulla globale completati (desktop)
  try{
    const undoAllBtn = document.getElementById("undoAllProduced");
    undoAllBtn?.addEventListener("click", (ev) => { ev.preventDefault(); undoAllProduced(); });
  }catch(_){}


  // ===== Easyfatt XML Orders from Google Drive (shared folder) =====
  // Config: inserisci qui la tua API key (limitata a https://generalcopper.github.io/* e Google Drive API)
  const XML_DRIVE_CFG = {
    folderId: "1Yy3i_buHx9zyMevozKk8NFny4ac44gGV",
    fileName: "Documenti.DefXml",
    apiKey: "AIzaSyC-zEBXOiw5LAEZ27ZgJ5uxZNVTZOumtuQ"
  };

  const XML_POLL_MS = 20000;

  const xmlEl = (id) => document.getElementById(id);
  const xmlStatusEl = () => xmlEl("xmlStatus");
  const xmlListEl = () => xmlEl("xmlCustomersList");
  const xmlEmptyEl = () => xmlEl("xmlEmpty");

  const xmlOrdersModal = () => xmlEl("xmlOrdersModal");
  const xmlOrdersTitle = () => xmlEl("xmlOrdersTitle");
  const xmlOrdersSub = () => xmlEl("xmlOrdersSub");
  const xmlOrdersRows = () => xmlEl("xmlOrdersRows");
  const xmlOrdersCancel = () => xmlEl("xmlOrdersCancel");
  const xmlOrdersConfirm = () => xmlEl("xmlOrdersConfirm");

  const xmlSigModal = () => xmlEl("xmlSigModal");
  const xmlSigSub = () => xmlEl("xmlSigSub");
  const xmlSigYes = () => xmlEl("xmlSigYesChk");
  const xmlSigCanvas = () => xmlEl("xmlSigCanvas");
  const xmlSigClear = () => xmlEl("xmlSigClear");
  const xmlSigCancel = () => xmlEl("xmlSigCancel");
  const xmlSigOk = () => xmlEl("xmlSigOk");

  // Stato in memoria
  let _XML_ITEMS = [];           // tutte le righe
  let _XML_BY_CUST = new Map();  // customer -> items[]
  let _XML_FILEMETA = null;      // {id, modifiedTime}
  let _XML_DONE = new Set();     // lineKey completate (cloud)
  let _XML_DONE_MAP = new Map(); // id -> data (per pannello completati)
  let _XML_OPEN_CUST = null;     // customer selezionato
  let _XML_SELECTED = new Set(); // lineKey selezionate nel modal
  let _XML_PENDING_BATCH = null; // { customer, selectedKeys[], lines[] }

  // Cloud: collezione completati (sincronizzata su tutti)
  let _XML_DONE_COL = null;
  try{
    const day = (typeof TODAY !== "undefined" && TODAY) ? TODAY : new Intl.DateTimeFormat("en-CA",{timeZone:"Europe/Rome"}).format(new Date());
    _XML_DONE_COL = collection(db, "powderOrdersDone", day, "items");
    onSnapshot(_XML_DONE_COL, (snap) => {
      const s = new Set();
      const map = new Map();
      snap.forEach(d => {
        s.add(d.id);
        try{ map.set(d.id, d.data() || {}); }catch(_){ map.set(d.id, {}); }
      });
      _XML_DONE = s;
      _XML_DONE_MAP = map;

      renderXmlCustomers(); // aggiorna UI
      // se modal aperto, aggiorna righe
      if(_XML_OPEN_CUST) renderXmlModal(_XML_OPEN_CUST);

      // aggiorna pannello "Completati"
      try{ renderProducedFromCloud(); }catch(_){}
    });
  }catch(e){
    console.warn("XML done cloud init error:", e);
  }

  function driveListByName(folderId, fileName, apiKey){
    const q = encodeURIComponent(`'${folderId}' in parents and name='${fileName}' and trashed=false`);
    const url = `https://www.googleapis.com/drive/v3/files?q=${q}&fields=files(id,name,modifiedTime,size)&key=${apiKey}`;
    return fetch(url, { cache:"no-store" }).then(r => r.json());
  }
  function driveFetchFile(fileId, apiKey){
    const url = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media&key=${apiKey}`;
    return fetch(url, { cache:"no-store" }).then(r => r.text());
  }

  function safeText(el){ return (el && el.textContent) ? el.textContent.trim() : ""; }

  function buildLineKey(docNum, cust, desc, qty, um){
    const raw = [docNum||"", cust||"", desc||"", String(qty||""), um||""].join("|");
    try{ return "x_" + stableHash(raw).slice(0, 14); }catch(_){ 
      // fallback: hash manuale
      let h=0; for(let i=0;i<raw.length;i++){ h=(h*31 + raw.charCodeAt(i))|0; }
      return "x_" + Math.abs(h).toString(36);
    }
  }

  function parseEasyfattXml(xmlText){
    const out = [];
    let doc;
    try{
      const parser = new DOMParser();
      doc = parser.parseFromString(xmlText, "text/xml");
    }catch(e){ throw new Error("XML non valido"); }

    const docs = Array.from(doc.getElementsByTagName("Document"));
    for(const d of docs){
      const cust = safeText(d.getElementsByTagName("CustomerName")[0]) || "Cliente";
      const num = safeText(d.getElementsByTagName("Number")[0]) || "";
      const date = safeText(d.getElementsByTagName("Date")[0]) || "";
      const rows = Array.from(d.getElementsByTagName("Row"));
      for(const r of rows){
        const desc = safeText(r.getElementsByTagName("Description")[0]) || safeText(r.getElementsByTagName("Code")[0]) || "Riga";
        const qty = safeText(r.getElementsByTagName("Qty")[0]) || "0";
        const um  = safeText(r.getElementsByTagName("Um")[0]) || "";
        const lineKey = buildLineKey(num, cust, desc, qty, um);
        out.push({ lineKey, customer:cust, docNumber:num, docDate:date, description:desc, qty, um });
      }
    }
    return out;
  }

  function setXmlStatus(text){
    const el = xmlStatusEl();
    if(el) el.textContent = text;
  }

  function renderXmlCustomers(){
    const list = xmlListEl();
    const empty = xmlEmptyEl();
    if(!list) return;

    // ricostruisci map
    _XML_BY_CUST = new Map();
    for(const it of _XML_ITEMS){
      if(_XML_DONE && _XML_DONE.has(it.lineKey)) continue; // nascondi completati
      if(!_XML_BY_CUST.has(it.customer)) _XML_BY_CUST.set(it.customer, []);
      _XML_BY_CUST.get(it.customer).push(it);
    }

    // svuota
    list.innerHTML = "";
    const custs = Array.from(_XML_BY_CUST.keys()).sort((a,b)=>a.localeCompare(b,"it"));
    if(custs.length === 0){
      const div = document.createElement("div");
      div.className = "xmlEmpty";
      div.textContent = "Nessun ordine da fare.";
      list.appendChild(div);
      return;
    }

    for(const c of custs){
      const items = _XML_BY_CUST.get(c) || [];
      const lines = items.length;
      const qtySum = items.reduce((acc, it) => acc + (parseFloat(String(it.qty).replace(",",".")) || 0), 0);

      const row = document.createElement("div");
      row.className = "xmlCustRow";
      row.addEventListener("click", () => openXmlOrdersModal(c));

      const left = document.createElement("div");
      left.className = "xmlCustName";
      left.textContent = c;

      const right = document.createElement("div");
      right.className = "xmlCustMeta";
      right.innerHTML = `<span class="xmlPill"><span class="xmlDot"></span>${lines} prodotti</span><div style="margin-top:4px; opacity:.75;">Totale: <b>${qtySum}</b> ${items[0]?.um || ""}</div>`;

      row.appendChild(left);
      row.appendChild(right);
      list.appendChild(row);
    }
  }

  function openXmlOrdersModal(customer){
    _XML_OPEN_CUST = customer;
    _XML_SELECTED = new Set();
    renderXmlModal(customer);

    const m = xmlOrdersModal();
    if(!m) return;
    m.classList.add("show");
    m.setAttribute("aria-hidden","false");
  }

  function closeXmlOrdersModal(){
    const m = xmlOrdersModal();
    m?.classList.remove("show");
    m?.setAttribute("aria-hidden","true");
    _XML_OPEN_CUST = null;
    _XML_SELECTED = new Set();
  }

  function renderXmlModal(customer){
    const title = xmlOrdersTitle();
    const sub = xmlOrdersSub();
    const rowsEl = xmlOrdersRows();
    const btn = xmlOrdersConfirm();

    if(title) title.textContent = "Ordine cliente";
    const items = (_XML_BY_CUST.get(customer) || []).slice().sort((a,b)=> (a.docNumber||"").localeCompare(b.docNumber||"") );

    if(sub){
      const nDoc = new Set(items.map(x=>x.docNumber).filter(Boolean)).size;
      sub.textContent = `${customer} • ${items.length} righe` + (nDoc ? ` • ${nDoc} doc.` : "");
    }

    if(!rowsEl) return;
    rowsEl.innerHTML = "";

    for(const it of items){
      const line = document.createElement("div");
      line.className = "xmlLine";

      const chk = document.createElement("input");
      chk.type = "checkbox";
      chk.className = "xmlChk";
      chk.checked = _XML_SELECTED.has(it.lineKey);
      chk.addEventListener("change", () => {
        if(chk.checked) _XML_SELECTED.add(it.lineKey);
        else _XML_SELECTED.delete(it.lineKey);
        updateXmlConfirmBtn();
      });

      const main = document.createElement("div");
      main.className = "xmlLineMain";

      const desc = document.createElement("div");
      desc.className = "xmlLineDesc";
      desc.textContent = it.description;

      const subl = document.createElement("div");
      subl.className = "xmlLineSub";
      subl.innerHTML = `<span><b>Q.tà</b>: ${it.qty} ${it.um || ""}</span>` +
                       (it.docNumber ? `<span><b>Doc</b>: ${it.docNumber}</span>` : ``) +
                       (it.docDate ? `<span><b>Data</b>: ${it.docDate}</span>` : ``);

      main.appendChild(desc);
      main.appendChild(subl);

      line.appendChild(chk);
      line.appendChild(main);

      rowsEl.appendChild(line);
    }

    updateXmlConfirmBtn();
  }

  function updateXmlConfirmBtn(){
    const btn = xmlOrdersConfirm();
    if(!btn) return;
    btn.disabled = (_XML_SELECTED.size === 0);
  }

  function openXmlSigModal(subText){
    const m = xmlSigModal();
    if(!m) return;

    if(xmlSigSub()) xmlSigSub().textContent = subText || "—";
    if(xmlSigYes()) xmlSigYes().checked = false;

    // reset canvas
    _XMLSIG.dirty = false;
    _XMLSIG.drawing = false;
    try{ xmlSigOk().disabled = true; }catch(_){}

    m.classList.add("show");
    m.setAttribute("aria-hidden","false");

    requestAnimationFrame(() => {
      try{ xmlSigResize(); }catch(_){}
      try{ xmlSigClearCanvas(); }catch(_){}
    });
  }
  function closeXmlSigModal(){
    const m = xmlSigModal();
    m?.classList.remove("show");
    m?.setAttribute("aria-hidden","true");
  }

  // Signature drawing (pointer)
  const _XMLSIG = { ctx:null, drawing:false, dirty:false, dpr:1, lastX:0, lastY:0 };
  function xmlSigResize(){
    const c = xmlSigCanvas();
    if(!c) return;
    const rect = c.getBoundingClientRect();
    const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
    _XMLSIG.dpr = dpr;
    c.width = Math.max(1, Math.floor(rect.width * dpr));
    c.height = Math.max(1, Math.floor(rect.height * dpr));
    const ctx = c.getContext("2d");
    _XMLSIG.ctx = ctx;
    if(!ctx) return;
    ctx.setTransform(dpr,0,0,dpr,0,0);
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    ctx.lineWidth = 3;
    ctx.strokeStyle = "#eaf7ff";
    ctx.fillStyle = "rgba(0,0,0,0)";
  }
  function xmlSigClearCanvas(){
    const c = xmlSigCanvas();
    const ctx = _XMLSIG.ctx;
    if(!c || !ctx) return;
    ctx.clearRect(0,0,c.width/_XMLSIG.dpr,c.height/_XMLSIG.dpr);
    _XMLSIG.dirty = false;
    try{ xmlSigOk().disabled = true; }catch(_){}
  }
  function xmlSigSetOkEnabled(){
    const ok = xmlSigOk();
    if(!ok) return;
    ok.disabled = !(xmlSigYes()?.checked && _XMLSIG.dirty);
  }
  function xmlSigPointerPos(ev){
    const c = xmlSigCanvas();
    const r = c.getBoundingClientRect();
    const x = (ev.clientX - r.left);
    const y = (ev.clientY - r.top);
    return {x,y};
  }

  function wireXmlSig(){
    const c = xmlSigCanvas();
    if(!c) return;

    c.addEventListener("pointerdown", (ev) => {
      ev.preventDefault();
      try{ c.setPointerCapture(ev.pointerId); }catch(_){}
      const p = xmlSigPointerPos(ev);
      _XMLSIG.drawing = true;
      _XMLSIG.lastX = p.x; _XMLSIG.lastY = p.y;
    });
    c.addEventListener("pointermove", (ev) => {
      if(!_XMLSIG.drawing) return;
      ev.preventDefault();
      const ctx = _XMLSIG.ctx;
      if(!ctx) return;
      const p = xmlSigPointerPos(ev);
      ctx.beginPath();
      ctx.moveTo(_XMLSIG.lastX, _XMLSIG.lastY);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      _XMLSIG.lastX = p.x; _XMLSIG.lastY = p.y;
      _XMLSIG.dirty = true;
      xmlSigSetOkEnabled();
    });
    const end = (ev) => {
      if(!_XMLSIG.drawing) return;
      ev.preventDefault();
      _XMLSIG.drawing = false;
      xmlSigSetOkEnabled();
    };
    c.addEventListener("pointerup", end);
    c.addEventListener("pointercancel", end);

    xmlSigYes()?.addEventListener("change", xmlSigSetOkEnabled);
    xmlSigClear()?.addEventListener("click", (ev) => { ev.preventDefault(); xmlSigClearCanvas(); });
    xmlSigCancel()?.addEventListener("click", (ev) => { ev.preventDefault(); _XML_PENDING_BATCH = null; closeXmlSigModal(); });

    xmlSigOk()?.addEventListener("click", async (ev) => {
      ev.preventDefault();
      if(!_XML_PENDING_BATCH) { closeXmlSigModal(); return; }
      if(!(xmlSigYes()?.checked)) return;
      if(!_XMLSIG.dirty) return;

      let sigDataUrl = "";
      try{ sigDataUrl = xmlSigCanvas().toDataURL("image/jpeg", 0.75); }catch(_){
        try{ sigDataUrl = xmlSigCanvas().toDataURL(); }catch(__){}
      }

      const batch = _XML_PENDING_BATCH;
      const keys = batch.selectedKeys || [];
      const lines = batch.lines || [];
      const now = Date.now();

      try{
        if(!_XML_DONE_COL) throw new Error("Cloud non inizializzato");
        // salva ogni riga completata
        for(const k of keys){
          const it = lines.find(x=>x.lineKey===k);
          if(!it) continue;
          await setDoc(doc(_XML_DONE_COL, k), {
            lineKey: k,
            customer: it.customer,
            description: it.description,
            qty: it.qty,
            um: it.um,
            docNumber: it.docNumber || "",
            docDate: it.docDate || "",
            signatureDataUrl: sigDataUrl,
            signatureBy: (typeof DEVICE_ID !== "undefined" ? DEVICE_ID : ""),
            signatureClientMs: now,
            completedAtClientMs: now,
            ts: serverTimestamp()
          }, { merge:true });
        }
      }catch(e){
        alert("Errore salvataggio cloud: " + (e?.message || e));
        return;
      }

      _XML_PENDING_BATCH = null;
      closeXmlSigModal();
      closeXmlOrdersModal();
      // UI refresh immediato (la snapshot farà il resto)
      setTimeout(() => { try{ renderXmlCustomers(); }catch(_){} }, 150);
    });

    xmlSigModal()?.addEventListener("click", (e) => {
      if(e.target === xmlSigModal()){
        _XML_PENDING_BATCH = null;
        closeXmlSigModal();
      }
    });
  }

  function wireXmlOrders(){
    xmlOrdersCancel()?.addEventListener("click", (ev) => { ev.preventDefault(); closeXmlOrdersModal(); });
    xmlOrdersConfirm()?.addEventListener("click", (ev) => {
      ev.preventDefault();
      if(!_XML_OPEN_CUST) return;
      const cust = _XML_OPEN_CUST;
      const items = _XML_BY_CUST.get(cust) || [];
      const keys = Array.from(_XML_SELECTED);
      if(keys.length === 0) return;

      _XML_PENDING_BATCH = {
        customer: cust,
        selectedKeys: keys,
        lines: items
      };

      openXmlSigModal(`${cust} • ${keys.length} righe completate`);
    });

    xmlOrdersModal()?.addEventListener("click", (e) => {
      if(e.target === xmlOrdersModal()){
        closeXmlOrdersModal();
      }
    });
  }

  async function xmlPoll(){
    // se api key non impostata, mostra hint ma non bloccare nulla
    if(!XML_DRIVE_CFG.apiKey || XML_DRIVE_CFG.apiKey.includes("INCOLLA")){
      setXmlStatus("Drive: API key mancante");
      // comunque non fermare la UI
      if(!_XML_ITEMS.length){
        _XML_ITEMS = [];
        renderXmlCustomers();
      }
      return;
    }

    try{
      const meta = await driveListByName(XML_DRIVE_CFG.folderId, XML_DRIVE_CFG.fileName, XML_DRIVE_CFG.apiKey);
      const file = meta?.files?.[0];
      if(!file){
        _XML_ITEMS = [];
        _XML_FILEMETA = null;
        setXmlStatus("Drive: file non trovato");
        renderXmlCustomers();
        return;
      }

      // se non è cambiato, non riscaricare
      if(_XML_FILEMETA && _XML_FILEMETA.id === file.id && _XML_FILEMETA.modifiedTime === file.modifiedTime){
        setXmlStatus("Drive: OK • " + new Date().toLocaleTimeString("it-IT"));
        return;
      }

      const xmlText = await driveFetchFile(file.id, XML_DRIVE_CFG.apiKey);
      const items = parseEasyfattXml(xmlText);

      _XML_ITEMS = items;
      _XML_FILEMETA = { id:file.id, modifiedTime:file.modifiedTime };

      setXmlStatus("Drive: OK • " + new Date().toLocaleTimeString("it-IT"));
      renderXmlCustomers();
      if(_XML_OPEN_CUST) renderXmlModal(_XML_OPEN_CUST);

    }catch(e){
      console.warn("XML poll error:", e);
      setXmlStatus("Drive: errore");
      // non rompere: mantieni ultimo stato
      if(!_XML_ITEMS.length) renderXmlCustomers();
    }
  }

  // Avvio (non blocca il boot)
  try{
    wireXmlOrders();
    wireXmlSig();
    xmlPoll();
    setInterval(xmlPoll, XML_POLL_MS);
  }catch(e){
    console.warn("XML init error:", e);
  }

</script>
<style id="appleLightTheme">
/* APPLE LIGHT THEME — final override (last in cascade) */
:root{
  --bg0:#f5f5f7 !important;
  --bg1:#ffffff !important;
  --panel:#ffffff !important;
  --line:rgba(0,0,0,.10) !important;
  --text:#111111 !important;
  --neonCyan:#007aff !important;
  --neonMag:#af52de !important;
  --neonYel:#ffcc00 !important;
  --todo:#007aff !important;
  --done:#34c759 !important;
}
body{ background: var(--bg0) !important; color: var(--text) !important; }
body:before{ display:none !important; }
.card, .mWidget{
  background: var(--panel) !important;
  border: 1px solid var(--line) !important;
  box-shadow: 0 1px 2px rgba(0,0,0,.06), 0 10px 30px rgba(0,0,0,.10) !important;
  backdrop-filter:none !important;
  -webkit-backdrop-filter:none !important;
}
.titleCard:before, .bootBox:before, .titleGrid{ display:none !important; }
.title, .timeVal, .wTemp, .product, .qty{ text-shadow:none !important; color:#111 !important; }
.subtitle, .timeLabel, .wTitle, .wDesc, .wMeta, .fmt{ color: rgba(17,17,17,.70) !important; }
.chip, .wPill, .badge, .mBadge{
  background:#f2f2f7 !important;
  border:1px solid rgba(0,0,0,.10) !important;
  box-shadow:none !important;
  color: rgba(17,17,17,.88) !important;
}
.dot{ background: var(--todo) !important; box-shadow: 0 0 0 6px rgba(0,122,255,.12) !important; }
.badge.done .dot{ background: var(--done) !important; box-shadow: 0 0 0 6px rgba(52,199,89,.14) !important; }
.modalBox{ background:#fff !important; border:1px solid rgba(0,0,0,.12) !important; color:#111 !important; }
.btnOk{ background: var(--neonCyan) !important; border-color: var(--neonCyan) !important; color:#fff !important; }
.btnGhost{ background:#f2f2f7 !important; border:1px solid rgba(0,0,0,.12) !important; color:#111 !important; }

/* =========================================================
   BLUE/AZZURRO THEME OVERRIDE + EXTRA DYNAMICS
   (desktop + mobile + popup + bottom sheet)
   Nessuna logica/JS toccata: solo CSS.
   ========================================================= */
:root{
  /* Base */
  --bg0:#020a16;         /* navy */
  --bg1:#063a66;         /* deep blue */
  --panel: rgba(5, 28, 52, .86);
  --line: rgba(120, 205, 255, .28);
  --text:#ffffff;

  /* Accenti */
  --neonCyan:#4fd5ff;    /* azzurro */
  --neonMag:#2b7fff;     /* blu elettrico */
  --neonYel:#7fe7ff;     /* cyan chiaro (no giallo) */
  --todo:#4fd5ff;
  --done:#2b7fff;
}

body{
  background:
    radial-gradient(1400px 1100px at 12% 10%, rgba(79,213,255,.18), transparent 55%),
    radial-gradient(1400px 1100px at 88% 18%, rgba(43,127,255,.16), transparent 55%),
    radial-gradient(1200px 900px at 70% 92%, rgba(79,213,255,.10), transparent 60%),
    linear-gradient(180deg, var(--bg0), var(--bg1)) !important;
  color: var(--text) !important;
}
body:before{ opacity:.12 !important; }

::selection{ background: rgba(79,213,255,.28); color:#fff; }
a{ color: rgba(180,235,255,.96); }

/* ===== Cards / Widgets ===== */
.card,
.mWidget,
.titleCard,
.weatherCard,
.clockCard{
  background: linear-gradient(180deg, rgba(9,42,78,.86), rgba(5,28,52,.86)) !important;
  border-color: var(--line) !important;
  box-shadow:
    0 0 0 1px rgba(79,213,255,0.10),
    0 14px 34px rgba(0,0,0,0.54),
    0 0 56px rgba(79,213,255,0.07),
    0 0 70px rgba(43,127,255,0.06) !important;
}

.card,
.mWidget,
.badge,
.btnGhost,
.btnOk,
.undoBtn,
.mSheetPrimary,
.mSheetGhost,
.mSheetClose,
.mMiniBtn,
.camCfgBtn,
.mCamBtnOpen,
#camViewModal .camViewClose{
  transition: transform .14s ease, filter .18s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease;
}

/* "Dinamismi" gentili: floating + shimmer */
@keyframes blueFloat{ 0%,100%{ transform:translateY(0);} 50%{ transform:translateY(-2px);} }
@keyframes blueShine{ 0%{ transform:translateX(-60%);} 100%{ transform:translateX(160%);} }

.card::after,
.mWidget::after{
  content:"";
  position:absolute;
  inset:-2px;
  pointer-events:none;
  opacity:.0;
  background: linear-gradient(90deg,
    rgba(79,213,255,0.00),
    rgba(79,213,255,0.18),
    rgba(43,127,255,0.14),
    rgba(79,213,255,0.00));
  filter: blur(10px);
  transform: translateX(-60%);
  mix-blend-mode: screen;
}
.card:hover::after,
.mWidget:hover::after{
  opacity:.55;
  animation: blueShine 1.9s linear infinite;
}
.card:hover,
.mWidget:hover{
  transform: translateY(-2px) scale(1.002);
  filter: brightness(1.05);
  border-color: rgba(79,213,255,.40) !important;
}
.badge.btn:hover{ filter: brightness(1.07); }
.badge.btn:active{ transform: scale(0.985); }

/* Floating solo se non riduci movimento */
@media (prefers-reduced-motion: no-preference){
  .card{ animation: blueFloat 8.5s ease-in-out infinite; }
  .mWidget{ animation: blueFloat 9.5s ease-in-out infinite; }
}

/* ===== Typography contrast ===== */
.subtitle,
.timeLabel,
.wTitle,
.wDesc,
.wMeta,
.fmt,
.prodHint,
.mKicker,
.mSub,
.mCamHint,
.mSheetTitle,
.modalSub{
  color: rgba(225,245,255,.82) !important;
}
.wTemp,
.timeVal,
.title,
.product,
.qty{
  color: #fff !important;
  text-shadow: 0 0 26px rgba(79,213,255,0.16) !important;
}

/* ===== Status colors -> blu/azzurro ===== */
.dot{
  background: var(--todo) !important;
  box-shadow: 0 0 0 6px rgba(79,213,255,.14) !important;
}
.badge.todo{ border-color: rgba(79,213,255,.34) !important; }
.badge.done{
  border-color: rgba(43,127,255,.38) !important;
  box-shadow: 0 0 22px rgba(43,127,255,0.14) !important;
}
.badge.done .dot{
  background: var(--done) !important;
  box-shadow: 0 0 0 6px rgba(43,127,255,.16), 0 0 18px rgba(43,127,255,.24) !important;
}
.wip{
  --wipColor: #4fd5ff !important;
  --wipGlow: rgba(79,213,255,.55) !important;
}

/* ===== Desktop rows dynamics ===== */
.row:hover{
  background: rgba(255,255,255,.02);
}
.row:active{ filter: brightness(1.04); }

/* ===== Popup / Modal (anche quelli mobile) ===== */
.modal{
  background: rgba(0,10,22,.68) !important;
}
.modalBox{
  background: linear-gradient(180deg, rgba(9,42,78,.92), rgba(5,28,52,.92)) !important;
  border-color: rgba(79,213,255,.32) !important;
  box-shadow:
    0 18px 90px rgba(0,0,0,.60),
    0 0 70px rgba(79,213,255,.10),
    0 0 90px rgba(43,127,255,.08) !important;
}
.modalInput{
  background: rgba(255,255,255,.07) !important;
  border-color: rgba(255,255,255,.16) !important;
  color: #fff !important;
}
.modalInput:focus{
  border-color: rgba(79,213,255,.60) !important;
  box-shadow: 0 0 0 3px rgba(79,213,255,.16) !important;
}
.btnOk{
  border-color: rgba(79,213,255,.55) !important;
  background: rgba(79,213,255,.22) !important;
}
.btnOk:hover{ background: rgba(79,213,255,.28) !important; }
.btnGhost:hover{ background: rgba(255,255,255,.08) !important; }

/* ===== Mobile bottom-sheet (lista produzione) ===== */
@media (max-width: 820px){
  .mSheet{
    background: linear-gradient(180deg, rgba(9,42,78,.96), rgba(5,28,52,.96)) !important;
    border-color: rgba(79,213,255,.26) !important;
  }
  .mSheetBackdrop{ background: rgba(0,10,22,.66) !important; }
  .mItem{
    background: rgba(255,255,255,.04) !important;
    border-color: rgba(255,255,255,.12) !important;
  }
  .mItem.active{
    border-color: rgba(79,213,255,.62) !important;
    box-shadow: 0 0 0 1px rgba(79,213,255,.24), 0 12px 30px rgba(79,213,255,.10) !important;
  }
  .mItem.selected{
    border-color: rgba(43,127,255,.62) !important;
    box-shadow: 0 0 0 1px rgba(43,127,255,.24), 0 12px 30px rgba(43,127,255,.10) !important;
  }
  .mChk{ accent-color: var(--neonCyan) !important; }
  .mSheetPrimary{
    border-color: rgba(79,213,255,.45) !important;
    background: rgba(79,213,255,.20) !important;
  }
  .mSheetPrimary:hover{ background: rgba(79,213,255,.26) !important; }
  .mSheetGhost:hover{ background: rgba(255,255,255,.08) !important; }

  /* Widget mobile: scritte bianche super leggibili */
  .mWidget{ color:#fff !important; }
  .mBadge{
    border-color: rgba(255,255,255,.18) !important;
    background: rgba(255,255,255,.10) !important;
    box-shadow: 0 0 18px rgba(79,213,255,.10) !important;
  }
  .mDot.done{
    background: #2b7fff !important;
    box-shadow: 0 0 0 6px rgba(43,127,255,.14), 0 0 16px rgba(43,127,255,.40) !important;
  }

  /* Cam popup top bar blu */
  #camViewModal .camViewTop{
    background: rgba(5,28,52,.75) !important;
    border-bottom-color: rgba(79,213,255,.18) !important;
  }
}

/* ===== Scrollbar (nice in blu) ===== */
*::-webkit-scrollbar{ width: 10px; height: 10px; }
*::-webkit-scrollbar-thumb{
  background: rgba(79,213,255,.22);
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 999px;
}
*::-webkit-scrollbar-thumb:hover{ background: rgba(79,213,255,.32); }
*::-webkit-scrollbar-track{ background: rgba(0,0,0,.12); }

/* Reduced motion safety */
@media (prefers-reduced-motion: reduce){
  .card, .mWidget, .card::after, .mWidget::after{ animation:none !important; transition:none !important; }
}



/* =========================================================
   FIX VISIBILITÀ OPERATORE — TESTI BIANCHI OVUNQUE
   (popup + sheet mobile + avvio sistema)
   ========================================================= */
:root{ --text:#ffffff !important; }

.title, .timeVal, .wTemp, .product, .qty,
.subtitle, .timeLabel, .wTitle, .wDesc, .wMeta, .fmt,
.header, .badge, .chip, .wPill,
.producedCard, .prodItem, .prodEmpty{
  color:#fff !important;
}

/* Popup: testi bianchi */
.modalBox, .modalTitle, .modalSub, .modalHint,
.modalBox *{
  color:#fff !important;
}
.modalInput{
  color:#fff !important;
  -webkit-text-fill-color:#fff !important;
  caret-color:#fff !important;
}
.modalInput::placeholder{
  color: rgba(255,255,255,.55) !important;
}

/* Bottom sheet “Lista Produzione” + item: forzo bianco (iOS button text fix) */
.mSheet, .mSheet *{
  color:#fff !important;
}
.mSheet button, .mSheet .mItem{
  color:#fff !important;
  -webkit-text-fill-color:#fff !important;
}

/* Camera popup */
#camViewModal .camViewTop,
#camViewModal .camViewTitle,
#camViewModal .camViewClose,
#camViewModal .camCfgBtn{
  color:#fff !important;
  -webkit-text-fill-color:#fff !important;
}

/* AVVIO SISTEMA: blu */
.bootOverlay{
  background:
    radial-gradient(1200px 900px at 20% 10%, rgba(79,213,255,.22), transparent 55%),
    radial-gradient(1200px 900px at 90% 20%, rgba(43,127,255,.18), transparent 55%),
    linear-gradient(180deg, rgba(2,10,22,.96), rgba(6,58,102,.96)) !important;
}
.bootBox{
  background: linear-gradient(180deg, rgba(9,42,78,.92), rgba(5,28,52,.92)) !important;
  border: 1px solid rgba(79,213,255,.28) !important;
  box-shadow: 0 18px 90px rgba(0,0,0,.55), 0 0 80px rgba(79,213,255,.12) !important;
}
.bootTitle, .bootMsg, .bootPct{
  color:#fff !important;
  text-shadow: none !important;
}
.bootBar{
  border: 1px solid rgba(255,255,255,.16) !important;
  background: rgba(255,255,255,.08) !important;
}
.bootFill{
  background: linear-gradient(90deg, rgba(79,213,255,1), rgba(43,127,255,1)) !important;
  box-shadow: 0 0 20px rgba(79,213,255,.25) !important;
}



/* ===============================
   FORCE BLUE THEME — VISIBILITY PASS
   (last rules win over any light overrides)
   =============================== */
:root{
  --text:#f4fbff;
  --muted: rgba(210,240,255,.78);
  --muted2: rgba(210,240,255,.58);
  --muted3: rgba(210,240,255,.42);
  --chipBg: rgba(53,242,255,.18);
  --chipBg2: rgba(53,242,255,.08);
  --chipBorder: rgba(53,242,255,.38);
}

/* global text */
html, body, .wrap{ color: var(--text) !important; }

/* small texts + labels */
.subtitle, .timeLabel, .wTitle, .wDesc, .wMeta, .fmt{ color: var(--muted) !important; -webkit-text-fill-color: currentColor !important; }
.wSmall{ color: var(--muted2) !important; -webkit-text-fill-color: currentColor !important; }

/* chips / pills / badge bubbles */
.chip, .wPill, .badge, .mBadge{
  background: linear-gradient(180deg, var(--chipBg), var(--chipBg2)) !important;
  border: 1px solid var(--chipBorder) !important;
  color: var(--text) !important;
  box-shadow:
    0 0 0 1px rgba(53,242,255,.10),
    0 10px 22px rgba(0,0,0,.35) !important;
}
.chip *, .wPill *, .badge *, .mBadge *{
  color: inherit !important;
  -webkit-text-fill-color: currentColor !important;
}

/* cards/widgets: ensure readable text everywhere */
.card, .header, .titleCard, .weatherCard, .clockCard, .dayCard, .mWidget{
  color: var(--text) !important;
}

/* mobile widget headings */
.mKicker, .mSub{ color: var(--muted) !important; -webkit-text-fill-color: currentColor !important; }
.mTimer{ color: var(--text) !important; -webkit-text-fill-color: currentColor !important; }

/* boot overlay must be blue */
.bootOverlay{
  background:
    radial-gradient(1200px 800px at 20% 10%, rgba(53,242,255,.22), rgba(0,0,0,0)),
    linear-gradient(180deg, #071a3a, #040b18) !important;
}
.bootTitle, .bootMsg, .bootPct{
  color: var(--text) !important;
  -webkit-text-fill-color: currentColor !important;
  text-shadow: 0 0 22px rgba(53,242,255,.18) !important;
}
.bootBar{
  border: 1px solid rgba(53,242,255,.25) !important;
  background: rgba(255,255,255,.06) !important;
}
.bootFill{
  background: linear-gradient(90deg, #35f2ff, #2bff88) !important;
  box-shadow: 0 0 18px rgba(53,242,255,.28) !important;
}


/* ===============================
   BLUE THEME — HARD BORDER VISIBILITY (fix legacy light overrides)
   =============================== */
:root{
  --line: rgba(79,213,255,.34) !important;
  --lineStrong: rgba(79,213,255,.58) !important;
  --lineSoft: rgba(79,213,255,.22) !important;
}

/* Card edges + separators */
.card{
  border: 1.5px solid var(--line) !important;
  box-shadow:
    0 0 0 1px rgba(79,213,255,.10),
    0 14px 34px rgba(0,0,0,0.50),
    0 0 46px rgba(79,213,255,0.06) !important;
}
.header{
  border-bottom: 1px solid rgba(79,213,255,.26) !important;
  background: rgba(79,213,255,.06) !important;
}
.row{
  border-bottom: 1px solid rgba(79,213,255,.18) !important;
}

/* Desktop “Completati” cards/items (were forced white) */
.producedCard, .prodItem{
  background: rgba(10,14,24,.34) !important;
  border: 1.5px solid rgba(79,213,255,.22) !important;
  box-shadow: 0 0 0 1px rgba(79,213,255,.08) !important;
}
.prodEmpty{
  background: rgba(10,14,24,.22) !important;
  border: 1.5px dashed rgba(79,213,255,.22) !important;
  color: rgba(240,251,255,.78) !important;
}

/* Modals (popup) borders + input borders */
.modalBox{
  background: linear-gradient(180deg, rgba(8,22,42,.92), rgba(6,16,30,.92)) !important;
  border: 1.5px solid rgba(79,213,255,.30) !important;
  box-shadow: 0 26px 110px rgba(0,0,0,.58), 0 0 0 1px rgba(79,213,255,.10) !important;
}
.modalSub{ color: rgba(240,251,255,.72) !important; -webkit-text-fill-color: currentColor !important; }
.modalInput{
  background: rgba(255,255,255,.06) !important;
  border: 1.5px solid rgba(79,213,255,.26) !important;
  color: #fff !important;
  -webkit-text-fill-color:#fff !important;
}
.modalInput:focus{
  border-color: rgba(79,213,255,.70) !important;
  box-shadow: 0 0 0 4px rgba(79,213,255,.18) !important;
}

/* Buttons inside modal (ghost/ok) */
.btnGhost{
  background: rgba(255,255,255,.06) !important;
  border: 1.5px solid rgba(79,213,255,.20) !important;
  color:#fff !important;
  -webkit-text-fill-color:#fff !important;
}
.btnOk{
  background: rgba(79,213,255,.18) !important;
  border: 1.5px solid rgba(79,213,255,.48) !important;
  color:#fff !important;
  -webkit-text-fill-color:#fff !important;
}

/* Mobile widgets (were forced white) */
@media (max-width: 820px){
  .mWidget{
    background: rgba(10,14,24,.42) !important;
    border: 1.5px solid rgba(79,213,255,.22) !important;
    box-shadow:
      0 0 0 1px rgba(79,213,255,.08),
      0 12px 40px rgba(0,0,0,.45) !important;
    color:#fff !important;
    -webkit-text-fill-color:#fff !important;
  }
  .mKicker, .mSub{ color: rgba(240,251,255,.78) !important; -webkit-text-fill-color: currentColor !important; }
}

/* Bottom sheet items borders */
.mSheetTop{ border-bottom: 1px solid rgba(79,213,255,.18) !important; }
.mItem{
  border: 1.5px solid rgba(79,213,255,.20) !important;
  background: rgba(255,255,255,.04) !important;
  box-shadow: 0 0 0 1px rgba(79,213,255,.06) !important;
}
.mSheetClose{
  border: 1.5px solid rgba(79,213,255,.22) !important;
}

/* Signature pad: keep light surface, but readable border */
.sigPadWrap, .sigPreviewWrap{
  border: 2px solid rgba(79,213,255,.32) !important;
  box-shadow: 0 0 0 1px rgba(79,213,255,.10) !important;
}

</style>
<!-- Modal Ordini Cliente -->
<div aria-hidden="true" class="modal" id="xmlOrdersModal">
<div aria-labelledby="xmlOrdersTitle" aria-modal="true" class="modalBox" role="dialog">
<div class="modalTitle" id="xmlOrdersTitle">Ordine cliente</div>
<div class="modalSub" id="xmlOrdersSub" style="opacity:.85;">—</div>
<div class="xmlModalList" id="xmlOrdersRows"></div>
<div class="modalActions" style="margin-top:12px;">
<button class="btnGhost" id="xmlOrdersCancel" type="button">Annulla</button>
<button class="btnOk" disabled="" id="xmlOrdersConfirm" type="button">Conferma completati</button>
</div>
<div style="margin-top:10px; font-size:12px; opacity:.75; line-height:1.35;">
      Tip: spunta le righe completate, poi conferma. Verrà richiesta la firma.
    </div>
</div>
</div>
<!-- Modal Firma (Ordini) -->
<div aria-hidden="true" class="modal" id="xmlSigModal">
<div aria-labelledby="xmlSigTitle" aria-modal="true" class="modalBox" role="dialog">
<div class="modalTitle" id="xmlSigTitle">Conferma e firma</div>
<div class="modalSub" id="xmlSigSub" style="opacity:.85;">—</div>
<label class="sigYes">
<input id="xmlSigYesChk" type="checkbox"/>
      Dichiaro di aver prodotto come si deve
    </label>
<div class="sigWrap">
<canvas id="xmlSigCanvas"></canvas>
</div>
<div class="modalActions" style="margin-top:12px;">
<button class="btnGhost" id="xmlSigClear" type="button">Pulisci</button>
<div style="flex:1"></div>
<button class="btnGhost" id="xmlSigCancel" type="button">Annulla</button>
<button class="btnOk" disabled="" id="xmlSigOk" type="button">Salva firma</button>
</div>
<div style="margin-top:10px; font-size:12px; opacity:.75; line-height:1.35;">
      Firma con dito o mouse. La firma viene salvata insieme alle righe completate nel cloud.
    </div>
</div>
</div>
</body>
</html>
