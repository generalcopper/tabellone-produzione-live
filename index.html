<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tabellone Produzione Live</title>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    body {
      margin:0; height:100vh; display:flex; align-items:center; justify-content:center;
      background:#05060a; color:#eaf7ff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }
    .box {
      border:1px solid rgba(120,255,255,.22); border-radius:18px; padding:22px 26px;
      background: rgba(10,14,24,.82); backdrop-filter: blur(14px);
      box-shadow: 0 14px 34px rgba(0,0,0,0.50);
      text-align:center;
    }
    .t {font-weight:950; letter-spacing:1px; text-transform:uppercase; font-size:18px; margin-bottom:8px}
    .s {opacity:.75; font-weight:700}
  </style>
</head>
<body>
  <div class="box">
    <div class="t">Avvio tabelloneâ€¦</div>
    <div class="s" id="st">Controllo versione</div>
  </div>

<script>
(async () => {
  const st = document.getElementById("st");
  const base = new URL(".", window.location.href).toString();
  try {
    // Always bypass cache for version file
    const verUrl = new URL("version.json", base);
    verUrl.searchParams.set("t", Date.now());
    const res = await fetch(verUrl.toString(), { cache: "no-store" });
    if(!res.ok) throw new Error("HTTP " + res.status);
    const j = await res.json();
    const v = (j && j.v) ? String(j.v) : "20251216-225803";
    st.textContent = "Versione " + v;
    const app = new URL("app_tabellone.html", base);
    app.searchParams.set("v", v);
    // Replace so Back doesn't loop
    window.location.replace(app.toString());
  } catch(e) {
    st.textContent = "Errore versione: " + (e && e.message ? e.message : e);
    // Fallback: try app directly with timestamp
    const app = new URL("app_tabellone.html", base);
    app.searchParams.set("v", Date.now());
    setTimeout(() => window.location.replace(app.toString()), 1200);
  }
})();
</script>
</body>
</html>
