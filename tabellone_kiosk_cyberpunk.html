<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Centro Produzioni – Kiosk</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#05080f;
  --panel:#0b1220;
  --border:#1ef7c7;
  --accent:#00ff9c;
  --text:#e6fff6;
  --warning:#ffb703;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Orbitron',sans-serif;
  background:radial-gradient(circle at top,#0a1630,#03060d 70%);
  color:var(--text);
  overflow:hidden;
}

/* LOADING */
#loading{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
#loading h1{
  margin-bottom:20px;
  font-size:40px;
  letter-spacing:3px;
}
#bar{
  width:60%;
  height:22px;
  border:2px solid var(--border);
}
#bar span{
  display:block;
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--accent),#00c3ff);
}

/* GRID */
#app{
  display:grid;
  grid-template-columns: 40% 60%;
  grid-template-rows: auto 1fr;
  height:100vh;
  padding:20px;
  gap:20px;
}

/* HEADER */
header{
  grid-column:1/3;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border:2px solid var(--border);
  padding:14px 20px;
  background:var(--panel);
}
header h2{margin:0;font-size:26px}

/* LEFT */
#left{
  display:grid;
  grid-template-rows: 1fr 1fr;
  gap:20px;
}
.panel{
  background:var(--panel);
  border:2px solid var(--border);
  padding:20px;
}
.panel h3{
  margin-top:0;
  font-size:20px;
  color:var(--accent);
}

/* PULSING */
.pulse{
  animation:pulse 1.5s infinite;
}
@keyframes pulse{
  0%{box-shadow:0 0 10px var(--accent)}
  50%{box-shadow:0 0 30px var(--accent)}
  100%{box-shadow:0 0 10px var(--accent)}
}

/* RIGHT TABLE */
#right{
  background:var(--panel);
  border:2px solid var(--border);
  padding:20px;
  overflow:hidden;
}
table{
  width:100%;
  border-collapse:collapse;
  table-layout:fixed;
}
th,td{
  padding:10px;
  border-bottom:1px solid #123;
  font-size:14px;
}
th{
  color:var(--accent);
  text-align:left;
}
td:nth-child(3),td:nth-child(4){
  text-align:right;
}
tbody{
  display:block;
  height:calc(100vh - 220px);
  overflow-y:auto;
}
thead, tbody tr{
  display:table;
  width:100%;
  table-layout:fixed;
}
</style>
</head>

<body>

<div id="loading">
  <h1>AVVIO SISTEMA</h1>
  <div id="bar"><span></span></div>
</div>

<audio id="bootVoice" src="boot.mp3"></audio>

<div id="app" style="display:none">

<header>
  <h2>CENTRO PRODUZIONI</h2>
  <div id="clock"></div>
</header>

<div id="left">
  <div class="panel pulse" id="current">
    <h3>PRODOTTO IN CORSO</h3>
    <div id="currentData">—</div>
  </div>

  <div class="panel" id="next">
    <h3>PROSSIMO PRODOTTO</h3>
    <div id="nextData">—</div>
  </div>
</div>

<div id="right">
  <h3>LISTA PRODUZIONI</h3>
  <table>
    <thead>
      <tr>
        <th>Prodotto</th>
        <th>Stato</th>
        <th>Pz</th>
        <th>Taglia</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
</div>

</div>

<script>
// ======= CONFIG =======
const SHEET_CSV = "INCOLLA_QUI_IL_TUO_LINK_CSV_GOOGLE_SHEET";

// ======= LOADING =======
let p=0;
const bar=document.querySelector("#bar span");
const load=setInterval(()=>{
  p++;
  bar.style.width=p+"%";
  if(p===1){
    document.getElementById("bootVoice").play().catch(()=>{});
  }
  if(p>=100){
    clearInterval(load);
    document.getElementById("loading").style.display="none";
    document.getElementById("app").style.display="grid";
  }
},30);

// ======= CLOCK =======
function clock(){
  const it=new Date().toLocaleTimeString("it-IT");
  const cn=new Date().toLocaleTimeString("zh-CN",{timeZone:"Asia/Shanghai"});
  document.getElementById("clock").innerText=`Italia ${it} | Cina ${cn}`;
}
setInterval(clock,1000); clock();

// ======= DATA =======
fetch(SHEET_CSV)
.then(r=>r.text())
.then(t=>{
  const lines=t.trim().split("\n").slice(1);
  const rows=document.getElementById("rows");
  let current=null,next=null;

  lines.forEach((l,i)=>{
    const [prodotto,stato,pz,taglia]=l.split(",");
    if(!current && stato.toLowerCase().includes("corso")) current={prodotto,stato,pz,taglia};
    else if(current && !next) next={prodotto,stato,pz,taglia};

    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${prodotto}</td><td>${stato}</td><td>${pz}</td><td>${taglia}</td>`;
    rows.appendChild(tr);
  });

  if(current){
    document.getElementById("currentData").innerHTML =
      `${current.prodotto}<br>${current.pz} pz – ${current.taglia}`;
  }
  if(next){
    document.getElementById("nextData").innerHTML =
      `${next.prodotto}<br>${next.pz} pz – ${next.taglia}`;
  }
});
</script>

</body>
</html>
